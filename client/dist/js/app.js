/*!                                                                                           
  * This file is protected by Copyright. Please refer to the COPYRIGHT file                    
  * distributed with this source distribution.                                                 
  *                                                                                            
  * This file is part of REDHAWK rtl-demo-client.                                              
  *                                                                                            
  * REDHAWK rtl-demo-client is free software: you can redistribute it and/or modify it         
  * under the terms of the GNU Lesser General Public License as published by the               
  * Free Software Foundation, either version 3 of the License, or (at your                     
  * option) any later version.                                                                 
  *                                                                                            
  * REDHAWK rtl-demo-client is distributed in the hope that it will be useful, but WITHOUT     
  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or                      
  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License               
  * for more details.                                                                          
  *                                                                                            
  * You should have received a copy of the GNU Lesser General Public License                   
  * along with this program.  If not, see http://www.gnu.org/licenses/.                        
  *                                                                                            
  * rtl-demo-client - v1.2.0 - 2015-04-28          
  */
function dashOn(d,a,c){return d.setLineDash?(d.setLineDash([a,c]),!0):void 0!==d.mozDash?(d.mozDash=[a,c],!0):d.webkitLineDash&&0===d.webkitLineDash.length?(d.webkitLineDash=[a,c],!0):!1}function dashOff(d){d.setLineDash?d.setLineDash([]):d.mozDash?d.mozDash=null:d.webkitLineDash&&(d.webkitLineDash=[])}function getKeyCode(d){return d=window.event||d,d=d.charCode||d.keyCode}function setKeypressHandler(d){window.addEventListener?window.addEventListener("keypress",d,!1):window.attachEvent&&window.attachEvent("onkeypress",d)}angular.module("redhawk-audio-directives",[]).directive("streamingAudio",[function(){return{restrict:"E",scope:{url:"="},templateUrl:"components/redhawk-audio/templates/stream.html",link:function(scope,element){var sec2time=function(seconds){var sec_num=Math.floor(seconds),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds);var time=(hours>0?hours+":":"")+minutes+":"+seconds;return time};scope.player=element.find(".player")[0],scope.stream=element.find(".stream")[0],scope.currentTime=sec2time(0),scope.beffered=sec2time(0),scope.volume=100,scope.$watch("volume",function(volume){volume&&(scope.player.volume=volume/100)}),scope.msg=function(text){console.log("AudioPlayer::"+scope.url+": "+text)},scope.player.ontimeupdate=function(){scope.currentTime=sec2time(scope.player.currentTime),scope.buffered=sec2time(scope.player.buffered?scope.player.buffered.end(0):0)},scope.player.onstalled=function(){scope.msg("Stalled")},scope.stream.onerror=function(dat){scope.msg("Error"),console.log(dat)},scope.mute=function(){scope.player.muted=!scope.player.muted,scope.muted=scope.player.muted},scope.togglePlay=function(){var player=scope.player;player.paused?(player.src=scope.url,player.play()):(player.pause(),scope.currentTime=0,player.src="")}}}}]),angular.module("rtl-plots",["SubscriptionSocketService","toastr"]).config(function(toastrConfig){angular.extend(toastrConfig,{positionClass:"toast-bottom-right"})}).service("plotDataConverter",["Modernizr",function(){var conversionMap={"byte":Int8Array,"char":Uint8Array,octet:Uint8Array,ushort:Uint16Array,"short":Int16Array,"long":Int32Array,ulong:Uint32Array,longlong:void 0,ulonglong:void 0,"float":Float32Array,"double":Float64Array},defaultConversion=Float32Array;return function(type){var fn=conversionMap[type];return"octet"==type&&console.log("Plot::DataConverter::WARNING - Data type is 'octet' assuming unsigned."),fn||(console.log("Plot::DataConverter::WARNING - Data type is '"+type+"' using default."),fn=defaultConversion),function(data){return new fn(data)}}}]).service("plotNotSupportedError",[function(){return function(element){element.html('<div class="rtl-plots-error">Plotting is not supported by this browser.</div>')}}]).service("RedhawkNotificationService",["toastr",function(toastr){var self=this;self.enabled=!0,self.msg=function(severity,message,subject){if(this.enabled){var title=subject||severity.toUpperCase();switch(console.log("["+severity.toUpperCase()+"] :: "+message),severity){case"error":toastr.error(message,title);break;case"success":toastr.success(message,title);break;case"info":default:toastr.info(message,title)}}},self.error=function(text,subject){this.msg("error",text,subject)},self.info=function(text,subject){this.msg("info",text,subject)},self.success=function(text,subject){this.msg("success",text,subject)},self.enable=function(enable){this.enabled=enable}}]).directive("rtlPlot",["SubscriptionSocket","plotDataConverter","plotNotSupportedError","$interval","RedhawkNotificationService",function(SubscriptionSocket,plotDataConverter,plotNotSupportedError,$interval,RedhawkNotificationService){return{restrict:"E",scope:{width:"@",height:"@",url:"@",type:"@",doTune:"&",useGradient:"=?",cmode:"@?",plotType:"@",autol:"@",tuneContext:"=",form:"="},template:'<div style="width: {{width}}; height: {{height}};" ></div>',link:function(scope,element){if(!SubscriptionSocket.isSupported()||!SubscriptionSocket.isBinarySupported())return void plotNotSupportedError(element);var plotSocket=SubscriptionSocket.createNew(),RUBBERBOX_ACTION="zoom",RUBBERBOX_MODE="horizontal",accordionDrag=!1;angular.isDefined(scope.useGradient)||(scope.useGradient=!0);var rf_cf,target_freq,wb_bw,if_cf=0,nb_bw=1e5,validCMode=["IN","MA","RE","IM","L0","D1","L2","D2","RI","IR","AB","PH"],cmode="D2";angular.isDefined(scope.cmode)&&""!=scope.cmode&&(-1==validCMode.indexOf(scope.cmode)?console.log("WARN::Invalid cmode '"+scope.cmode+"' setting to '"+cmode+"'."):cmode=scope.cmode);var plot,raster,activePlot,activePlotLayer,accordion,pan,leftButton,rightButton,ghostAccordion,tunedWhileZoomed=!1,TUNE_STEP=2e4,STEP_DELAY=300,pan_control="",clickTolerance=200,defaultSettings={xdelta:10.25390625,xstart:-1,xunits:3,ydelta:.09752380952380953,ystart:0,yunits:3,subsize:4097,size:32768,format:"SF"};scope.plotSettings=angular.copy(defaultSettings),scope.rasterSettings=angular.copy(defaultSettings);var plotOptions={autohide_panbars:!0,autox:3,autoy:3,legend:!1,all:!0,cmode:cmode,xcnt:"continuous",rubberbox_action:RUBBERBOX_ACTION,rubberbox_mode:RUBBERBOX_MODE,colors:{bg:"#222",fg:"#888"}};!scope.autol||"line"!==scope.plotType&&"dots"!==scope.plotType||angular.extend(plotOptions,{autol:scope.autol}),(scope.url.indexOf("psd/fm")>=0||scope.url.indexOf("psd/narrowband")>=0)&&angular.extend(plotOptions,{noreadout:!0}),scope.element=element,scope.$watch(function(scope){return scope.element[0]},function(){plot||"line"!==scope.plotType&&"dots"!==scope.plotType?raster||"raster"!==scope.plotType||createRaster(rasterOptions):createPlot(plotOptions)});var createPlot=function(options){options=options||{},activePlot=plot=new sigplot.Plot(element[0].firstChild,options),scope.url.indexOf("psd/wideband")>=0&&(plot.addListener("mdown",plotMDownListener),plot.addListener("mup",plotMupListener),document.onmouseup=function(){if(pan){var bounds=currentZoomBounds();(event.x<=bounds.xmin||event.x>=bounds.xmax)&&(stopPan(),ghostAccordion.set_visible(!1),accordionDrag=!1,activePlot.removeListener("mmove",accordionMoveListener),activePlot.change_settings({rubberbox_action:RUBBERBOX_ACTION}))}}),scope.useGradient&&plot.change_settings({fillStyle:["rgba(255, 255, 100, 0.7)","rgba(255, 0, 0, 0.7)","rgba(0, 255, 0, 0.7)","rgba(0, 0, 255, 0.7)"]})},addButtons=function(style){var bounds=currentZoomBounds(),leftButtonPos={x:bounds.x1+15,y:bounds.y1+15},rightButtonPos={x:bounds.x2-15,y:bounds.y1+15},buttonSettings={position:{x:leftButtonPos.x,y:leftButtonPos.y},direction:"left",id:"left"};style&&(buttonSettings.strokeStyle=style),leftButton=new sigplot.ButtonPlugin(buttonSettings),activePlot.add_plugin(leftButton,activePlotLayer+3),leftButton.addListener("selectevt",leftButtonListener),buttonSettings={position:{x:rightButtonPos.x,y:rightButtonPos.y},direction:"right",id:"right"},style&&(buttonSettings.strokeStyle=style),rightButton=new sigplot.ButtonPlugin(buttonSettings),activePlot.add_plugin(rightButton,activePlotLayer+4),rightButton.addListener("selectevt",rightButtonListener)},leftButtonListener=function(e){"left"===e.id&&(target_freq=Math.max(rf_cf-wb_bw,scope.tuneContext.minWidebandSpectrum+nb_bw/2),scope.tuneContext.handleTune())},rightButtonListener=function(e){"right"===e.id&&(target_freq=Math.min(rf_cf+wb_bw,scope.tuneContext.maxWidebandSpectrum-nb_bw/2),scope.tuneContext.handleTune())},inRectangle=function(rect,x,y){return x>=rect.x&&x<=rect.x+rect.width&&y>=rect.y&&y<=rect.y+rect.height},updateButtons=function(){leftButton.setEnabled(rf_cf-wb_bw/2>=scope.tuneContext.minWidebandSpectrum),rightButton.setEnabled(rf_cf+wb_bw/2<=scope.tuneContext.maxWidebandSpectrum)},setPlotBounds=function(){var bounds=currentZoomBounds();wb_bw=bounds.xmax-bounds.xmin,console.log("SET WB BW "+wb_bw)},overlayPlot=function(overrides,options){options=options||{};angular.extend(options,{layerType:sigplot.Layer1D});activePlotLayer=plot.overlay_array(null,overrides,options),scope.url.indexOf("psd/wideband")>=0&&(accordion=new sigplot.AccordionPlugin({draw_center_line:!0,shade_area:!0,draw_edge_lines:!0,direction:"vertical",edge_line_style:{strokeStyle:"#FF2400"},prevent_drag:!0}),ghostAccordion=new sigplot.AccordionPlugin({draw_center_line:!0,shade_area:!0,draw_edge_lines:!0,direction:"vertical",edge_line_style:{strokeStyle:"#881200"},center_line_style:{strokeStyle:"#505050"},fill_style:{opacity:.4,fillStyle:"rgb(0,0,0)"},prevent_drag:!0}),plot.add_plugin(accordion,activePlotLayer+1),plot.add_plugin(ghostAccordion,activePlotLayer+2),ghostAccordion.set_width(nb_bw),ghostAccordion.set_visible(!1),addButtons())},rasterOptions={all:!0,expand:!0,autol:5,autox:3,autohide_panbars:!0,xcnt:0,colors:{bg:"#222",fg:"#888"},nogrid:!0,cmode:cmode,rubberbox_action:RUBBERBOX_ACTION,rubberbox_mode:RUBBERBOX_MODE};scope.autol&&"raster"===scope.plotType&&angular.extend(rasterOptions,{autol:scope.autol});var createRaster=function(options){options=options||{},activePlot=raster=new sigplot.Plot(element[0].firstChild,options),scope.url.indexOf("psd/wideband")>=0&&(raster.addListener("mdown",plotMDownListener),raster.addListener("mup",plotMupListener))},overlayRaster=function(overrides,options){var overridesCopy=angular.copy(overrides);activePlotLayer=raster.overlay_pipe(angular.extend(overridesCopy,{type:2e3,pipe:!0,pipesize:5242880}),options),scope.url.indexOf("psd/wideband")>=0&&(accordion=new sigplot.AccordionPlugin({draw_center_line:!1,shade_area:!0,draw_edge_lines:!0,direction:"vertical",edge_line_style:{strokeStyle:"#FF2400"},prevent_drag:!0}),ghostAccordion=new sigplot.AccordionPlugin({draw_center_line:!1,shade_area:!0,draw_edge_lines:!0,direction:"vertical",edge_line_style:{strokeStyle:"#881200"},center_line_style:{strokeStyle:"#505050"},fill_style:{opacity:.4,fillStyle:"rgb(0,0,0)"},prevent_drag:!0}),raster.add_plugin(accordion,activePlotLayer+1),raster.add_plugin(ghostAccordion,activePlotLayer+2),ghostAccordion.set_visible(!1),ghostAccordion.set_width(nb_bw),addButtons("rgb(250,250,250"))},lastMouseDown={x:void 0,y:void 0},plotBoundary=function(event){var bounds=currentZoomBounds();return event.x<=bounds.xmin?0:event.x-nb_bw/2<=bounds.xmin?1:event.x+nb_bw/2>=bounds.xmax&&event.x<bounds.xmax?2:event.x>=bounds.xmax?3:4},lastUnzoomAfterTune=function(button){if(3===button){var zoom=zoomLevel(),retVal=2===zoom;return retVal&&(retVal=tunedWhileZoomed,tunedWhileZoomed=!1),retVal}return!1},zoomLevel=function(){var zoomStack=activePlot._Mx.stk;return zoomStack.length},dragSelect=function(button){switch(RUBBERBOX_ACTION){case"select":return 1===button&&scope.ctrlKeyPressed;case"zoom":return 1===button&&!scope.ctrlKeyPressed;default:return!1}};scope.$watch("form.frequency",function(freq){target_freq=1e6*parseFloat(freq)}),scope.tuneContext&&(scope.tuneContext.handleTune=function(){var bounds=currentZoomBounds();target_freq-nb_bw/2>=Math.max(bounds.xmin,scope.tuneContext.minWidebandSpectrum)&&target_freq+nb_bw/2<=Math.min(bounds.xmax,scope.tuneContext.maxWidebandSpectrum)?rf_cf-nb_bw/2<bounds.xmin||rf_cf+nb_bw/2>bounds.xmax?(rf_cf=target_freq,if_cf=0):if_cf=target_freq-rf_cf:(rf_cf=target_freq,if_cf=0),scope.doTune({rf_cf:rf_cf,if_cf:if_cf}),showHighlight(rf_cf),leftButton&&rightButton&&updateButtons()});var reloadSri,mode,lastDataSize,inAccordionBounds=function(x){if(accordion){var min=accordion.get_center()-nb_bw/2,max=accordion.get_center()+nb_bw/2;return x>=min&&max>=x}return!1},inPlotBounds=function(x,y){var bounds=currentZoomBounds(),xmin=bounds.xmin,xmax=bounds.xmax,ymin=bounds.ymin,ymax=bounds.ymax;return x>=xmax||xmin>=x||y>=ymax||ymin>=y?!1:!0},currentZoomBounds=function(){return activePlot._Mx.stk[activePlot._Mx.stk.length-1]},plotMDownListener=function(event){return inAccordionBounds(event.x)&&1===event.which?(accordionDrag=!0,activePlot.change_settings({rubberbox_action:""}),activePlot.addListener("mmove",accordionMoveListener),ghostAccordion.set_center(event.x),void ghostAccordion.set_visible(!0)):(lastMouseDown.x=event.x,void(lastMouseDown.y=event.y))},plotMupListener=function(event){if(scope.url.indexOf("psd/wideband")>=0){var lBounds=leftButton.bounds(),rBounds=rightButton.bounds();if(inRectangle(lBounds,event.xpos,event.ypos)||inRectangle(rBounds,event.xpos,event.ypos))return;if(ghostAccordion.set_visible(!1),accordionDrag&&(1===event.which||lastUnzoomAfterTune(event.which)))return stopPan(),target_freq=event.x,scope.tuneContext.handleTune(),accordionDrag=!1,activePlot.removeListener("mmove",accordionMoveListener),void activePlot.change_settings({rubberbox_action:RUBBERBOX_ACTION})}Math.abs(event.x-lastMouseDown.x)<=clickTolerance&&(1===event.which||lastUnzoomAfterTune(event.which))?inPlotBounds(event.x,event.y)&&!scope.ctrlKeyPressed&&(console.log("Tuned to "+event.x/1e3+" KHz"),zoomLevel()>2&&(tunedWhileZoomed=!0),target_freq=event.x,3===event.which&&(target_freq=rf_cf+if_cf,activePlot.refresh()),scope.tuneContext&&scope.tuneContext.handleTune()):Math.abs(event.x-lastMouseDown.x)>=clickTolerance&&dragSelect(event.which)},accordionMoveListener=function(event){accordion.set_center(event.x),accordion.set_width(nb_bw);var boundaryProximity=plotBoundary(event);switch(boundaryProximity){case 0:pan_control="left_fast",doPan(event);break;case 1:pan_control="left",doPan(event);break;case 2:pan_control="right",doPan(event);break;case 3:pan_control="right_fast",doPan(event);break;default:pan_control="",stopPan()}},doPan=function(event){accordion.set_mode("relative");var bounds=currentZoomBounds();accordion.set_center((event.xpos-bounds.x1)/(bounds.x2-bounds.x1)),accordion.set_width(nb_bw/(currentZoomBounds().xmax-currentZoomBounds().xmin)),pan||(RedhawkNotificationService.enable(!1),pan=$interval(function(){pan&&("left"===pan_control?(target_freq-=TUNE_STEP,rf_cf=target_freq):"left_fast"===pan_control?(target_freq-=10*TUNE_STEP,rf_cf=target_freq):"right"===pan_control?(target_freq+=TUNE_STEP,rf_cf=target_freq):"right_fast"===pan_control&&(target_freq+=10*TUNE_STEP,rf_cf=target_freq),if_cf=0,scope.tuneContext.handleTune())},STEP_DELAY))},stopPan=function(){pan&&($interval.cancel(pan),pan=void 0,RedhawkNotificationService.enable(!0),accordion.set_mode("absolute"))},showHighlight=function(cf){pan||(scope.url.indexOf("psd/narrowband")>=0?cf=0:cf+=if_cf,activePlot&&void 0!==cf&&activePlot.get_layer(activePlotLayer)&&(scope.url.indexOf("psd/wideband")>=0||scope.url.indexOf("psd/narrowband")>=0)&&(scope.url.indexOf("psd/narrowband")>=0?(activePlot.get_layer(activePlotLayer).remove_highlight("subBand"),activePlot.get_layer(activePlotLayer).add_highlight({xstart:cf-nb_bw/2,xend:cf+nb_bw/2,color:"rgba(255,50,50,1)",id:"subBand"})):accordion&&(accordion.set_center(cf),accordion.set_width(nb_bw))))},lastXStart=-1,updatePlotSettings=function(data){var isDirty=!1;rf_cf=data.keywords.CHAN_RF;var xstart=data.xstart;switch(Math.abs(lastXStart-xstart)>0&&(lastXStart=xstart,showHighlight(rf_cf),isDirty=!0),angular.forEach(data,function(item,key){angular.isDefined(scope.plotSettings[key])&&!angular.equals(scope.plotSettings[key],item)&&("ydelta"!==key||0!==item)&&(scope.plotSettings[key]=item,isDirty=!0,console.log("Plot New SRI: "+key+" changed from "+scope.plotSettings[key]+" to "+item)),angular.isDefined(scope.rasterSettings[key])&&!angular.equals(scope.rasterSettings[key],item)&&("ydelta"!==key||0!==item)&&(scope.rasterSettings[key]=item,isDirty=!0,console.log("Raster New SRI: "+key+" changed from "+scope.rasterSettings[key]+" to "+item))}),data.ydelta||(scope.plotSettings.ydelta!=scope.plotSettings.xdelta*scope.plotSettings.subsize&&(scope.plotSettings.ydelta=scope.plotSettings.xdelta*scope.plotSettings.subsize,isDirty=!0),scope.rasterSettings.ydelta!=scope.rasterSettings.xdelta*scope.rasterSettings.subsize&&(scope.rasterSettings.ydelta=scope.rasterSettings.xdelta*scope.rasterSettings.subsize,isDirty=!0)),scope.plotSettings.size=1,scope.rasterSettings.size=1,data.mode){case 0:mode="S";break;case 1:mode="C"}if(mode){var format="";switch(scope.type){case"float":format=mode+"F";break;case"double":format=mode+"D";break;case"short":format=mode+"I"}scope.plotSettings.format!==format&&(scope.plotSettings.format=format,isDirty=!0),scope.rasterSettings.format!==format&&(scope.rasterSettings.format=format,isDirty=!0),showHighlight(rf_cf)}isDirty&&(reloadSri=!0)},on_sri=function(sri){updatePlotSettings(sri)},dataConverter=plotDataConverter(scope.type),on_data=function(data){var bpa;switch(scope.type){case"double":bpa=2;break;case"float":bpa=4;break;case"short":bpa=2;break;default:return}var ape;switch(mode){case"S":ape=1;break;case"C":ape=2;break;default:return}var array=dataConverter(data);lastDataSize=array.length,activePlot&&reloadPlots(array)},reloadPlots=function(data){"line"===scope.plotType&&void 0===activePlotLayer?(overlayPlot(scope.plotSettings),scope.tuneContext&&(setPlotBounds(),scope.tuneContext.handleTune())):"dots"===scope.plotType&&void 0===activePlotLayer?overlayPlot(scope.plotSettings,angular.extend(plotOptions,{line:0,radius:1,symbol:1})):"raster"===scope.plotType&&void 0===activePlotLayer&&(angular.extend(scope.rasterSettings,{yunits:1}),overlayRaster(scope.rasterSettings,rasterOptions),scope.tuneContext&&(setPlotBounds(),scope.tuneContext.handleTune())),reloadSri?(plot&&void 0!==activePlotLayer&&(plot.reload(activePlotLayer,data,scope.plotSettings),plot.refresh()),raster&&void 0!==activePlotLayer&&(raster.push(activePlotLayer,data,angular.copy(angular.extend(scope.rasterSettings))),raster.refresh()),reloadSri=!1):(plot&&void 0!==activePlotLayer&&(plot.reload(activePlotLayer,data),plot.refresh()),raster&&void 0!==activePlotLayer&&(raster.push(activePlotLayer,data),raster.refresh()))};on_data&&plotSocket.addBinaryListener(on_data),on_sri&&plotSocket.addJSONListener(on_sri),plotSocket.connect(scope.url,function(){console.log("Connected to Plot at "+scope.url)}),scope.$on("$destroy",function(){plotSocket.close()})}}}]);var ArrayBuffer,ArrayBufferView,Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,DataView;!function(){function d(){throw document&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}function a(e){if(Object.getOwnPropertyNames&&Object.defineProperty){var s,r=Object.getOwnPropertyNames(e);for(s=0;s<r.length;s+=1)Object.defineProperty(e,r[s],{value:e[r[s]],writable:!1,enumerable:!1,configurable:!1})}}function c(e){function r(s){Object.defineProperty(e,s,{get:function(){return e._getter(s)},set:function(r){e._setter(s,r)},enumerable:!0,configurable:!1})}if(Object.defineProperty){var s;for(s=0;s<e.length;s+=1)r(s)}}function y(e){return[255&e]}function t(e){return v(e[0],8)}function g(e){return[255&e]}function k(e){return r(e[0],8)}function f(e){return[e>>8&255,255&e]}function n(e){return v(e[0]<<8|e[1],16)}function l(e){return[e>>8&255,255&e]}function F(e){return r(e[0]<<8|e[1],16)}function w(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function z(e){return v(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function D(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function A(e){return r(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function E(e){var r=[];for(e=e.join("");e.length;)r.push(parseInt(e.substring(0,8),2)),e=e.substring(8);return r}function J(e){var s,x,r=[];for(s=e.length;s;s-=1)for(b=e[s-1],x=8;x;x-=1)r.push(b%2?1:0),b>>=1;return r.reverse(),r}function Q(e){return[255&e]}function U(e){return v(e[0],8)}function M(e){return[255&e]}function N(e){return r(e[0],8)}function G(e){return[255&e,e>>8&255]}function T(e){return v(e[1]<<8|e[0],16)}function e(e){return[255&e,e>>8&255]}function x(e){return r(e[1]<<8|e[0],16)}function B(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function C(e){return v(e[3]<<24|e[2]<<16|e[1]<<8|e[0],32)}function q(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function h(e){return r(e[3]<<24|e[2]<<16|e[1]<<8|e[0],32)}function X(e){var r=[];for(e=e.join("");e.length;)r.push(parseInt(e.substring(e.length-8,e.length),2)),e=e.substring(0,e.length-8);return r}function Y(e){var s,x,r=[];for(s=0;s<e.length;s++)for(b=e[s],x=8;x;x-=1)r.push(b%2?1:0),b>>=1;return r.reverse(),r}function v(e,r){var s=32-r;return e<<s>>s}function r(e,r){var s=32-r;return e<<s>>>s}function s(e,r,s){var p,a,u,x=(1<<r-1)-1;for(isNaN(e)?(a=(1<<x)-1,x=Math.pow(2,s-1),p=0):1/0===e||-1/0===e?(a=(1<<x)-1,x=0,p=0>e?1:0):0===e?(x=a=0,p=-1/0===1/e?1:0):(p=0>e,e=Math.abs(e),e>=Math.pow(2,1-x)?(u=Math.min(Math.floor(Math.log(e)/Math.LN2),x),a=u+x,x=Math.round(e*Math.pow(2,s-u)-Math.pow(2,s))):(a=0,x=Math.round(e/Math.pow(2,1-x-s)))),e=[];s;s-=1)e.push(x%2?1:0),x=Math.floor(x/2);for(s=r;s;s-=1)e.push(a%2?1:0),a=Math.floor(a/2);return e.push(p?1:0),e.reverse(),Z(e)}function u(e,r,s){var p,a,x=[],x=$(e);return p=x.join(""),e=(1<<r-1)-1,x=parseInt(p.substring(0,1),2)?-1:1,a=parseInt(p.substring(1,1+r),2),p=parseInt(p.substring(1+r),2),a===(1<<r)-1?0!==p?0/0:1/0*x:a>0?x*Math.pow(2,a-e)*(1+p/Math.pow(2,s)):0!==p?x*Math.pow(2,-(e-1))*(p/Math.pow(2,s)):0>x?-0:0}function p(e){return u(e,11,52)}function H(e){return s(e,11,52)}function I(e){return u(e,8,23)}function O(e){return s(e,8,23)}var K={ToInt32:function(e){return e>>0},ToUint32:function(e){return e>>>0}};Object.prototype.__defineGetter__&&!Object.defineProperty&&(Object.defineProperty=function(e,r,s){s.hasOwnProperty("get")&&e.__defineGetter__(r,s.get),s.hasOwnProperty("set")&&e.__defineSetter__(r,s.set)});var aa=window.BIG_ENDIAN_ARRAYBUFFERS?y:Q,V=window.BIG_ENDIAN_ARRAYBUFFERS?t:U,ba=window.BIG_ENDIAN_ARRAYBUFFERS?g:M,L=window.BIG_ENDIAN_ARRAYBUFFERS?k:N,P=window.BIG_ENDIAN_ARRAYBUFFERS?f:G,ca=window.BIG_ENDIAN_ARRAYBUFFERS?n:T,da=window.BIG_ENDIAN_ARRAYBUFFERS?l:e,R=window.BIG_ENDIAN_ARRAYBUFFERS?F:x,ea=window.BIG_ENDIAN_ARRAYBUFFERS?w:B,fa=window.BIG_ENDIAN_ARRAYBUFFERS?z:C,ga=window.BIG_ENDIAN_ARRAYBUFFERS?D:q,ha=window.BIG_ENDIAN_ARRAYBUFFERS?A:h,Z=window.BIG_ENDIAN_ARRAYBUFFERS?E:X,$=window.BIG_ENDIAN_ARRAYBUFFERS?J:Y;ArrayBuffer||function(){function e(r,s,x){var p;return p=function(e,r,s){var x,u,B;if(arguments.length&&"number"!=typeof arguments[0])if("object"==typeof arguments[0]&&arguments[0].constructor===p)for(x=arguments[0],this.length=x.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),u=this.byteOffset=0;u<this.length;u+=1)this._setter(u,x._getter(u));else if("object"!=typeof arguments[0]||arguments[0]instanceof ArrayBuffer){if(!("object"==typeof arguments[0]&&arguments[0]instanceof ArrayBuffer))throw new TypeError("Unexpected argument type(s)");if(this.buffer=e,this.byteOffset=K.ToUint32(r),this.byteOffset>this.buffer.byteLength&&d(),this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");3>arguments.length?(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT&&d(),this.length=this.byteLength/this.BYTES_PER_ELEMENT):(this.length=K.ToUint32(s),this.byteLength=this.length*this.BYTES_PER_ELEMENT),this.byteOffset+this.byteLength>this.buffer.byteLength&&d()}else for(x=arguments[0],this.length=K.ToUint32(x.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),u=this.byteOffset=0;u<this.length;u+=1)B=x[u],this._setter(u,Number(B));else{if(this.length=K.ToInt32(arguments[0]),0>s)throw new RangeError("ArrayBufferView size is not a small enough positive integer.");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),this.byteOffset=0}this.constructor=p,a(this),c(this)},p.prototype=new ArrayBufferView,p.prototype.BYTES_PER_ELEMENT=r,p.prototype.emulated=!0,p.prototype._pack=s,p.prototype._unpack=x,p.BYTES_PER_ELEMENT=r,p.prototype._getter=function(e){if(1>arguments.length)throw new SyntaxError("Not enough arguments");if(e=K.ToUint32(e),!(e>=this.length)){var s,x,r=[];for(s=0,x=this.byteOffset+e*this.BYTES_PER_ELEMENT;s<this.BYTES_PER_ELEMENT;s+=1,x+=1)r.push(this.buffer._bytes[x]);return this._unpack(r)}},p.prototype.get=p.prototype._getter,p.prototype._setter=function(e,r){if(2>arguments.length)throw new SyntaxError("Not enough arguments");if(e=K.ToUint32(e),!(e>=this.length)){var x,p,s=this._pack(r);for(x=0,p=this.byteOffset+e*this.BYTES_PER_ELEMENT;x<this.BYTES_PER_ELEMENT;x+=1,p+=1)this.buffer._bytes[p]=s[x]}},p.prototype.set=function(){if(1>arguments.length)throw new SyntaxError("Not enough arguments");var s,x,p,a,u,c;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor)if(s=arguments[0],x=K.ToUint32(arguments[1]),x+s.length>this.length&&d(),c=this.byteOffset+x*this.BYTES_PER_ELEMENT,x=s.length*this.BYTES_PER_ELEMENT,s.buffer===this.buffer){for(p=[],a=0,u=s.byteOffset;x>a;a+=1,u+=1)p[a]=s.buffer._bytes[u];for(a=0;x>a;a+=1,c+=1)this.buffer._bytes[c]=p[a]}else for(a=0,u=s.byteOffset;x>a;a+=1,u+=1,c+=1)this.buffer._bytes[c]=s.buffer._bytes[u];else{if("object"!=typeof arguments[0]||"undefined"==typeof arguments[0].length)throw new TypeError("Unexpected argument type(s)");for(s=arguments[0],p=K.ToUint32(s.length),x=K.ToUint32(arguments[1]),x+p>this.length&&d(),a=0;p>a;a+=1)u=s[a],this._setter(x+a,Number(u))}},p.prototype.subarray=function(e,r){e=K.ToInt32(e),r=K.ToInt32(r),1>arguments.length&&(e=0),2>arguments.length&&(r=this.length),0>e&&(e=this.length+e),0>r&&(r=this.length+r);var s=this.length;return e=0>e?0:e>s?s:e,s=this.length,s=(0>r?0:r>s?s:r)-e,0>s&&(s=0),new this.constructor(this.buffer,e*this.BYTES_PER_ELEMENT,s)},p}ArrayBuffer=function(e){if(e=K.ToInt32(e),0>e)throw new RangeError("ArrayBuffer size is not a small enough positive integer.");for(this.byteLength=e,this._bytes=[],this._bytes.length=e,e=0;e<this.byteLength;e+=1)this._bytes[e]=0;a(this)},ArrayBuffer.isNative=!1,ArrayBufferView=function(){},Int8Array=Int8Array||e(1,aa,V),Uint8Array=Uint8Array||e(1,ba,L),Int16Array=Int16Array||e(2,P,ca),Uint16Array=Uint16Array||e(2,da,R),Int32Array=Int32Array||e(4,ea,fa),Uint32Array=Uint32Array||e(4,ga,ha),Float32Array=Float32Array||e(4,O,I),Float64Array=Float64Array||e(8,H,p)}(),DataView||function(){function e(r,s){return"function"==typeof r.get?r.get(s):r[s]}function r(s){return function(r,p){r=K.ToUint32(r),r+s.BYTES_PER_ELEMENT>this.byteLength&&d(),r+=this.byteOffset;var c,a=new Uint8Array(this.buffer,r,s.BYTES_PER_ELEMENT),u=[];for(c=0;c<s.BYTES_PER_ELEMENT;c+=1)u.push(e(a,c));return Boolean(p)===Boolean(x)&&u.reverse(),e(new s(new Uint8Array(u).buffer),0)}}function s(r){return function(s,p,a){s=K.ToUint32(s),s+r.BYTES_PER_ELEMENT>this.byteLength&&d(),p=new r([p]),p=new Uint8Array(p.buffer);var c,u=[];for(c=0;c<r.BYTES_PER_ELEMENT;c+=1)u.push(e(p,c));Boolean(a)===Boolean(x)&&u.reverse(),new Uint8Array(this.buffer,s,r.BYTES_PER_ELEMENT).set(u)}}var x=function(){var r=new Uint16Array([4660]),r=new Uint8Array(r.buffer);return 18===e(r,0)}();DataView=function(e,r,s){if(!("object"==typeof e&&e instanceof ArrayBuffer))throw new TypeError("TypeError");this.buffer=e,this.byteOffset=K.ToUint32(r),this.byteOffset>this.buffer.byteLength&&d(),this.byteLength=3>arguments.length?this.buffer.byteLength-this.byteOffset:K.ToUint32(s),this.byteOffset+this.byteLength>this.buffer.byteLength&&d(),a(this)},ArrayBufferView&&(DataView.prototype=new ArrayBufferView),DataView.prototype.getUint8=r(Uint8Array),DataView.prototype.getInt8=r(Int8Array),DataView.prototype.getUint16=r(Uint16Array),DataView.prototype.getInt16=r(Int16Array),DataView.prototype.getUint32=r(Uint32Array),DataView.prototype.getInt32=r(Int32Array),DataView.prototype.getFloat32=r(Float32Array),DataView.prototype.getFloat64=r(Float64Array),DataView.prototype.setUint8=s(Uint8Array),DataView.prototype.setInt8=s(Int8Array),DataView.prototype.setUint16=s(Uint16Array),DataView.prototype.setInt16=s(Int16Array),DataView.prototype.setUint32=s(Uint32Array),DataView.prototype.setInt32=s(Int32Array),DataView.prototype.setFloat32=s(Float32Array),DataView.prototype.setFloat64=s(Float64Array)}()}(),window.ArrayBuffer&&!ArrayBuffer.prototype.slice&&(ArrayBuffer.prototype.slice=function(d,a){var c=new Uint8Array(this);void 0===a&&(a=c.length);for(var y=new ArrayBuffer(a-d),t=new Uint8Array(y),g=0;g<t.length;g++)t[g]=c[g+d];return y}),Array.prototype.remove=function(d,a){var c=this.slice((a||d)+1||this.length);return this.length=0>d?this.length+d:d,this.push.apply(this,c)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCanelAnimationFrame||function(a){window.clearTimeout(a)}}(),Array.isArray||(Array.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)}),window.Float64Array||(window.Float64Array=function(){return window.Float64Array||function(d,a,c){if(!(d instanceof ArrayBuffer))throw"Invalid type";var y=new DataView(d),t=[];for(d=(d.byteLength-a)/8,t.length=void 0===c?d:Math.min(c,d),c=0;c<t.length;c++)t[c]=y.getFloat64(8*c+a,!0);return t.subarray=function(a,c){return t.slice(a,c)},t}}()),function(){var d=function(){};if(window.console||(window.console={log:d,info:d,warn:d,debug:d,error:d}),new Int8Array([0,1,0]).subarray(1).subarray(1)[0]){var a=function(a,d){return 0===arguments.length?(a=0,d=this.length):(0>a&&(a+=this.length),a=Math.max(0,Math.min(this.length,a)),1===arguments.length?d=this.length:(0>d&&(d+=this.length),d=Math.max(a,Math.min(this.length,d)))),new this.constructor(this.buffer,this.byteOffset+a*this.BYTES_PER_ELEMENT,d-a)};[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].forEach(function(c){c.prototype.subarray=a})}}(),function(d,a){function c(a,c,n,l){a[t](y+c,"wheel"===g?n:function(a){!a&&(a=d.event);var c={originalEvent:a,target:a.target||a.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===a.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){a.preventDefault?a.preventDefault():a.returnValue=!1}};return"mousewheel"===g?(c.deltaY=-.025*a.wheelDelta,a.wheelDeltaX&&(c.deltaX=-.025*a.wheelDeltaX)):c.deltaY=a.detail,n(c)},l||!1)}var t,g,y="";d.addEventListener?t="addEventListener":(t="attachEvent",y="on"),g="onwheel"in a.createElement("div")?"wheel":void 0!==a.onmousewheel?"mousewheel":"DOMMouseScroll",d.addWheelListener=function(a,d,n){c(a,g,d,n),"DOMMouseScroll"===g&&c(a,"MozMousePixelScroll",d,n)}}(window,document),function(d){function a(a){if(a=new Uint8Array(a),F)return String.fromCharCode.apply(null,a);for(var c="",d=0;d<a.length;d++)c+=String.fromCharCode(a[d]);return c}function c(c){if(this.file_name=this.file=null,this.offset=0,this.buf=c,null!=this.buf){c=new DataView(this.buf),this.version=a(this.buf.slice(0,4)),this.headrep=a(this.buf.slice(4,8)),this.datarep=a(this.buf.slice(8,12));var d="EEEI"===this.headrep,g="EEEI"===this.datarep;this.type=c.getUint32(48,d),this["class"]=this.type/1e3,this.format=a(this.buf.slice(52,54)),this.timecode=c.getFloat64(56,d),1===this["class"]?(this.xstart=c.getFloat64(256,d),this.xdelta=c.getFloat64(264,d),this.xunits=c.getInt32(272,d),this.yunits=c.getInt32(296,d),this.subsize=1):2===this["class"]&&(this.xstart=c.getFloat64(256,d),this.xdelta=c.getFloat64(264,d),this.xunits=c.getInt32(272,d),this.subsize=c.getInt32(276,d),this.ystart=c.getFloat64(280,d),this.ydelta=c.getFloat64(288,d),this.yunits=c.getInt32(296,d)),this.data_start=c.getFloat64(32,d),this.data_size=c.getFloat64(40,d),this.setData(this.buf,this.data_start,this.data_start+this.data_size,g)}}function y(a){var c=document.createElement("a");c.href=a;for(var e,d=c.protocol.replace(":",""),g=c.hostname,k=c.port,f=c.search,l={},n=c.search.replace(/^\?/,"").split("&"),G=n.length,t=0;G>t;t++)n[t]&&(e=n[t].split("="),l[e[0]]=e[1]);return{source:a,protocol:d,host:g,port:k,query:f,params:l,file:(c.pathname.match(/\/([^\/?#]+)$/i)||[null,""])[1],hash:c.hash.replace("#",""),path:c.pathname.replace(/^([^\/])/,"/$1"),relative:(c.href.match(/tps?:\/\/[^\/]+(.+)/)||[null,""])[1],segments:c.pathname.replace(/^\//,"").split("/")}
}function t(a,c,d){d=d||1024;var g=0,k=new ArrayBuffer(a.length),f=new Uint8Array(k),l=function(){for(var n=g+d;n>g;g++)f[g]=255&a.charCodeAt(g);g>=a.length?c(k):setTimeout(l,0)};setTimeout(l,0)}function g(a){this.options=a}navigator.userAgent.match(/(iPad|iPhone|iPod)/i);var k=function(){var a=new ArrayBuffer(4),c=new Uint32Array(a),a=new Uint8Array(a);if(c[0]=3735928559,239===a[0])return"LE";if(222===a[0])return"BE";throw Error("unknown endianness")}(),f={S:1,C:2,V:3,Q:4,M:9,X:10,T:16,U:1,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},n={P:.125,A:1,O:1,B:1,I:2,L:4,X:8,F:4,D:8},l={P:null,A:null,O:Uint8Array,B:Int8Array,I:Int16Array,L:Int32Array,X:null,F:Float32Array,D:Float64Array},F=!0;try{var w=new UInt8Array(new ArrayBuffer(4));w[0]=66,w[1]=76,w[2]=85,w[3]=69,"BLUE"!==String.fromCharCode.apply(null,w)&&(F=!1)}catch(z){F=!1}c.prototype={setData:function(a,c,d,g){if(1===this["class"]?(this.spa=f[this.format[0]],this.bps=n[this.format[1]],this.bpa=this.spa*this.bps,this.ape=1,this.bpe=this.ape*this.bpa):2===this["class"]&&(this.spa=f[this.format[0]],this.bps=n[this.format[1]],this.bpa=this.spa*this.bps,this.ape=this.subsize,this.bpe=this.ape*this.bpa),void 0===g&&(g="LE"===k),"LE"===k&&!g)throw"Not supported "+k+" "+g;if("BE"===k&&this.littleEndianData)throw"Not supported "+k+" "+g;a?(this.dview=c&&d?this.createArray(a,c,(d-c)/this.bps):this.createArray(a),this.size=this.dview.length/(this.spa*this.ape)):this.dview=this.createArray(null,null,this.size)},createArray:function(a,c,d){var g=l[this.format[1]];if(void 0===g)throw"unknown format "+this.format[1];return void 0===c&&(c=0),void 0===d&&(d=a.length||a.byteLength/n[this.format[1]]),a?new g(a,c,d):new g(d)}},g.prototype={readheader:function(a,d){var g=new FileReader,k=a.webkitSlice(0,512);g.onloadend=function(a){return function(k){k.target.error?d(null):(k=new c(g.result),k.file=a,d(k))}}(a),g.readAsArrayBuffer(k)},read:function(a,d){var g=new FileReader;g.onloadend=function(a){return function(k){k.target.error?d(null):(k=new c(g.result),k.file=a,k.file_name=a.name,d(k))}}(a),g.readAsArrayBuffer(a)},read_http:function(a,d){var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.overrideMimeType("text/plain; charset=x-user-defined"),g.onload=function(k){if(4!==g.readyState||200!==g.status&&0!==g.status)d(null);else if(k=null,g.response){k=g.response,k=new c(k),y(a);var f=y(a);k.file_name=f.file,d(k)}else g.responseText&&t(g.responseText,function(g){g=new c(g),y(a);var k=y(a);g.file_name=k.file,d(g)})},g.onerror=function(){d(null)},g.send(null)}},d.BlueHeader=d.BlueHeader||c,d.BlueFileReader=d.BlueFileReader||g}(this),function(d){function a(d,l){if(d=d?d:"",l=l||{},"object"==typeof d&&d.hasOwnProperty("_tc_id"))return d;var e=c(d),x=e.r,B=e.g,C=e.b,q=e.a,h=A(100*q)/100,X=l.format||e.format;return 1>x&&(x=A(x)),1>B&&(B=A(B)),1>C&&(C=A(C)),{ok:e.ok,format:X,_tc_id:z++,alpha:q,toHsv:function(){var e=g(x,B,C);return{h:360*e.h,s:e.s,v:e.v,a:q}},toHsvString:function(){var e=g(x,B,C),a=A(360*e.h),r=A(100*e.s),e=A(100*e.v);return 1==q?"hsv("+a+", "+r+"%, "+e+"%)":"hsva("+a+", "+r+"%, "+e+"%, "+h+")"},toHsl:function(){var e=y(x,B,C);return{h:360*e.h,s:e.s,l:e.l,a:q}},toHslString:function(){var e=y(x,B,C),a=A(360*e.h),r=A(100*e.s),e=A(100*e.l);return 1==q?"hsl("+a+", "+r+"%, "+e+"%)":"hsla("+a+", "+r+"%, "+e+"%, "+h+")"},toHex:function(e){return k(x,B,C,e)},toHexString:function(e){return"#"+k(x,B,C,e)},toRgb:function(){return{r:A(x),g:A(B),b:A(C),a:q}},toRgbString:function(){return 1==q?"rgb("+A(x)+", "+A(B)+", "+A(C)+")":"rgba("+A(x)+", "+A(B)+", "+A(C)+", "+h+")"},toPercentageRgb:function(){return{r:A(100*f(x,255))+"%",g:A(100*f(B,255))+"%",b:A(100*f(C,255))+"%",a:q}},toPercentageRgbString:function(){return 1==q?"rgb("+A(100*f(x,255))+"%, "+A(100*f(B,255))+"%, "+A(100*f(C,255))+"%)":"rgba("+A(100*f(x,255))+"%, "+A(100*f(B,255))+"%, "+A(100*f(C,255))+"%, "+h+")"},toName:function(){return 0===q?"transparent":M[k(x,B,C,!0)]||!1},toFilter:function(e){var c=k(x,B,C),r=c,s=Math.round(255*parseFloat(q)).toString(16),u=s,p=l&&l.gradientType?"GradientType = 1, ":"";return e&&(e=a(e),r=e.toHex(),u=Math.round(255*parseFloat(e.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+p+"startColorstr=#"+n(s)+c+",endColorstr=#"+n(u)+r+")"},toString:function(e){var x=!!e;e=e||this.format;var r=!1,x=!x&&1>q&&q>0&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return"rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),x?this.toRgbString():r||this.toHexString()}}}function c(a){var c={r:0,g:0,b:0},e=1,x=!1,B=!1;if("string"==typeof a)a:{a=a.replace(F,"").replace(w,"").toLowerCase();var d=!1;if(U[a])a=U[a],d=!0;else if("transparent"==a){a={r:0,g:0,b:0,a:0,format:"name"};break a}var q;a=(q=N.rgb.exec(a))?{r:q[1],g:q[2],b:q[3]}:(q=N.rgba.exec(a))?{r:q[1],g:q[2],b:q[3],a:q[4]}:(q=N.hsl.exec(a))?{h:q[1],s:q[2],l:q[3]}:(q=N.hsla.exec(a))?{h:q[1],s:q[2],l:q[3],a:q[4]}:(q=N.hsv.exec(a))?{h:q[1],s:q[2],v:q[3]}:(q=N.hex6.exec(a))?{r:parseInt(q[1],16),g:parseInt(q[2],16),b:parseInt(q[3],16),format:d?"name":"hex"}:(q=N.hex3.exec(a))?{r:parseInt(q[1]+""+q[1],16),g:parseInt(q[2]+""+q[2],16),b:parseInt(q[3]+""+q[3],16),format:d?"name":"hex"}:!1}if("object"==typeof a){if(a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b"))c=a.g,x=a.b,c={r:255*f(a.r,255),g:255*f(c,255),b:255*f(x,255)},x=!0,B="%"===String(a.r).substr(-1)?"prgb":"rgb";else if(a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("v")){a.s=l(a.s),a.v=l(a.v);var B=a.h,d=a.s,c=a.v,B=6*f(B,360),d=f(d,100),c=f(c,100),x=D.floor(B),h=B-x,B=c*(1-d);q=c*(1-h*d),d=c*(1-(1-h)*d),x%=6,c={r:255*[c,q,B,B,d,c][x],g:255*[d,c,c,q,B,B][x],b:255*[B,B,d,c,c,q][x]},x=!0,B="hsv"}else a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("l")&&(a.s=l(a.s),a.l=l(a.l),c=t(a.h,a.s,a.l),x=!0,B="hsl");a.hasOwnProperty("a")&&(e=a.a)}return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),{ok:x,format:a.format||B,r:E(255,J(c.r,0)),g:E(255,J(c.g,0)),b:E(255,J(c.b,0)),a:e}}function y(a,c,e){a=f(a,255),c=f(c,255),e=f(e,255);var d,x=J(a,c,e),B=E(a,c,e),q=(x+B)/2;if(x==B)d=B=0;else{var h=x-B,B=q>.5?h/(2-x-B):h/(x+B);switch(x){case a:d=(c-e)/h+(e>c?6:0);break;case c:d=(e-a)/h+2;break;case e:d=(a-c)/h+4}d/=6}return{h:d,s:B,l:q}}function t(a,c,e){function x(e,x,a){return 0>a&&(a+=1),a>1&&(a-=1),1/6>a?e+6*(x-e)*a:.5>a?x:2/3>a?e+(x-e)*(2/3-a)*6:e}if(a=f(a,360),c=f(c,100),e=f(e,100),0===c)e=c=a=e;else{var B=.5>e?e*(1+c):e+c-e*c,d=2*e-B;e=x(d,B,a+1/3),c=x(d,B,a),a=x(d,B,a-1/3)}return{r:255*e,g:255*c,b:255*a}}function g(a,c,e){a=f(a,255),c=f(c,255),e=f(e,255);var d,x=J(a,c,e),B=E(a,c,e),q=x-B;if(x==B)d=0;else{switch(x){case a:d=(c-e)/q+(e>c?6:0);break;case c:d=(e-a)/q+2;break;case e:d=(a-c)/q+4}d/=6}return{h:d,s:0===x?0:q/x,v:x}}function k(a,c,e,x){return a=[n(A(a).toString(16)),n(A(c).toString(16)),n(A(e).toString(16))],x&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function f(a,c){var e=a;return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)&&(a="100%"),e="string"==typeof a&&-1!=a.indexOf("%"),a=E(c,J(0,parseFloat(a))),e&&(a=parseInt(a*c,10)/100),1e-6>D.abs(a-c)?1:a%c/parseFloat(c)}function n(a){return 1==a.length?"0"+a:""+a}function l(a){return 1>=a&&(a=100*a+"%"),a}var F=/^[\s,#]+/,w=/\s+$/,z=0,D=Math,A=D.round,E=D.min,J=D.max,Q=D.random;a.fromRatio=function(c,d){if("object"==typeof c){var x,e={};for(x in c)c.hasOwnProperty(x)&&(e[x]="a"===x?c[x]:l(c[x]));c=e}return a(c,d)},a.equals=function(c,d){return c&&d?a(c).toRgbString()==a(d).toRgbString():!1},a.random=function(){return a.fromRatio({r:Q(),g:Q(),b:Q()})},a.desaturate=function(c,d){d=0===d?0:d||10;var e=a(c).toHsl();return e.s-=d/100,e.s=E(1,J(0,e.s)),a(e)},a.saturate=function(c,d){d=0===d?0:d||10;var e=a(c).toHsl();return e.s+=d/100,e.s=E(1,J(0,e.s)),a(e)},a.greyscale=function(c){return a.desaturate(c,100)},a.lighten=function(c,d){d=0===d?0:d||10;var e=a(c).toHsl();return e.l+=d/100,e.l=E(1,J(0,e.l)),a(e)},a.darken=function(c,d){d=0===d?0:d||10;var e=a(c).toHsl();return e.l-=d/100,e.l=E(1,J(0,e.l)),a(e)},a.complement=function(c){return c=a(c).toHsl(),c.h=(c.h+180)%360,a(c)},a.triad=function(c){var d=a(c).toHsl(),e=d.h;return[a(c),a({h:(e+120)%360,s:d.s,l:d.l}),a({h:(e+240)%360,s:d.s,l:d.l})]},a.tetrad=function(c){var d=a(c).toHsl(),e=d.h;return[a(c),a({h:(e+90)%360,s:d.s,l:d.l}),a({h:(e+180)%360,s:d.s,l:d.l}),a({h:(e+270)%360,s:d.s,l:d.l})]},a.splitcomplement=function(c){var d=a(c).toHsl(),e=d.h;return[a(c),a({h:(e+72)%360,s:d.s,l:d.l}),a({h:(e+216)%360,s:d.s,l:d.l})]},a.analogous=function(c,d,e){d=d||6,e=e||30;var x=a(c).toHsl();for(e=360/e,c=[a(c)],x.h=(x.h-(e*d>>1)+720)%360;--d;)x.h=(x.h+e)%360,c.push(a(x));return c},a.monochromatic=function(c,d){d=d||6;for(var e=a(c).toHsv(),x=e.h,B=e.s,e=e.v,C=[],q=1/d;d--;)C.push(a({h:x,s:B,v:e})),e=(e+q)%1;return C},a.readability=function(c,d){var e=a(c).toRgb(),x=a(d).toRgb(),B=(299*e.r+587*e.g+114*e.b)/1e3,C=(299*x.r+587*x.g+114*x.b)/1e3,e=Math.max(e.r,x.r)-Math.min(e.r,x.r)+Math.max(e.g,x.g)-Math.min(e.g,x.g)+Math.max(e.b,x.b)-Math.min(e.b,x.b);return{brightness:Math.abs(B-C),color:e}},a.readable=function(c,d){var e=a.readability(c,d);return 125<e.brightness&&500<e.color},a.mostReadable=function(c,d){for(var e=null,x=0,B=!1,C=0;C<d.length;C++){var q=a.readability(c,d[C]),h=125<q.brightness&&500<q.color,q=q.brightness/125*3+q.color/500;(h&&!B||h&&B&&q>x||!h&&!B&&q>x)&&(B=h,x=q,e=a(d[C]))}return e};var U=a.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},M=a.hexNames=function(a){var e,c={};for(e in a)a.hasOwnProperty(e)&&(c[a[e]]=e);return c}(U),N={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};"undefined"!=typeof module&&module.exports?module.exports=a:"undefined"!=typeof define?define(function(){return a}):d.tinycolor=a}(this),function(){var d=[];(window.CanvasInput=function(a){var c=this;a=a?a:{},c._canvas=a.canvas||null,c._ctx=c._canvas?c._canvas.getContext("2d"):null,c._x=a.x||0,c._y=a.y||0,c._extraX=a.extraX||0,c._extraY=a.extraY||0,c._fontSize=a.fontSize||14,c._fontFamily=a.fontFamily||"Arial",c._fontColor=a.fontColor||"#000",c._placeHolderColor=a.placeHolderColor||"#bfbebd",c._fontWeight=a.fontWeight||"normal",c._fontStyle=a.fontStyle||"normal",c._readonly=a.readonly||!1,c._maxlength=a.maxlength||null,c._width=a.width||150,c._height=a.height||c._fontSize,c._padding=0<=a.padding?a.padding:5,c._borderWidth=0<=a.borderWidth?a.borderWidth:1,c._borderColor=a.borderColor||"#959595",c._borderRadius=0<=a.borderRadius?a.borderRadius:3,c._backgroundImage=a.backgroundImage||"",c._boxShadow=a.boxShadow||"1px 1px 0px rgba(255, 255, 255, 1)",c._innerShadow=a.innerShadow||"0px 0px 4px rgba(0, 0, 0, 0.4)",c._selectionColor=a.selectionColor||"rgba(179, 212, 253, 0.8)",c._placeHolder=a.placeHolder||"",c._value=a.value||c._placeHolder,c._onsubmit=a.onsubmit||function(){},c._onkeydown=a.onkeydown||function(){},c._onkeyup=a.onkeyup||function(){},c._onfocus=a.onfocus||function(){},c._onblur=a.onblur||function(){},c._cursor=!1,c._cursorPos=0,c._hasFocus=!1,c._selection=[0,0],c._wasOver=!1,c._renderOnReturn=void 0!==a.renderOnReturn?a.renderOnReturn:!0,c._disableBlur=a.disableBlur||!1,c._tabToClear=a.tabToClear||!1,c.boxShadow(c._boxShadow,!0),c._calcWH(),c._renderCanvas=document.createElement("canvas"),c._renderCanvas.setAttribute("width",c.outerW),c._renderCanvas.setAttribute("height",c.outerH),c._renderCtx=c._renderCanvas.getContext("2d"),c._shadowCanvas=document.createElement("canvas"),c._shadowCanvas.setAttribute("width",c._width+2*c._padding),c._shadowCanvas.setAttribute("height",c._height+2*c._padding),c._shadowCtx=c._shadowCanvas.getContext("2d"),"undefined"!=typeof a.backgroundGradient?(c._backgroundColor=c._renderCtx.createLinearGradient(0,0,0,c.outerH),c._backgroundColor.addColorStop(0,a.backgroundGradient[0]),c._backgroundColor.addColorStop(1,a.backgroundGradient[1])):c._backgroundColor=a.backgroundColor||"#fff",c._canvas&&(c.mousemoveCanvasListener=function(a){a=a||window.event,c.mousemove(a,c)},c._canvas.addEventListener("mousemove",c.mousemoveCanvasListener,!1),c.mousedownCanvasListener=function(a){a=a||window.event,c.mousedown(a,c)},c._canvas.addEventListener("mousedown",c.mousedownCanvasListener,!1),c.mouseupCanvasListener=function(a){a=a||window.event,c.mouseup(a,c)},c._canvas.addEventListener("mouseup",c.mouseupCanvasListener,!1)),c.mouseupWindowListener=function(){c._hasFocus&&!c._mouseDown&&c.blur()},window.addEventListener("mouseup",c.mouseupWindowListener,!0),c.keydownWindowListener=function(a){a=a||window.event,c._hasFocus&&c.keydown(a,c)},window.addEventListener("keydown",c.keydownWindowListener,!1),c.keyupWindowListener=function(a){a=a||window.event,c._hasFocus&&c._onkeyup(a,c)},window.addEventListener("keyup",c.keyupWindowListener,!1),c.pasteWindowListener=function(a){if(a=a||window.event,c._hasFocus){a=a.clipboardData.getData("text/plain");var d=c._value.substr(0,c._cursorPos),g=c._value.substr(c._cursorPos);c._value=d+a+g,c._cursorPos+=a.length,c.render()}},window.addEventListener("paste",c.pasteWindowListener,!1),d.push(c),c._inputsIndex=d.length-1,c.render()}).prototype={canvas:function(a){return"undefined"!=typeof a?(this._canvas=a,this._ctx=this._canvas.getContext("2d"),this.render()):this._canvas},x:function(a){return"undefined"!=typeof a?(this._x=a,this.render()):this._x},y:function(a){return"undefined"!=typeof a?(this._y=a,this.render()):this._y},extraX:function(a){return"undefined"!=typeof a?(this._extraX=a,this.render()):this._extraX},extraY:function(a){return"undefined"!=typeof a?(this._extraY=a,this.render()):this._extraY},fontSize:function(a){return"undefined"!=typeof a?(this._fontSize=a,this.render()):this._fontSize},fontFamily:function(a){return"undefined"!=typeof a?(this._fontFamily=a,this.render()):this._fontFamily},fontColor:function(a){return"undefined"!=typeof a?(this._fontColor=a,this.render()):this._fontColor},placeHolderColor:function(a){return"undefined"!=typeof a?(this._placeHolderColor=a,this.render()):this._placeHolderColor},fontWeight:function(a){return"undefined"!=typeof a?(this._fontWeight=a,this.render()):this._fontWeight},fontStyle:function(a){return"undefined"!=typeof a?(this._fontStyle=a,this.render()):this._fontStyle},width:function(a){return"undefined"!=typeof a?(this._width=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._width},height:function(a){return"undefined"!=typeof a?(this._height=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._height},padding:function(a){return"undefined"!=typeof a?(this._padding=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._padding},borderWidth:function(a){return"undefined"!=typeof a?(this._borderWidth=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._borderWidth},borderColor:function(a){return"undefined"!=typeof a?(this._borderColor=a,this.render()):this._borderColor},borderRadius:function(a){return"undefined"!=typeof a?(this._borderRadius=a,this.render()):this._borderRadius},backgroundColor:function(a){return"undefined"!=typeof a?(this._backgroundColor=a,this.render()):this._backgroundColor},backgroundGradient:function(a){return"undefined"!=typeof a?(this._backgroundColor=this._renderCtx.createLinearGradient(0,0,0,this.outerH),this._backgroundColor.addColorStop(0,a[0]),this._backgroundColor.addColorStop(1,a[1]),this.render()):this._backgroundColor},boxShadow:function(a,c){if("undefined"==typeof a)return this._boxShadow;var d=a.split("px ");return this._boxShadow={x:"none"===this._boxShadow?0:parseInt(d[0],10),y:"none"===this._boxShadow?0:parseInt(d[1],10),blur:"none"===this._boxShadow?0:parseInt(d[2],10),color:"none"===this._boxShadow?"":d[3]},this.shadowL=0>this._boxShadow.x?Math.abs(this._boxShadow.x)+this._boxShadow.blur:Math.abs(this._boxShadow.blur-this._boxShadow.x),this.shadowR=this._boxShadow.blur+this._boxShadow.x,this.shadowT=0>this._boxShadow.y?Math.abs(this._boxShadow.y)+this._boxShadow.blur:Math.abs(this._boxShadow.blur-this._boxShadow.y),this.shadowB=this._boxShadow.blur+this._boxShadow.y,this.shadowW=this.shadowL+this.shadowR,this.shadowH=this.shadowT+this.shadowB,this._calcWH(),c?void 0:(this._updateCanvasWH(),this.render())},innerShadow:function(a){return"undefined"!=typeof a?(this._innerShadow=a,this.render()):this._innerShadow},selectionColor:function(a){return"undefined"!=typeof a?(this._selectionColor=a,this.render()):this._selectionColor},placeHolder:function(a){return"undefined"!=typeof a?(this._placeHolder=a,this.render()):this._placeHolder},value:function(a){return"undefined"!=typeof a?(this._value=a,this.focus()):this._value},onsubmit:function(a){return"undefined"!=typeof a?(this._onsubmit=a,this):void this._onsubmit()},onkeydown:function(a){return"undefined"!=typeof a?(this._onkeydown=a,this):void this._onkeydown()},onkeyup:function(a){return"undefined"!=typeof a?(this._onkeyup=a,this):void this._onkeyup()},focus:function(a){var d,c=this;if(!c._readonly){c._hasFocus||c._onfocus(c),c._selectionUpdated?delete c._selectionUpdated:c._selection=[0,0],c._cursorPos="number"==typeof a?a:c._clipText().length,c._placeHolder===c._value&&(c._value=""),c._hasFocus=!0,c._cursor=!0,c._cursorInterval&&clearInterval(c._cursorInterval),c._cursorInterval=setInterval(function(){c._cursor=!c._cursor,c.render()},500),a=navigator.userAgent.toLowerCase(),a=0<=a.indexOf("chrome")&&0<=a.indexOf("mobile")&&0<=a.indexOf("android");var t="undefined"!=typeof window.orientation;return t&&!a&&document&&document.createElement&&(d=document.createElement("input"))?(d.type="text",d.style.opacity=0,d.style.position="absolute",d.style.left=c._x+c._extraX+(c._canvas?c._canvas.offsetLeft:0)+"px",d.style.top=c._y+c._extraY+(c._canvas?c._canvas.offsetTop:0)+"px",d.style.width=c._width,d.style.height=0,document.body.appendChild(d),d.focus(),d.addEventListener("blur",function(){c.blur(c)},!1)):t&&c.value(prompt(c._placeHolder)||""),c.render()}},blur:function(a){return a=a||this,a._disableBlur||(a._onblur(a),a._cursorInterval&&clearInterval(a._cursorInterval),a._hasFocus=!1,a._cursor=!1,a._selection=[0,0],""===a._value&&(a._value=a._placeHolder)),a.render()},disableBlur:function(a){(a||this)._disableBlur=!0},enableBlur:function(a){(a||this)._disableBlur=!1},keydown:function(a,c){var k,y=a.which,t=a.shiftKey,g=null;if(c._hasFocus){if(c._onkeydown(a,c),65===y&&(a.ctrlKey||a.metaKey))return c._selection=[0,c._value.length],a.preventDefault(),c.render();if(17===y||a.metaKey||a.ctrlKey)return c;if(a.preventDefault(),8===y)!c._clearSelection()&&0<c._cursorPos&&(t=c._value.substr(0,c._cursorPos-1),k=c._value.substr(c._cursorPos,c._value.length),c._value=t+k,c._cursorPos--);else if(37===y)0<c._cursorPos&&(c._cursorPos--,c._cursor=!0,c._selection=[0,0]);else if(39===y)c._cursorPos<c._value.length&&(c._cursorPos++,c._cursor=!0,c._selection=[0,0]);else if(13===y)c._onsubmit(a,c);else if(9===y)if(c._tabToClear)c._value="",c._cursorPos=0;else{var f=d[c._inputsIndex+1]?c._inputsIndex+1:0;f!==c._inputsIndex&&(c.blur(),setTimeout(function(){d[f].focus()},10))}else if(g=c._mapCodeToKey(t,y)){if(c._clearSelection(),c._maxlength&&c._maxlength<=c._value.length)return;t=c._value?c._value.substr(0,c._cursorPos):"",k=c._value?c._value.substr(c._cursorPos):"",c._value=t+g+k,c._cursorPos++}return 13==y&&c._renderOnReturn||13!==y?c.render():function(){}}},click:function(a,c){var d=c._mousePos(a),t=d.x,d=d.y;if(c._endSelection)delete c._endSelection,delete c._selectionUpdated;else{if(!(c._canvas&&c._overInput(t,d)||!c._canvas))return c.blur();if(c._mouseDown)return c._mouseDown=!1,c.click(a,c),c.focus(c._clickPos(t,d))}},mousemove:function(a,c){var d=c._mousePos(a),t=d.x,g=d.y;(d=c._overInput(t,g))&&c._canvas?(c._canvas.style.cursor="text",c._wasOver=!0):c._wasOver&&c._canvas&&(c._canvas.style.cursor="default",c._wasOver=!1),c._hasFocus&&0<=c._selectionStart&&(g=c._clickPos(t,g),t=Math.min(c._selectionStart,g),g=Math.max(c._selectionStart,g),d?(c._selection[0]!==t||c._selection[1]!==g)&&(c._selection=[t,g],c.render()):(c._selectionUpdated=!0,c._endSelection=!0,delete c._selectionStart,c.render()))},mousedown:function(a,c){var d=c._mousePos(a),t=d.x,d=d.y,g=c._overInput(t,d);c._mouseDown=g,c._hasFocus&&g&&(c._selectionStart=c._clickPos(t,d))},mouseup:function(a,c){var d=c._mousePos(a),t=d.x,d=d.y,g=c._clickPos(t,d)!==c._selectionStart;c._hasFocus&&0<=c._selectionStart&&c._overInput(t,d)&&g?(c._selectionUpdated=!0,delete c._selectionStart,c.render()):delete c._selectionStart,c.click(a,c)},renderCanvas:function(){return this._renderCanvas},cleanup:function(){this._canvas.removeEventListener("mouseup",this.mouseupCanvasListener,!1),this._canvas.removeEventListener("mousedown",this.mousedownCanvasListener,!1),this._canvas.removeEventListener("mousemove",this.mousemoveCanvasListener,!1),window.removeEventListener("keydown",this.keydownWindowListener,!1),window.removeEventListener("keyup",this.keyupWindowListener,!1),window.removeEventListener("mouseup",this.mouseupWindowListener,!0),window.removeEventListener("paste",this.pasteWindowListener,!1),clearInterval(this._cursorInterval),this._canvas.style.cursor="default";for(var a=0;a<d.length;a++)d[a]===this&&d.remove(a)},render:function(){var a=this,c=a._renderCtx,d=a.outerW,t=a.outerH,g=a._borderRadius,k=a._borderWidth,f=a.shadowW,n=a.shadowH;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.shadowOffsetX=a._boxShadow.x,c.shadowOffsetY=a._boxShadow.y,c.shadowBlur=a._boxShadow.blur,c.shadowColor=a._boxShadow.color,0<a._borderWidth&&(c.fillStyle=a._borderColor,a._roundedRect(c,a.shadowL,a.shadowT,d-f,t-n,g),c.fill(),c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0),a._drawTextBox(function(){c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0;var l=a._clipText(),F=a._padding+a._borderWidth+a.shadowT;if(0<a._selection[1]){var w=a._textWidth(l.substring(0,a._selection[0])),z=a._textWidth(l.substring(a._selection[0],a._selection[1]));c.fillStyle=a._selectionColor,c.fillRect(F+w,F,z,a._height)}if(c.fillStyle=a._placeHolder===a._value&&""!==a._value?a._placeHolderColor:a._fontColor,a._cursor&&(w=a._textWidth(l.substring(0,a._cursorPos)),c.fillRect(F+w,F,1,a._height)),w=a._padding+a._borderWidth+a.shadowL,F=Math.round(F+a._height/2),c.font=a._fontStyle+" "+a._fontWeight+" "+a._fontSize+"px "+a._fontFamily,c.textAlign="left",c.textBaseline="middle",c.fillText(l,w,F),z=a._innerShadow.split("px "),l="none"===a._innerShadow?0:parseInt(z[0],10),F="none"===a._innerShadow?0:parseInt(z[1],10),w="none"===a._innerShadow?0:parseInt(z[2],10),z="none"===a._innerShadow?"":z[3],w>0){var D=a._shadowCtx,A=D.canvas.width,E=D.canvas.height;D.clearRect(0,0,A,E),D.shadowBlur=w,D.shadowColor=z,D.shadowOffsetX=0,D.shadowOffsetY=F,D.fillRect(-1*d,-100,3*d,100),D.shadowOffsetX=l,D.shadowOffsetY=0,D.fillRect(A,-1*t,100,3*t),D.shadowOffsetX=0,D.shadowOffsetY=F,D.fillRect(-1*d,E,3*d,100),D.shadowOffsetX=l,D.shadowOffsetY=0,D.fillRect(-100,-1*t,100,3*t),a._roundedRect(c,k+a.shadowL,k+a.shadowT,d-2*k-f,t-2*k-n,g),c.clip(),c.drawImage(a._shadowCanvas,0,0,A,E,k+a.shadowL,k+a.shadowT,A,E)}return a._ctx&&(a._ctx.clearRect(a._x,a._y,c.canvas.width,c.canvas.height),a._ctx.drawImage(a._renderCanvas,a._x,a._y)),a})},_drawTextBox:function(a){var c=this,d=c._renderCtx,t=c.outerW,g=c.outerH,k=c._borderRadius,f=c._borderWidth,n=c.shadowW,l=c.shadowH;if(""===c._backgroundImage)d.fillStyle=c._backgroundColor,c._roundedRect(d,f+c.shadowL,f+c.shadowT,t-2*f-n,g-2*f-l,k),d.fill(),a();else{var F=new Image;F.src=c._backgroundImage,F.onload=function(){d.drawImage(F,0,0,F.width,F.height,f+c.shadowL,f+c.shadowT,t,g),a()}}},_clearSelection:function(){if(0<this._selection[1]){var a=this._selection[0],c=this._selection[1];return this._value=this._value.substr(0,a)+this._value.substr(c),this._cursorPos=a,this._cursorPos=0>this._cursorPos?0:this._cursorPos,this._selection=[0,0],!0}return!1},_clipText:function(a){a="undefined"==typeof a?this._value:a;var c=this._textWidth(a)/(this._width-this._padding);return(c>1?a.substr(-1*Math.floor(a.length/c)):a)+""},_textWidth:function(a){var c=this._renderCtx;return c.font=this._fontStyle+" "+this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,c.textAlign="left",c.measureText(a).width},_calcWH:function(){this.outerW=this._width+2*this._padding+2*this._borderWidth+this.shadowW,this.outerH=this._height+2*this._padding+2*this._borderWidth+this.shadowH},_updateCanvasWH:function(){var a=this._renderCanvas.width,c=this._renderCanvas.height;this._renderCanvas.setAttribute("width",this.outerW),this._renderCanvas.setAttribute("height",this.outerH),this._shadowCanvas.setAttribute("width",this._width+2*this._padding),this._shadowCanvas.setAttribute("height",this._height+2*this._padding),this._ctx&&this._ctx.clearRect(this._x,this._y,a,c)},_roundedRect:function(a,c,d,t,g,k){2*k>t&&(k=t/2),2*k>g&&(k=g/2),a.beginPath(),a.moveTo(c+k,d),a.lineTo(c+t-k,d),a.quadraticCurveTo(c+t,d,c+t,d+k),a.lineTo(c+t,d+g-k),a.quadraticCurveTo(c+t,d+g,c+t-k,d+g),a.lineTo(c+k,d+g),a.quadraticCurveTo(c,d+g,c,d+g-k),a.lineTo(c,d+k),a.quadraticCurveTo(c,d,c+k,d),a.closePath()},_overInput:function(a,c){var d=a<=this._x+this._extraX+this._width+2*this._padding,t=c>=this._y+this._extraY,g=c<=this._y+this._extraY+this._height+2*this._padding;return a>=this._x+this._extraX&&d&&t&&g},_clickPos:function(a){var d=this._value;this._value===this._placeHolder&&(d="");var d=this._clipText(d),t=0,g=d.length;if(a-(this._x+this._extraX)<this._textWidth(d))for(var k=0;k<d.length;k++)if(t+=this._textWidth(d[k]),t>=a-(this._x+this._extraX)){g=k;break}return g},_mousePos:function(a){var c=a.target,d=document.defaultView.getComputedStyle(c,void 0),t=parseInt(d.paddingLeft,10)||0,g=parseInt(d.paddingLeft,10)||0,k=parseInt(d.borderLeftWidth,10)||0,d=parseInt(d.borderLeftWidth,10)||0,f=document.body.parentNode.offsetTop||0,n=document.body.parentNode.offsetLeft||0,l=0,F=0;if("unefined"!=typeof c.offsetParent)do l+=c.offsetLeft,F+=c.offsetTop;while(c=c.offsetParent);return{x:a.pageX-(l+(t+k+n)),y:a.pageY-(F+(g+d+f))}},_mapCodeToKey:function(a,c){for(var d=[8,9,13,16,17,18,20,27,91,92],t="",t=0;t<d.length;t++)if(c===d[t])return;return"boolean"==typeof a&&"number"==typeof c?(d={32:" ",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",107:"+",189:"_",186:":",187:"+",188:"<",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},t=a?c>=65&&90>=c?String.fromCharCode(c):d[c]:c>=65&&90>=c?String.fromCharCode(c).toLowerCase():96===c?"0":97===c?"1":98===c?"2":99===c?"3":100===c?"4":101===c?"5":102===c?"6":103===c?"7":104===c?"8":105===c?"9":188===c?",":190===c?".":191===c?"/":192===c?"`":220===c?"\\":187===c?"=":189===c?"-":222===c?"'":186===c?";":219===c?"[":221===c?"]":String.fromCharCode(c)):void 0}}}(),function(d,a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):d.Spinner=a()}(this,function(){function d(a,c){var g,d=document.createElement(a||"div");for(g in c)d[g]=c[g];return d}function a(a){for(var c=1,d=arguments.length;d>c;c++)a.appendChild(arguments[c]);return a}function c(a,c,d,g){var k=["opacity",c,~~(100*a),d,g].join("-");d=.01+d/g*100,g=Math.max(1-(1-a)/c*(100-d),a);var f=z.substring(0,z.indexOf("Animation")).toLowerCase();return w[k]||(D.insertRule("@"+(f&&"-"+f+"-"||"")+"keyframes "+k+"{0%{opacity:"+g+"}"+d+"%{opacity:"+a+"}"+(d+.01)+"%{opacity:1}"+(d+c)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",D.cssRules.length),w[k]=1),k}function y(a,c){var g,k,d=a.style;for(c=c.charAt(0).toUpperCase()+c.slice(1),k=0;k<F.length;k++)if(g=F[k]+c,void 0!==d[g])return g;return void 0!==d[c]?c:void 0}function t(a,c){for(var d in c)a.style[y(a,d)||d]=c[d];return a}function g(a){for(var c=1;c<arguments.length;c++){var g,d=arguments[c];for(g in d)void 0===a[g]&&(a[g]=d[g])}return a}function k(a){for(var c={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)c.x+=a.offsetLeft,c.y+=a.offsetTop;return c}function f(a,c){return"string"==typeof a?a:a[c%a.length]}function n(a){return"undefined"==typeof this?new n(a):void(this.opts=g(a||{},n.defaults,A))
}function l(){function c(a,g){return d("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',g)}D.addRule(".spin-vml","behavior:url(#default#VML)"),n.prototype.lines=function(d,g){function k(){return t(c("group",{coordsize:w+" "+w,coordorigin:-n+" "+-n}),{width:w,height:w})}function l(e,d,q){a(x,a(t(k(),{rotation:360/g.lines*e+"deg",left:~~d}),a(t(c("roundrect",{arcsize:g.corners}),{width:n,height:g.width,left:g.radius,top:-g.width>>1,filter:q}),c("fill",{color:f(g.color,e),opacity:g.opacity}),c("stroke",{opacity:0}))))}var n=g.length+g.width,w=2*n,e=2*-(g.width+g.length)+"px",x=t(k(),{position:"absolute",top:e,left:e});if(g.shadow)for(e=1;e<=g.lines;e++)l(e,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(e=1;e<=g.lines;e++)l(e);return a(d,x)},n.prototype.opacity=function(a,c,d,g){a=a.firstChild,g=g.shadow&&g.lines||0,a&&c+g<a.childNodes.length&&(a=(a=(a=a.childNodes[c+g])&&a.firstChild)&&a.firstChild)&&(a.opacity=d)}}var z,F=["webkit","Moz","ms","O"],w={},D=function(){var c=d("style",{type:"text/css"});return a(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),A={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};n.defaults={},g(n.prototype,{spin:function(a){this.stop();var n,w,c=this,g=c.opts,f=c.el=t(d(0,{className:g.className}),{position:g.position,width:0,zIndex:g.zIndex}),l=g.radius+g.length+g.width;if(a&&(a.insertBefore(f,a.firstChild||null),w=k(a),n=k(f),t(f,{left:("auto"==g.left?w.x-n.x+(a.offsetWidth>>1):parseInt(g.left,10)+l)+"px",top:("auto"==g.top?w.y-n.y+(a.offsetHeight>>1):parseInt(g.top,10)+l)+"px"})),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!z){var B,e=0,x=(g.lines-1)*(1-g.direction)/2,C=g.fps,q=C/g.speed,h=(1-g.opacity)/(q*g.trail/100),X=q/g.lines;!function v(){e++;for(var r=0;r<g.lines;r++)B=Math.max(1-(e+(g.lines-r)*X)%q*h,g.opacity),c.opacity(f,r*g.direction+x,B,g);c.timeout=c.el&&setTimeout(v,~~(1e3/C))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(g,k){function l(a,e){return t(d(),{position:"absolute",width:k.length+k.width+"px",height:k.width+"px",background:a,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/k.lines*n+k.rotate)+"deg) translate("+k.radius+"px,0)",borderRadius:(k.corners*k.width>>1)+"px"})}for(var F,n=0,w=(k.lines-1)*(1-k.direction)/2;n<k.lines;n++)F=t(d(),{position:"absolute",top:1+~(k.width/2)+"px",transform:k.hwaccel?"translate3d(0,0,0)":"",opacity:k.opacity,animation:z&&c(k.opacity,k.trail,w+n*k.direction,k.lines)+" "+1/k.speed+"s linear infinite"}),k.shadow&&a(F,t(l("#000","0 0 4px #000"),{top:"2px"})),a(g,a(F,l(f(k.color,n),"0 0 1px rgba(0,0,0,.1)")));return g},opacity:function(a,c,d){c<a.childNodes.length&&(a.childNodes[c].style.opacity=d)}});var E=t(d("group"),{behavior:"url(#default#VML)"});return!y(E,"transform")&&E.adj?l():z=y(E,"animation"),n}),window.m=window.m||{},function(d,a){var c="undefined";!function(a){d.log=a()}(function(){function d(c,g){var k=c[g];if(k.bind!==a)return c[g].bind(c);if(Function.prototype.bind===a)return t(k,c);try{return Function.prototype.bind.call(c[g],c)}catch(f){return t(k,c)}}function t(a,c){return function(){Function.prototype.apply.apply(a,[c,arguments])}}function g(a){for(var c=0;c<w.length;c++)l[w[c]]=a(w[c])}function k(){return typeof window!==c&&window.document!==a&&window.document.cookie!==a}function f(){try{return typeof window!==c&&window.localStorage!==a}catch(d){return!1}}function n(a){var d,g,c=!1;for(g in l.levels)if(l.levels.hasOwnProperty(g)&&l.levels[g]===a){d=g;break}if(f())try{window.localStorage.mloglevel=d}catch(n){c=!0}else c=!0;c&&k()&&(window.document.cookie="mloglevel="+d+";")}var l={},F=function(){},w=["trace","debug","info","warn","error"],z=/mloglevel=([^;]+)/;return l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.setLevel=function(k){if("number"==typeof k&&k>=0&&k<=l.levels.SILENT)if(n(k),k===l.levels.SILENT)g(function(){return F});else{if(typeof console===c)return g(function(a){return function(){typeof console!==c&&(l.setLevel(k),l[a].apply(l,arguments))}}),"No console available for logging";g(function(g){return k<=l.levels[g.toUpperCase()]?typeof console===c?F:console[g]===a?console.log!==a?d(console,"log"):F:d(console,g):F})}else{if("string"!=typeof k||l.levels[k.toUpperCase()]===a)throw"log.setLevel() called with invalid level: "+k;l.setLevel(l.levels[k.toUpperCase()])}},l.enableAll=function(){l.setLevel(l.levels.TRACE)},l.disableAll=function(){l.setLevel(l.levels.SILENT)},function(){var c;f()&&(c=window.localStorage.mloglevel),c===a&&k()&&(c=(z.exec(window.document.cookie)||[])[1]),l.levels[c]===a&&(c="WARN"),l.setLevel(l.levels[c])}(),l})}(window.m),window.m=window.m||{},function(d,a){function c(a){return(10>a?"0":"")+a}var y={0:["None","U"],1:["Time","sec"],2:["Delay","sec"],3:["Frequency","Hz"],4:["Time code format",""],5:["Distance","m"],6:["Speed","m/s"],7:["Acceleration","m/sec^2"],8:["Jerk","m/sec^3"],9:["Doppler","Hz"],10:["Doppler rate","Hz/sec"],11:["Energy","J"],12:["Power","W"],13:["Mass","g"],14:["Volume","l"],15:["Angular power density","W/ster"],16:["Integrated power density","W/rad"],17:["Spatial power density","W/m^2"],18:["Integrated power density","W/m"],19:["Spectral power density","W/MHz"],20:["Amplitude","U"],21:["Real","U"],22:["Imaginary","U"],23:["Phase","rad"],24:["Phase","deg"],25:["Phase","cycles"],26:["10*Log","U"],27:["20*Log","U"],28:["Magnitude","U"],29:["Unknown","U"],30:["Unknown","U"],31:["General dimensionless",""],32:["Counts",""],33:["Angle","rad"],34:["Angle","deg"],35:["Relative power","dB"],36:["Relative power","dBm"],37:["Relative power","dBW"],38:["Solid angle","ster"],40:["Distance","ft"],41:["Distance","nmi"],42:["Speed","ft/sec"],43:["Speed","nmi/sec"],44:["Speed","knots=nmi/hr"],45:["Acceleration","ft/sec^2"],46:["Acceleration","nmi/sec^2"],47:["Acceleration","knots/sec"],48:["Acceleration","G"],49:["Jerk","G/sec"],50:["Rotation","rps"],51:["Rotation","rpm"],52:["Angular velocity","rad/sec"],53:["Angular velocity","deg/sec"],54:["Angular acceleration","rad/sec^2"],55:["Angular acceleration","deg/sec^2"],60:["Latitude","deg"],61:["Longitude","deg"],62:["Altitude","ft"],63:["Altitude","m"]};d.Mc={colormap:[{name:"Greyscale",colors:[{pos:0,red:0,green:0,blue:0},{pos:60,red:50,green:50,blue:50},{pos:100,red:100,green:100,blue:100},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0}]},{name:"Ramp Colormap",colors:[{pos:0,red:0,green:0,blue:15},{pos:10,red:0,green:0,blue:50},{pos:31,red:0,green:65,blue:75},{pos:50,red:0,green:85,blue:0},{pos:70,red:75,green:80,blue:0},{pos:83,red:100,green:60,blue:0},{pos:100,red:100,green:0,blue:0}]},{name:"Color Wheel",colors:[{pos:0,red:100,green:100,blue:0},{pos:20,red:0,green:80,blue:40},{pos:30,red:0,green:100,blue:100},{pos:50,red:10,green:10,blue:0},{pos:65,red:100,green:0,blue:0},{pos:88,red:100,green:40,blue:0},{pos:100,red:100,green:100,blue:0}]},{name:"Spectrum",colors:[{pos:0,red:0,green:75,blue:0},{pos:22,red:0,green:90,blue:90},{pos:37,red:0,green:0,blue:85},{pos:49,red:90,green:0,blue:85},{pos:68,red:90,green:0,blue:0},{pos:80,red:90,green:90,blue:0},{pos:100,red:95,green:95,blue:95}]},{name:"Sunset",colors:[{pos:0,red:10,green:0,blue:23},{pos:18,red:34,green:0,blue:60},{pos:36,red:58,green:20,blue:47},{pos:55,red:74,green:20,blue:28},{pos:72,red:90,green:43,blue:0},{pos:87,red:100,green:72,blue:0},{pos:100,red:100,green:100,blue:76}]}]},d.PIPESIZE=1048576,d.initialize=function(c,k){var f=new BlueHeader(null);f.version="BLUE",f.size=0,f.type=1e3,f.format="SF",f.timecode=0,f.xstart=0,f.xdelta=1,f.xunits=0,f.subsize=1,f.ystart=0,f.ydelta=1,f.yunits=0,k||(k={});for(var n in k)f[n]=k[n];if(1<f.subsize&&(f.type=2e3),f["class"]=f.type/1e3,2===f["class"]&&k.subsize===a)throw"subsize must be provided with type 2000 files";return k.pipe?(f.pipe=!0,f.in_byte=0,f.out_byte=0,f.buf=new ArrayBuffer(k.pipesize||d.PIPESIZE),f.setData(f.buf),f.data_free=f.dview.length):f.setData(c),f},d.force1000=function(a){2===a["class"]&&(a.size=a.size&&!a.pipe?a.subsize*a.size:0,a.bpe/=a.subsize,a.ape=1)},d.grab=function(c,d,f,n){if(!c.dview)return 0;if("C"===c.format[0]&&(f*=2),n=Math.min(d.length,c.dview.length-f),d.set===a)for(var l=0;n>l;l++)d[l]=c.dview[f+l];else d.set(c.dview.subarray(f,f+n));return"C"===c.format[0]&&(n/=2),n},d.filad=function(a,c,d){if(a.data_free<c.length)throw"Pipe full";var n=a.in_byte/a.dview.BYTES_PER_ELEMENT,l=n+c.length;if(l>a.dview.length){var l=a.dview.length-n,t=c.length-l;c.subarray?(a.dview.set(c.subarray(0,l),n),a.dview.set(c.subarray(l,c.length),0)):(a.dview.set(c.slice(0,l),n),a.dview.set(c.slice(l,c.length),0)),a.in_byte=t*a.dview.BYTES_PER_ELEMENT}else a.dview.set(c,n),a.in_byte=l*a.dview.BYTES_PER_ELEMENT%a.buf.byteLength;if(a.data_free-=c.length,a.onwritelisteners)for(c=0;c<a.onwritelisteners.length;c++)d?a.onwritelisteners[c]():window.setTimeout(a.onwritelisteners[c],0)},d.pavail=function(a){return a.dview.length-a.data_free},d.grabx=function(c,d,f,n){var l=c.dview.length-c.data_free;if(n===a&&(n=0),f){if(f>d.length-n)throw"m.grabx : nget larger then available buffer space"}else f=Math.min(d.length-n,l);if(0>f)throw"m.grabx : nget cannot be negative";if(f>l)return 0;var l=c.out_byte/c.dview.BYTES_PER_ELEMENT,t=l+f;if(t>=c.dview.length){var w=c.dview.length-l,t=t-c.dview.length;d.set(c.dview.subarray(l,c.dview.length),n),d.set(c.dview.subarray(0,t),n+w)}else d.set(c.dview.subarray(l,t),n);return c.out_byte=t*c.dview.BYTES_PER_ELEMENT%c.buf.byteLength,c.data_free+=f,f},d.addPipeWriteListener=function(a,c){a.onwritelisteners||(a.onwritelisteners=[]),-1===a.onwritelisteners.indexOf(c)&&a.onwritelisteners.push(c)},d.units_name=function(a){return a=y[a],a[0]+" ("+a[1]+")"},d.trim_name=function(a){var c=a.indexOf("]");-1===c&&(c=a.indexOf("/")),-1===c&&(c=a.indexOf(":"));var d=a.substr(c+1,a.length).indexOf(".");return 0>d&&(d=a.length-c),a.substr(c+1,c+d+1)},d.label=function(c,d){var f=["Unknown","U"];"string"==typeof c?f=[c,null]:Array.isArray(c)?f=c:(f=y[c],f===a&&(f=["Unknown","U"]));var n="?";return 1==d?n="":10==d?n="da":.1==d?n="d":100==d?n="h":.01==d?n="c":1e3==d?n="K":.001==d?n="m":1e6==d?n="M":1e-6==d?n="u":1e9==d?n="G":1e-9==d?n="n":1e12==d?n="T":1e-12==d&&(n="p"),f[1]?f[0]+" ("+n+f[1]+")":f[0]};var t="F";d.vstype=function(a){t=a,"D"===t||"L"===t||"F"===t||"I"===t||"B"===t||alert("Unsupported vector type")},d.vlog10=function(c,d,f){d===a&&(d=1e-20),f===a&&(f=c);for(var n=0;n<c.length&&!(f.length<=n);n++)f[n]=Math.log(Math.max(c[n],d))/Math.log(10)},d.vlogscale=function(c,d,f,n){d===a&&(d=1e-20),f===a&&(f=1),n===a&&(n=c);for(var l=0;l<c.length&&!(n.length<=l);l++)n[l]=Math.log(Math.abs(Math.max(c[l],d)))/Math.log(10),n[l]*=f},d.cvmag2logscale=function(c,d,f,n){d===a&&(d=1e-20),f===a&&(f=1),n===a&&(n=c);for(var l=0,t=0;t<n.length&&(l=2*t+1,!(l>=c.length));t++)n[t]=c[l-1]*c[l-1]+c[l]*c[l],n[t]=Math.log(Math.abs(Math.max(n[t],d)))/Math.log(10),n[t]*=f},d.vsmul=function(c,d,f,n){f===a&&(f=c),n===a&&(n=f.length),n=Math.min(f.length,n),n=Math.min(c.length,n);for(var l=0;n>l&&!(f.length<=l);l++)f[l]=c[l]*d},d.vmxmn=function(a,c){var d=a[0],n=a[0],l=0,t=0;c=Math.min(c,a.length);for(var w=0;c>w;w++)a[w]>d&&(d=a[w],l=w),a[w]<n&&(n=a[w],t=w);return{smax:d,smin:n,imax:l,imin:t}},d.vmov=function(c,d,f,n,l){l===a&&(l=c.length),l=Math.min(c.length,l);for(var t=0;l>t;t++){var w=t*d,z=t*n;if(w>=c.length)break;if(z>=f.length)break;f[z]=c[w]}},d.vfill=function(c,d,f){f===a&&(f=c.length),f=Math.min(c.length,f);for(var n=0;f>n;n++)c[n]=d},d.vabs=function(c,d,f){f===a&&(f=c.length),d===a&&(d=c);for(var n=0;f>n;n++)d[n]=Math.abs(c[n])},d.cvmag=function(c,d,f){f===a&&(f=d.length),f=Math.min(d.length,f);for(var n=0;f>n;n++){var l=2*n+1;if(l>=c.length)break;d[n]=Math.sqrt(c[l-1]*c[l-1]+c[l]*c[l])}},d.cvmag2=function(c,d,f){f===a&&(f=d.length),f=Math.min(d.length,f);for(var n=0,l=0;f>l&&(n=2*l+1,!(n>=c.length));l++)d[l]=c[n-1]*c[n-1]+c[n]*c[n]},d.cvpha=function(c,d,f){f===a&&(f=d.length),f=Math.min(d.length,f);for(var n=0,l=0,t=n=0;f>t&&(n=2*t+1,!(n>=c.length));t++)l=c[n-1],n=c[n],0===l&&0===n&&(l=1),d[t]=Math.atan2(n,l)},d.cvphad=function(c,d,f){f===a&&(f=d.length),f=Math.min(d.length,f);for(var n=0,l=0,t=n=0;f>t&&(n=2*t+1,!(n>=c.length));t++)l=c[n-1],n=c[n],0===l&&0===n&&(l=1),d[t]=Math.atan2(n,l)*(180/Math.PI)},d.trunc=function(a){return a-a%1},d.sign=function(a,c){return c>=0?Math.abs(a):-Math.abs(a)},d.sec2tod=function(a,d){var f="",n=Date.UTC(1950,0,1);Date.UTC(1949,11,31);var l=new Date,f=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1,0,0,0,0),w=new Date(l.getFullYear(),0,1,0,0,0,0),z=new Date(l.getFullYear()+1,0,1,0,0,0),l=(t-f)/1e3,w=(z-w)/1e3,t=-1*w;return a>=0?l>a?(f=f.getTime()+1e3*a,l=new Date(f),f=c(l.getHours())+":"+c(l.getMinutes())+":"+c(l.getSeconds())):86400===a?f="24:00:00":w>a?(n=a/l,n=[n>0?Math.floor(n):Math.ceil(n)],l=new Date(1e3*a+f.getTime()),f=n.toString()+"::"+c(l.getHours())+":"+c(l.getMinutes())+":"+c(l.getSeconds())):(f=Math.floor(1e3*a)+n,l=new Date(f),f=l.getUTCFullYear()+":"+c(l.getUTCMonth()+1)+":"+c(l.getUTCDate())+"::"+c(l.getUTCHours())+":"+c(l.getUTCMinutes())+":"+c(l.getUTCSeconds())):a>t?(n=a/l,n=0>=n?Math.ceil(n):Math.floor(n),l=new Date(Math.abs(1e3*a)+f.getTime()),n=0===n?"-0":n.toString(),f=n+"::"+c(l.getHours())+":"+c(l.getMinutes())+":"+c(l.getSeconds())):(f=Math.floor(1e3*a)+n,l=new Date(f),f=l.getUTCFullYear()+":"+c(l.getUTCMonth()+1)+":"+c(l.getUTCDate())+"::"+c(l.getUTCHours())+":"+c(l.getUTCMinutes())+":"+c(l.getUTCSeconds())),f=0===a%1?f+".000000":f+("."+Math.abs(a%1).toPrecision(6).slice(2,8)),d&&(n=f.indexOf("."),w=-1,-1!==n&&(w=f.substr(n,f.length).indexOf("0")),-1!==w&&(f=f.substr(0,n+w))),f},d.sec2tspec=function(a,c,f){return c=c||"",a>=0&&86400>=a?d.sec2tod(a,f):(a%=86400,"delta"!==c&&0>=a?d.sec2tod(a+86400,f):"delta"===c&&0>=a?"-"+d.sec2tod(-1*a,f):d.sec2tod(a,f))},d.sec2tod_j1970=function(a){var d="";return a>=0&&86400>a?(d=new Date(1e3*a),d=c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())):0>a&&a>-31536e3?(d=new Date(1e3*a),d=(a/86400*-1).toString()+"::"+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())):(d=new Date(1e3*(a-631152e3)),d=d.getFullYear()+":"+c(d.getMonth())+":"+c(d.getDate())+"::"+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())),0!==a%1&&(d+="."+(a%1).toPrecision(6).slice(2,8)),d},d.j1970toj1950=function(c){return c.getTime!==a?c.getTime()/1e3+631152e3:c+631152e3},d.j1950toj1970=function(a){return a-631152e3},d.throttle=function(a,c){var d=(new Date).getTime();return function(){var n=(new Date).getTime();n-d>=a&&(d=n,c.apply(null,arguments))}}}(window.m),window.mx=window.mx||{},function(d,a,c){function y(){this.ymax=this.ymin=this.xmax=this.xmin=this.yl=this.xl=this.yo=this.xo=0,this.mode=this.func=c}function t(e){this.root=e,this.parent=document.createElement("div"),this.parent.style.position="relative",this.parent.width=e.clientWidth,this.parent.height=e.clientHeight,e.appendChild(this.parent),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this.parent.appendChild(this.canvas),this.active_canvas=this.canvas,this.wid_canvas=document.createElement("canvas"),this.wid_canvas.style.position="absolute",this.wid_canvas.style.top="0px",this.wid_canvas.style.left="0px",this.wid_canvas.style.zIndex=1,this.wid_canvas.width=e.clientWidth,this.wid_canvas.height=e.clientHeight,this.parent.appendChild(this.wid_canvas),this.level=this.text_h=this.text_w=0,this.width=this.parent.width,this.height=this.parent.height,this.ymrk=this.xmrk=this.ypos=this.xpos=0,this.origin=1,this.stk=[new d.STKSTRUCT],d.setbgfg(this,"black","white"),this.warpbox=this.event_cb=c,this.rmode=!1,this.linewidth=1,this.style=c,this.xi=!1,this.l=this.state_mask=this.button_press=this.button_release=0,this.r=this.width,this.t=0,this.b=this.height,this.scrollbar_x=new d.SCROLLBAR,this.scrollbar_y=new d.SCROLLBAR,this.prompt=c,this.pixel=[],this._renderCanvas=document.createElement("canvas")}function g(e,a,c,d,q,h,f){return c>=q?f>c&&(d-a)*(f-c)-(h-a)*(q-c)>0&&(e+=1):c>=f&&0>(d-a)*(f-c)-(h-a)*(q-c)&&(e-=1),e}function k(e,a){a.animationFrameHandle||(a.animationFrameHandle=requestAnimFrame(d.withWidgetLayer(e,function(){d.erase_window(e),a.animationFrameHandle=c;var B=1.5*e.text_h;a.x=Math.max(a.x,0),a.y=Math.max(a.y,0),a.x=Math.min(a.x,e.width-a.w),a.y=Math.min(a.y,e.height-a.h);var C=a.x+G.GBorder+Math.max(0,G.sidelab),q=a.y+G.GBorder+G.toplab*(B+G.GBorder),h=a.w-2*G.GBorder-Math.abs(G.sidelab);d.widgetbox(e,a.x,a.y,a.w,a.h,C,q,h,a.h-2*G.GBorder-G.toplab*(B+G.GBorder),a.title);var f=e.wid_canvas.getContext("2d");f.lineWidth=1,f.strokeStyle=e.xwbs,f.beginPath(),f.moveTo(C,q-4+.5),f.lineTo(C+h-1,q-4+.5),f.stroke(),f.strokeStyle=e.xwts,f.beginPath(),f.moveTo(C,q-3+.5),f.lineTo(C+h-1,q-3+.5),f.stroke();for(var g=0;g<a.items.length;g++){var v=a.items[g],r=q+B*g;"separator"===v.style?(f.fillStyle=e.xwbs,f.fillRect(C,r,h,B),f.beginPath(),f.moveTo(C,r+.5),f.lineTo(C+h,r+.5),f.stroke(),f.textBaseline="middle",f.textAlign="left",f.fillStyle=e.xwfg,f.fillText(" "+v.text+" ",C+2*e.text_w,r+B/2)):(d.LEGACY_RENDER?(f.fillStyle=e.xwlo,f.fillRect(C,r,h,B),f.beginPath(),f.moveTo(C,r+.5),f.lineTo(C+h,r+.5),f.stroke(),v.selected&&d.shadowbox(e,C-1,r,h+2,B,1,2,"",.75)):(f.save(),f.globalAlpha=.75,f.fillStyle=v.selected?e.xwts:e.xwlo,f.fillRect(C,r,h,B),f.restore(),f.strokeStyle=e.bg,f.beginPath(),f.moveTo(C,r+.5),f.lineTo(C+h,r+.5),f.stroke()),f.textBaseline="middle",f.textAlign="left",f.fillStyle=e.xwfg,"checkbox"===v.style?(f.fillText(" "+v.text+" ",C+2*e.text_w,r+B/2),f.strokeStyle=e.xwfg,f.strokeRect(C+1+e.text_w,r+(B-e.text_w)/2,e.text_w,e.text_w),v.checked&&(f.beginPath(),f.moveTo(C+1+e.text_w,r+(B-e.text_w)/2),f.lineTo(C+1+e.text_w+e.text_w,r+(B-e.text_w)/2+e.text_w),f.stroke(),f.beginPath(),f.moveTo(C+1+e.text_w+e.text_w,r+(B-e.text_w)/2),f.lineTo(C+1+e.text_w,r+(B-e.text_w)/2+e.text_w),f.stroke())):(f.fillText(" "+v.text+" ",C,r+B/2),v.checked&&(f.beginPath(),f.moveTo(C+1,r+e.text_h/4),f.lineTo(C+1+e.text_w-2,r+e.text_h/4+e.text_h/2),f.lineTo(C+1,r+e.text_h/4+e.text_h),f.lineTo(C+1,r+e.text_h/4),f.fill())))}})))}function f(e,a){d.onWidgetLayer(e,function(){d.erase_window(e)}),e.menu=c,e.widget=null;for(var B=0;B<a.items.length;B++){var C=a.items[B];if(C.selected){C.handler?C.handler():C.menu&&(B=C.menu,"function"==typeof C.menu&&(B=C.menu()),B.finalize=a.finalize,d.menu(e,B));break}}!e.menu&&a.finalize&&a.finalize()}function n(e,a){d.onWidgetLayer(e,function(){d.erase_window(e)}),e.menu=c,e.widget=null,!e.menu&&a.finalize&&a.finalize()}function l(e,a,c){var q,d=!0;return q=a/e,e>0?q>c.tL?d=!1:q>c.tE&&(c.tE=q):0>e?q<c.tE?d=!1:q<c.tL&&(c.tL=q):a>0&&(d=!1),d}function F(e,a,c,d,q,h,f,g){if(0>a&&(a=0),0>c&&(c=0),0>d&&(d=0),0>q&&(q=0),g&&(e.lineWidth=g),f&&(e.strokeStyle=f),1===e.lineWidth%2&&(a===d&&(d=a=Math.floor(a)+.5),c===q&&(q=c=Math.floor(c)+.5)),h&&h.mode){if("dashed"===h.mode){if(dashOn(e,h.on,h.off))e.beginPath(),e.moveTo(a,c),e.lineTo(d,q),e.stroke(),dashOff(e);else if(e.beginPath(),c===q)for(q=Math.min(a,d),d=Math.max(a,d);d>q;)e.moveTo(q,c),e.lineTo(q+h.on,c),e.stroke(),q+=h.on+h.off;else{if(a!==d)throw"Only horizontal or vertical dashed lines are supported";for(d=Math.min(c,q),q=Math.max(c,q);q>d;)e.moveTo(a,d),e.lineTo(a,d+h.on),e.stroke(),d+=h.on+h.off}e.beginPath()}else if("xor"===h.mode)if("undefined"==typeof Uint8ClampedArray)e.beginPath(),e.moveTo(a,c),e.lineTo(d,q),e.stroke(),e.beginPath();else{if(f=h=0,c===q)h=Math.abs(d-a),f=g,a=Math.min(a,d);else{if(a!==d)throw"Only horizontal and vertical lines can be drawn with XOR";h=g,f=Math.abs(q-c),c=Math.min(c,q)}if(0!==h&&0!==f){for(a=Math.floor(a),c=Math.floor(c),d=e.getImageData(a,c,h,f),q=d.data,h=0,g=q.length;g>h;h+=4)q[h]=255-q[h],q[h+1]=255-q[h+1],q[h+2]=255-q[h+2],q[h+3]=255;e.putImageData(d,a,c),e.clearRect(0,0,1,1)}}}else e.beginPath(),e.moveTo(a,c),e.lineTo(d,q),e.stroke(),e.beginPath()}function w(e,a,c,d,q){z(e,a,q),c&&(e.strokeStyle=c),d&&(e.fillStyle=d),e.fill(),e.closePath()}function z(e,a,c){if(!(1>a.length)){var d=a[0].x,q=a[0].y;for(e.lineWidth=c?c:1,e.beginPath(),e.moveTo(d,q),c=0;c<a.length;c++)d=a[c].x,q=a[c].y,e.lineTo(d,q)}}function D(e){return Math.floor(Math.round(e/100*255))}function A(e,a,c){return"rgb("+Math.round(e)+", "+Math.round(a)+", "+Math.round(c)+")"}function E(e,a){var c,d;if(".000000"===e.substring(5,8))c=4;else for(c=e.length-1;"0"===e[c];)c-=1;for(d=0;" "===e[d]&&(c-d+1>5||a);)d+=1;return c=e.substring(d,c+1),-1===c.indexOf(".")&&(c+="."),c}function J(e){e._animationFrameHandle=c;var a=e.warpbox;if(e.active_canvas.getContext("2d"),a&&e.xpos>=a.xmin&&e.xpos<=a.xmax&&e.ypos>=a.ymin&&e.ypos<=a.ymax){a.xl=e.xpos,a.yl=e.ypos;var B=Math.min(a.xo,a.xl),C=Math.min(a.yo,a.yl),q=Math.abs(a.xl-a.xo),h=Math.abs(a.yl-a.yo);0!==q&&0!==h&&("vertical"===a.mode?(B=e.l,q=e.r-e.l):"horizontal"===a.mode&&(C=e.t,h=e.b-e.t),d.onWidgetLayer(e,function(){d.erase_window(e),d.draw_box(e,"xor",B,C,q,h,a.style.opacity,a.style.fill_color)}))}}function Q(e,a,c){return a>e?a:e>c?c:e}function U(e,a,d,C,q,h,f,g,v,r,s,u,p){r===c&&(r=0),s===c&&(s=0),u===c&&(u=d.width-r),p===c&&(p=d.height-s),e._renderCanvas.width=d.width,e._renderCanvas.height=d.height;for(var H=e._renderCanvas.getContext("2d"),I=H.createImageData(e._renderCanvas.width,e._renderCanvas.height),k=new Uint8Array(d),l=0;l<d.height;++l)for(var n=0;n<d.width;++n){var t=4*(l*d.width+n);I.data[t]=k[t],I.data[t+1]=k[t+1],I.data[t+2]=k[t+2],I.data[t+3]=255}H.putImageData(I,0,0),a.save(),a.globalAlpha=C,q||(a.imageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1),a.drawImage(e._renderCanvas,r,s,u,p,h,f,g,v),a.restore()}function M(e,a,d,C,q,h,f,g,v,r,s,u,p){if(r===c&&(r=0),s===c&&(s=0),u===c&&(u=d.width-r),p===c&&(p=d.height-s),32768>d.width&&32768>d.height){e._renderCanvas.width=d.width,e._renderCanvas.height=d.height;var H=e._renderCanvas.getContext("2d"),I=H.createImageData(e._renderCanvas.width,e._renderCanvas.height);d=new Uint8ClampedArray(d),I.data.set(d),H.putImageData(I,0,0)}else 32768>u&&32768>p?(e._renderCanvas.width=u,e._renderCanvas.height=p,N(e._renderCanvas,d,r,s,u,p)):(e._renderCanvas.width=Math.min(2*g,d.width),e._renderCanvas.height=Math.min(2*v,d.height),N(e._renderCanvas,d,r,s,u,p),u=e._renderCanvas.width,p=e._renderCanvas.height),s=r=0;a.save(),a.globalAlpha=C,q||(a.imageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1),a.drawImage(e._renderCanvas,r,s,u,p,h,f,g,v),a.restore()}function N(e,a,c,d,q,h){var f=new Uint32Array(a);q||(q=a.width),h||(h=a.height),c||(c=0),d||(d=0);var g=e.width,v=e.height;e=e.getContext("2d");var r=e.createImageData(g,v),s=new ArrayBuffer(r.data.length),u=new Uint8ClampedArray(s),s=new Uint32Array(s);q/=g,h/=v;for(var p=0,H=0,v=p=0;v<s.length;v++)p=Math.round(Math.floor(v%g)*q)+c,H=Math.round(Math.floor(v/g)*h)+d,p=Math.floor(H*a.width+p),s[v]=f[p];r.data.set(u),e.putImageData(r,0,0)}d.XW_INIT=-3,d.XW_DRAW=1,d.XW_EVENT=2,d.XW_UPDATE=3,d.XW_COMMAND=5,d.SB_EXPAND=1,d.SB_SHRINK=2,d.SB_FULL=3,d.SB_STEPINC=4,d.SB_STEPDEC=5,d.SB_PAGEINC=6,d.SB_PAGEDEC=7,d.SB_DRAG=8,d.SB_WHEELUP=9,d.SB_WHEELDOWN=10,d.L_ArrowLeft=1001,d.L_ArrowRight=1002,d.L_ArrowUp=1003,d.L_ArrowDown=1004,d.L_dashed=801,d.GBorder=3,d.L_RModeOff=900,d.L_RModeOn=901,d.L_PixelSymbol=1,d.L_CircleSymbol=2,d.L_SquareSymbol=3,d.L_PlusSymbol=4,d.L_XSymbol=5,d.L_TriangleSymbol=6,d.L_ITriangleSymbol=7,d.L_HLineSymbol=8,d.L_VLineSymbol=9,d.LEGACY_RENDER=!1,d.STKSTRUCT=function(){this.y2=this.x2=this.y1=this.x1=this.yscl=this.xscl=this.ymax=this.ymin=this.xmax=this.xmin=0},d.SCROLLBAR=function(){this.repeat_count=this.origin=this.mxevent=this.arrow=this.a2=this.a1=this.soff=this.swmin=this.sw=this.s1=this.h=this.w=this.y=this.x=this.repeat_pause=this.initial_pause=this.dragoutline=this.scale=this.page=this.step=this.trange=this.tmin=this.srange=this.smin=this.action=this.flag=null},d.open=function(e){return e=new t(e),e.wid_canvas.oncontextmenu=function(e){return e.preventDefault(),!1},this._ctx=e.active_canvas.getContext("2d"),e.onmousemove=function(e){return function(a){var C=a.target.getBoundingClientRect();e.x=a.x||a.clientX,e.y=a.y||a.clientY,e.xpos=a.offsetX===c?a.pageX-C.left-window.scrollX:a.offsetX,e.ypos=a.offsetX===c?a.pageY-C.top-window.scrollY:a.offsetY,e.warpbox&&(e.warpbox.style=(a.ctrlKey||a.metaKey)&&e.warpbox.alt_style!==c?e.warpbox.alt_style:e.warpbox.def_style,d.redraw_warpbox(e)),d.widget_callback(e,a)}}(e),e.onmouseup=function(e){return function(a){if(e.warpbox){d.onWidgetLayer(e,function(){d.erase_window(e)});var C=e.warpbox;if(e.warpbox=c,1===a.which&&C.func){var q=C.xo,h=C.yo,f=C.xl,g=C.yl;"vertical"===C.mode?(q=e.l,f=e.r):"horizontal"===C.mode&&(h=e.t,g=e.b),C.func(a,q,h,f,g,C.style.return_value,C.mode)}}d.widget_callback(e,a)}}(e),e.onmousedown=function(e){return function(a){return a.preventDefault(),d.widget_callback(e,a),!1}}(e),e.onkeydown=function(e){return function(a){if(e.warpbox){var c=getKeyCode(a);17!==c&&224!==c&&91!==c&&93!==c||e.warpbox.style===e.warpbox.alt_style||(e.warpbox.style=e.warpbox.alt_style,d.redraw_warpbox(e))}d.widget_callback(e,a)}}(e),e.onkeyup=function(e){return function(a){e.warpbox&&(a=getKeyCode(a),17!==a&&224!==a&&91!==a&&93!==a||e.warpbox.style===e.warpbox.def_style||(e.warpbox.style=e.warpbox.def_style,d.redraw_warpbox(e)))}}(e),e.ontouchend=function(e){return function(){e.onmouseup({which:1})}}(e),e.ontouchmove=function(e){return function(a){var f=e.canvas,q=0,h=0;if(f.offsetParent!==c)do q+=f.offsetLeft,h+=f.offsetTop;while(f=f.offsetParent);e.xpos=a.targetTouches[0].pageX-q,e.ypos=a.targetTouches[0].pageY-h,d.redraw_warpbox(e)}}(e),d.enableListeners(e),e},d.enableListeners=function(e){d.addEventListener(e,"mousemove",e.onmousemove,!1),window.addEventListener("mouseup",e.onmouseup,!1),d.addEventListener(e,"mousedown",e.onmousedown,!1),window.addEventListener("keydown",e.onkeydown,!1),window.addEventListener("keyup",e.onkeyup,!1)},d.disableListeners=function(e){d.removeEventListener(e,"mousemove",e.onmousemove,!1),window.removeEventListener("mouseup",e.onmouseup,!1),d.removeEventListener(e,"mousedown",e.onmousedown,!1),window.removeEventListener("keydown",e.onkeydown,!1),window.removeEventListener("keyup",e.onkeyup,!1)},d.addEventListener=function(e,a,c,d){return e.wid_canvas.addEventListener(a,c,d)},d.removeEventListener=function(e,a,c,d){return e.wid_canvas.removeEventListener(a,c,d)},d.dispatchEvent=function(e,a){return e.wid_canvas.dispatchEvent(a)},d.onWidgetLayer=function(e,a){d.onCanvas(e,e.wid_canvas,a)},d.onCanvas=function(e,a,c){var d=e.active_canvas;e.active_canvas=a;try{if(c)return c()}finally{e.active_canvas=d}},d.withWidgetLayer=function(e,a){return function(){d.onWidgetLayer(e,a)}},d.render=function(e,a){if(a){var d=e.active_canvas;d._animationFrameHandle||(d._animationFrameHandle=requestAnimFrame(function(){d._animationFrameHandle=c,a()}))}},d.fullscreen=function(e,a){a===c&&(a=!e.fullscreen),a?(e.fullscreen={position:e.root.style.position,height:e.root.style.height,width:e.root.style.width,left:e.root.style.left,top:e.root.style.top,zIndex:e.root.style.zIndex},e.root.style.position="fixed",e.root.style.height="100%",e.root.style.width="100%",e.root.style.left="0px",e.root.style.top="0px",e.root.style.zIndex=16777271):(e.root.style.position=e.fullscreen.position,e.root.style.height=e.fullscreen.height,e.root.style.width=e.fullscreen.width,e.root.style.left=e.fullscreen.left,e.root.style.top=e.fullscreen.top,e.root.style.zIndex=e.fullscreen.zIndex,e.fullscreen=c),d.checkresize(e)},d.checkresize=function(e){var a=e.canvas;return a.height!==e.root.clientHeight||a.width!==e.root.clientWidth?(e.height=e.root.clientHeight,e.width=e.root.clientWidth,e.canvas.height=e.height,e.canvas.width=e.width,e.wid_canvas.height=e.height,e.wid_canvas.width=e.width,!0):!1},d.invertbgfg=function(e){d.setbgfg(e,e.fg,e.bg,!e.xi)},d.mixcolor=function(e,a,c){e=tinycolor(e).toRgb(),a=tinycolor(a).toRgb();var d=1-c;return a.r=e.r*d+a.r*c,a.g=e.g*d+a.g*c,a.b=e.b*d+a.b*c,tinycolor(a).toHexString(!0)},d.linear_gradient=function(e,a,c,d,q,h){var f=e.active_canvas.getContext("2d");for(e=1/h.length,a=f.createLinearGradient(a,c,d,q),c=0;c<h.length-1;c++)a.addColorStop(e*c,h[c]);return a.addColorStop(1,h[h.length-1]),a},d.setbgfg=function(e,a,c,f){e.bg=tinycolor(a).toHexString(),e.fg=tinycolor(c).toHexString(),e.xi=tinycolor(f).toHexString(),tinycolor.equals(e.bg,"black")&&tinycolor.equals(e.fg,"white")?(e.xwfg=e.fg,e.xwbg="rgb(35%,35%,30%)",e.xwts="rgb(60%,60%,55%)",e.xwbs="rgb(25%,25%,20%)",e.xwms=d.mixcolor(e.xwts,e.xwbs,.5),e.xwlo="rgb(15%,15%,10%)",e.hi=e.xwts):tinycolor.equals(e.bg,"white")&&tinycolor.equals(e.fg,"black")?(e.xwfg=e.fg,e.xwbg="rgb(60%,60%,55%)",e.xwts="rgb(80%,80%,75%)",e.xwbs="rgb(40%,40%,35%)",e.xwms=d.mixcolor(e.xwts,e.xwbs,.5),e.xwlo="rgb(70%,70%,65%)",e.hi=e.xwbs):(a=tinycolor(e.bg).toRgb(),127.5<Math.sqrt(.299*a.r*a.r+.587*a.g*a.g+.114*a.b*a.b)?(e.xwfg="black",e.xwbg="rgb(60%,60%,55%)",e.xwts="rgb(80%,80%,75%)",e.xwbs="rgb(40%,40%,35%)",e.xwms=d.mixcolor(e.xwts,e.xwbs,.5),e.xwlo="rgb(70%,70%,65%)",e.hi=e.xwts):(e.xwfg="white",e.xwbg="rgb(35%,35%,30%)",e.xwts="rgb(60%,60%,55%)",e.xwbs="rgb(25%,25%,20%)",e.xwms=d.mixcolor(e.xwts,e.xwbs,.5),e.xwlo="rgb(15%,15%,10%)",e.hi=e.xwbs))},d.settheme=function(e,a){e.bg=a.bg,e.fg=a.fg,e.xi=a.xi,e.xwfg=a.xwfg,e.xwbg=a.xwbg,e.xwts=a.xwts,e.xwbs=a.xwbs,e.xwlo=a.xwlo,e.hi=a.hi},d.close=function(e){var a=e.wid_canvas;a.removeEventListener("mousemove",e.onmousemove,!1),a.removeEventListener("mouseup",e.onmouseup,!1),e.parent&&e.parent.parentNode&&e.parent.parentNode.removeChild(e.parent)},d.scrollbar=function(e,a,B,f,q,h,g,k,v,r,s){var u,p,H,I=0,l=new d.SCROLLBAR;switch(u=a.flag!==c?a.flag:a,p=Math.abs(u),H=h-q>f-B?3>e.origin?2:4:2&e.origin?3:1,10>p&&(a=l),(10>p||0===a.action)&&(d.scroll(e,a,d.XW_INIT,c,s),a.flag=u,a.initial_pause=-1,d.scroll_loc(a,B,q,f-B+1,h-q+1,H,s)),a.srange=g.pe-g.ps,p){case 0:B=f=q=1;break;case 1:case 11:B=f=.9*a.srange,q=2;break;case 2:case 12:B=.1*a.srange,f=9*B,q=2;break;case 3:case 13:B=1,f=a.srange-1,q=1;break;default:return 0}return d.scroll_vals(a,g.ps,a.srange,k,v-k,B,f,q,s),0===u?d.scroll(e,a,d.XW_DRAW,c,c):d.scroll(e,a,d.XW_EVENT,r,s)&&(g.ps!==a.smin&&(g.ps=a.smin,I+=1),g.pe!==a.smin+a.srange&&(g.pe=a.smin+a.srange,I+=2)),I},d.scroll=function(e,a,B,f,q){var h;if(a===c)return!1;switch(B){case d.XW_INIT:d.scroll_loc(a,0,0,e.width,20,1,q),d.scroll_vals(a,0,10,0,100,1,10,1,q),a.flag=0,a.action=0,a.initial_pause=.25,a.repeat_pause=.05,a.mxevent=!0,a.repeat_count=0;break;case d.XW_EVENT:if(h=0,a.mxevent)h=e.button_release?-e.button_release:e.button_press;else if("mousedown"===f.type||"mouseup"===f.type){switch(f.which){case 1:h=1;break;case 2:h=2;break;case 3:h=3;break;case 4:h=4;break;case 5:h=5}"mouseup"===f.type&&(h=-h)}else("mousewheel"===f.type||"DOM-MouseScroll"===f.type)&&(f.wheelDelta&&0<f.wheelDelta?h=4:f.wheelDelta&&0>f.wheelDelta&&(h=5));if(0===a.action){if((4===h||5===h)&&(e.xpos=a.x),1!==h&&2!==h&&4!==h&&5!==h||e.xpos<a.x||e.ypos<a.y||e.xpos>a.x+a.w||e.ypos>a.y+a.h)return!1}else if(0>h){a.action=a.repeat_count=0;break}if(1&a.origin?(f=e.xpos-a.x,2&a.origin&&(f=a.w-f)):(f=e.ypos-a.y,2>=a.origin&&(f=a.h-f)),0===a.action){a.repeat_count=0;var g=d.scroll_real2pix(a);if(a.s1=q.s1=g.s1,a.sw=q.sw=g.sw,a.soff=q.soff=f-a.s1,0===a.trange)a.smin=q.smin=a.tmin,a.srange=q.srange=0;else switch(h){case 1:a.action=f>a.a1&&f<a.a2?0<a.soff?d.SB_PAGEINC:d.SB_PAGEDEC:0<a.soff?d.SB_STEPINC:d.SB_STEPDEC;break;case 4:a.action=d.SB_WHEELUP;break;case 5:a.action=d.SB_WHEELDOWN}}else switch(a.action){case d.SB_WHEELUP:case d.SB_WHEELDOWN:case d.SB_EXPAND:case d.SB_SHRINK:case d.SB_FULL:a.action=a.repeat_count=0
}case d.XW_COMMAND:switch(h=a.smin,f=a.srange,a.action){case d.SB_STEPINC:h+=a.step;break;case d.SB_STEPDEC:h-=a.step;break;case d.SB_PAGEINC:h+=a.page;break;case d.SB_PAGEDEC:h-=a.page;break;case d.SB_FULL:h=a.tmin,f=a.trange;break;case d.SB_EXPAND:f*=a.scale,h=0>=h&&0<=h+a.srange?h*a.scale:h-(f-a.srange)/2;break;case d.SB_SHRINK:f/=a.scale,h=0>h&&0<=h+a.srange?h+f/a.scale:0===h&&0<=h+a.srange?f/a.scale:h+(a.srange-f)/2;break;case d.SB_WHEELUP:h-=a.page;break;case d.SB_WHEELDOWN:h+=a.page}0<a.trange?(h=Math.max(a.tmin,Math.min(h,a.tmin+a.trange-f)),f=Math.min(f,a.trange)):(h=Math.min(a.tmin,Math.max(h,a.tmin+a.trange-f)),f=Math.max(f,a.trange)),a.smin===h&&a.srange===f?a.action!==d.SB_DRAG&&(a.action=a.repeat_count=0):(a.smin=q.smin=h,a.srange=q.srange=f,a.repeat_count++),B===d.XW_COMMAND&&(d.scroll(e,a,d.XW_UPDATE,c),a.action=0);break;case d.XW_DRAW:case d.XW_UPDATE:d.redrawScrollbar(a,e,B)}return!0},d.scroll_loc=function(e,x,f,C,q,h,g){e!==c&&(e.x=g.x=x,e.y=g.y=f,e.w=g.w=C,e.h=g.h=q,e.origin=g.origin=Math.max(1,Math.min(4,h)),1&e.origin?(e.a2=g.a2=e.w,e.arrow=g.arrow=Math.min(a.trunc((e.w-a.trunc(2*d.GBorder))/3),e.h+d.GBorder)):(e.a2=g.a2=e.h,e.arrow=g.arrow=Math.min(a.trunc((e.h-a.trunc(2*d.GBorder))/3),e.w+d.GBorder)),e.a1=g.a1=e.arrow+d.GBorder,e.a2-=e.arrow+d.GBorder,g.a2-=e.arrow+d.GBorder,e.swmin=g.swmin=Math.min(10,e.a2-e.a1),e.s1=g.s1=0,e.sw=g.sw=0,e.action=g.action=0)},d.scroll_vals=function(e,a,d,f,q,h,g,k,v){e!==c&&(e.smin=v.smin=a,e.srange=v.srange=d,e.tmin=v.tmin=f,e.trange=v.trange=q,e.step=v.step=h,e.page=v.page=g,e.scale=v.scale=Math.max(k,1))},d.draw_symbol=function(e,a,c,f,q,h){var g=new Int32Array(new ArrayBuffer(4)),k=new Int32Array(new ArrayBuffer(4));g[0]=c,k[0]=f,d.draw_symbols(e,a,g,k,1,q,h)},d.draw_symbols=function(e,c,f,g,q,h,k){for(var l=e.active_canvas.getContext("2d"),v=0,r=0,s=0,u=0,p=0,p=!1,H=[],v=0;4>v;v++)H[v]={x:0,y:0};if(u="",p=0>k,r=Math.abs(k),s=2*r,l.fillStyle=c,l.strokeStyle=c,"function"==typeof h)for(v=0;q>v;v++)H=f[v],e=g[v],h(l,v,H,e);else switch(h){case d.L_CircleSymbol:for(v=0;q>v;v++)H=f[v],e=g[v],l.beginPath(),p?(l.arc(H,e,r,0,360),l.fill()):(l.arc(H,e,r,0,360),l.stroke());break;case d.L_SquareSymbol:if(p)for(v=0;q>v;v++)l.fillRect(f[v]-r,g[v]-r,s,s);else for(v=0;q>v;v++)l.strokeRect(f[v]-r,g[v]-r,s,s);break;case d.L_PixelSymbol:for(s=1,v=0;q>v;v+=s)l.beginPath(),l.arc(f[v],g[v],1,0,2*Math.PI,!0),l.fill();break;case d.L_ITriangleSymbol:r=-r;case d.L_TriangleSymbol:for(s=a.trunc(1.5*r),u=a.trunc(.8*r),H[1].x=-u,H[1].y=s,H[2].x=2*u,H[2].y=0,H[3].x=-u,H[3].y=-s,h=[],v=0;4>v;v++)h[v]={x:0,y:0};if(p)for(v=0;q>v;v++)h[0].x=f[v],h[0].y=g[v]-r,h[1].x=h[0].x+H[1].x,h[1].y=h[0].y+H[1].y,h[2].x=h[1].x+H[2].x,h[2].y=h[1].y+H[2].y,h[3].x=h[2].x+H[3].x,h[3].y=h[2].y+H[3].y,w(l,h);else for(v=0;q>v;v++)h[0].x=f[v],h[0].y=g[v]-r,h[1].x=h[0].x+H[1].x,h[1].y=h[0].y+H[1].y,h[2].x=h[1].x+H[2].x,h[2].y=h[1].y+H[2].y,h[3].x=h[2].x+H[3].x,h[3].y=h[2].y+H[3].y,p=l,z(p,h,void 0),p.stroke(),p.closePath();break;case d.L_PlusSymbol:for(v=0;q>v;v++)u=f[v],p=g[v],F(l,u,p+r,u,p-r),F(l,u+r,p,u-r,p);break;case d.L_HLineSymbol:for(v=0;q>v;v++)u=f[v],p=g[v],F(l,u+r,p,u-r,p);break;case d.L_VLineSymbol:for(v=0;q>v;v++)u=f[v],p=g[v],F(l,u,p+r,u,p-r);break;case d.L_XSymbol:for(v=0;q>v;v++)u=f[v],p=g[v],F(l,u-r,p-r,u+r,p+r),F(l,u+r,p-r,u-r,p+r);break;default:if(u=h,r=a.trunc(e.text_w/2),p)for(v=0;q>v;v++)l.fillText(u.substring(0,2),f[v]-r,g[v]+r)}},d.trace=function(e,x,f,C,q,h,k,n,v,r){if(f===c||C===c)throw"mx.trace requires xpoint and ypoint";if(h===c&&(h=1),k===c&&(k=1),n===c&&(n=0),v===c&&(v=0),r===c&&(r={}),0>=q)a.log.warn("No points to draw");else if(0===k&&0===n)a.log.warn("No line or symbol to draw");else{var s;r.dashed&&(s={mode:"dashed",on:4,off:4});var u=d.origin(e.origin,4,e.stk[e.level]);if(0!==u.xscl&&0!==u.yscl){var p=u.x1,H=u.y1,I=u.xmin,O=1/u.xscl,t=u.ymin,w=1/u.yscl;r.noclip||d.clip(e,p,H,u.x2-p+1,u.y2-H+1);var V=Math.abs(u.xmax-u.xmin),A=Math.abs(u.ymax-u.ymin),L=Math.min(u.xmin,u.xmax),u=Math.min(u.ymin,u.ymax),P=L+V,F=u+A,D=4*Math.ceil(2*f.length),R=new Int32Array(new ArrayBuffer(D)),D=new Int32Array(new ArrayBuffer(D)),z=0;if(0===k){for(var y=h-1;q>=y;y+=h){var E=f[y],G=C[y],J=E>=L&&P>=E&&G>=u&&F>=G;J&&(R[z]=Math.round((E-I)*O)+p,D[z]=Math.round((G-t)*w)+H,z+=1)}0!==n&&z>1&&d.draw_symbols(e,x,R.subarray(0),D.subarray(0),z,n,v)}else if(!0===r.vertsym){for(y=h-1;q>=y;y+=h)E=f[y],G=C[y],E>=L&&P>=E&&(k=Math.round((E-I)*O)+p,d.draw_line(e,x,k,0,k,e.height),G>=u&&F>=G&&(R[z]=k,D[z]=Math.round((G-t)*w)+H,z+=1));0!==n&&z>1&&d.draw_symbols(e,x,R.subarray(0),D.subarray(0),z,n,v)}else if(!0===r.horzsym){for(y=h-1;q>=y;y+=h)E=f[y],G=C[y],G>=u&&F>=G&&(k=Math.round((G-t)*w)+H,d.draw_line(e,x,0,k,e.width,k),E>=L&&P>=E&&(R[z]=Math.round((E-I)*O)+p,D[z]=k,z+=1));0!==n&&z>1&&d.draw_symbols(e,x,R.subarray(0),D.subarray(0),z,n,v)}else{var M;if(r&&r.highlight){for(M=[],M.push({start:p,color:x}),y=0;y<r.highlight.length;y++)r.highlight[y].xstart>=P||r.highlight[y].xend<=L||(G=Math.max(r.highlight[y].xstart,L),E=Math.min(r.highlight[y].xend,P),E>G&&(G=Math.round((G-I)*O)+p,E=Math.round((E-I)*O)+p,M.push({start:G,end:E,color:r.highlight[y].color})));M.sort(function(e,a){return e.start-a.start})}else M=x;var N,Q=(e.stk[e.level].xmax+e.stk[e.level].xmin)/2,T=(e.stk[e.level].ymax+e.stk[e.level].ymin)/2,E=f[0],G=C[0];N=g(0,Q,T,e.stk[e.level].xmin,e.stk[e.level].ymin,E,G),(J=E>=L&&P>=E&&G>=u&&F>=G)?(R[z]=Math.round((E-I)*O)+p,D[z]=Math.round((G-t)*w)+H,z+=1,0!==n&&d.draw_symbols(e,x,R,D,1,n,v)):z=0;for(var S=0,U=!1,y=h;h*(q-1)>=y;y+=h)if(V=E,A=G,E=f[y],G=C[y],N=g(N,Q,T,V,A,E,G),U=E>=L&&P>=E&&G>=u&&F>=G,J&&U)R[z]=Math.round((E-I)*O)+p,D[z]=Math.round((G-t)*w)+H,z+=1;else if(J=U,V-=E,A-=G,0!==V||0!==A){var W={tL:1,tE:0};l(V,L-E,W)&&l(-V,E-P,W)&&l(A,u-G,W)&&l(-A,G-F,W)&&(1>W.tL&&(R[z]=Math.round((E-I+W.tL*V)*O)+p,D[z]=Math.round((G-t+W.tL*A)*w)+H,z+=1),0<W.tE?(R[z]=Math.round((E-I+W.tE*V)*O)+p,D[z]=Math.round((G-t+W.tE*A)*w)+H,z+=1,d.draw_lines(e,M,R.subarray(S,z),D.subarray(S,z),z-S,k,s),0!==n&&z-S>2&&d.draw_symbols(e,x,R.subarray(S+1,z),D.subarray(S+1,z),z-S-1,n,v),S=z):(R[z]=Math.round((E-I)*O)+p,D[z]=Math.round((G-t)*w)+H,z+=1))}N=g(N,Q,T,E,G,e.stk[e.level].xmax,e.stk[e.level].ymin),N=g(N,Q,T,e.stk[e.level].xmax,e.stk[e.level].ymin,e.stk[e.level].xmin,e.stk[e.level].ymin),z-S>0&&(d.draw_lines(e,M,R.subarray(S,z),D.subarray(S,z),z-S,k,s),U&&(S+=1),0!==n&&z-S>1&&d.draw_symbols(e,x,R.subarray(S,z),D.subarray(S,z),z-1,n,v)),r.fillStyle&&(z>1||0!==N)&&d.fill_trace(e,r.fillStyle,R,D,z)}r.noclip||d.clip(e,0,0,0,0)}}},d.draw_mode=function(e,a,d){e.linewidth=a===c?1:a,e.style=d},d.draw_line=function(e,d,f,g,q,h,k,l){var v=e.active_canvas.getContext("2d");k===c&&(k=e.linewidth),l===c&&(l=e.style),"number"==typeof d&&(e.pixel&&0!==e.pixel.length?(d=Math.max(0,Math.min(e.pixel.length,d)),d=A(e.pixel[d].red,e.pixel[d].green,e.pixel[d].blue)):(a.log.warn("COLORMAP not initialized, defaulting to foreground"),d=e.fg)),F(v,f,g,q,h,l,d,k)},d.rubberline=function(e,a,c,d,f){e=e.active_canvas.getContext("2d"),F(e,a,c,d,f,{mode:"xor"},"white",1)},d.fill_trace=function(e,a,c,f,q){var h=e.active_canvas.getContext("2d");if(h.fillStyle=Array.isArray(a)?d.linear_gradient(e,0,0,0,e.b-e.t,a):a,1>q)h.fillRect(e.l,e.t,e.r-e.l,e.b-e.t);else if(a){a=c[0];var g=f[0];h.beginPath(),g===e.t?h.lineTo(e.l,e.t):h.lineTo(e.l,e.b),h.lineTo(a,g);for(var k=1;q>k;k++)a=c[k],g=f[k],h.lineTo(a,g);g===e.t&&h.lineTo(e.r,e.t),h.lineTo(e.r,e.b),f[0]===e.t&&h.lineTo(e.l,e.b),h.closePath(),h.fill()}},d.draw_lines=function(e,d,f,g,q,h,k){var l=e.active_canvas.getContext("2d");if(!(1>q)){var v=f[0],r=g[0];for(h===c&&(h=e.linewidth),k===c&&(k=e.style),k&&"dashed"===k.mode&&(dashOn(l,k.on,k.off)||a.log.warn("WARNING: Dashed lines aren't supported on your browser")),l.lineWidth=h,e=0,"string"==typeof d?d=[{start:0,color:d}]:d instanceof Array||(d.start===c&&(d.start=0),d=[d]),h=0;h<d.length;h++)null!=d[h].end&&d[h].end<v?d.remove(h):d[h].start<v&&(e=h);for(l.strokeStyle=d[e].color,l.beginPath(),l.moveTo(v,r),h=0;q>h;h++)if(v!==f[h]||r!==g[h]){if(v=f[h],r=g[h],k=!1,e>0&&null!=d[e].end&&d[e].end<v)for(k=!0;null!=d[e].end&&d[e].end<v&&(d.remove(e),e-=1,0!==e););if(e+1<d.length&&d[e+1].start<=v)for(k=!0;e+1<d.length&&d[e+1].start<=v;)e++;l.lineTo(v,r),k&&(l.stroke(),l.strokeStyle=d[e].color,l.beginPath(),l.lineTo(v,r))}l.stroke(),dashOff(l),l.beginPath()}},d.clip=function(e,a,c,d,f){e=e.active_canvas.getContext("2d"),0===a&&0===c&&0===d&&0===f?e.restore():(e.save(),e.beginPath(),e.rect(a,c,d,f),e.clip())},d.clear_window=function(e){var a=e.active_canvas.getContext("2d");a.fillStyle=e.bg,a.fillRect(0,0,e.width,e.height)},d.erase_window=function(e){e.active_canvas.getContext("2d").clearRect(0,0,e.width,e.height)},d.rubberbox=function(e,a,c,f,q){d.warpbox(e,e.xpos,e.ypos,e.xpos,e.ypos,0,e.width,0,e.width,a,c,f,q)},d.warpbox=function(e,a,c,d,f,h,g,k,l,r,s,u,p){u||(u={}),e.warpbox=new y,e.warpbox.xo=a,e.warpbox.yo=c,e.warpbox.xl=d,e.warpbox.yl=f,e.warpbox.xmin=h,e.warpbox.xmax=g,e.warpbox.ymin=k,e.warpbox.ymax=l,e.warpbox.func=r,e.warpbox.mode=s,e.warpbox.style=u,e.warpbox.def_style=u,e.warpbox.alt_style=p},d.origin=function(e,a,c){e=Math.max(1,e),a=Math.max(1,a);var f=new d.STKSTRUCT;if(f.xmin=c.xmin,f.xmax=c.xmax,f.ymin=c.ymin,f.ymax=c.ymax,f.xscl=c.xscl,f.yscl=c.yscl,f.x1=c.x1,f.y1=c.y1,f.x2=c.x2,f.y2=c.y2,e!==a){var q=Math.abs(a-e);e=a+e,(2===q||5!==e)&&(f.xmin=c.xmax,f.xmax=c.xmin,f.xscl=-c.xscl),(2===q||5===e)&&(f.ymin=c.ymax,f.ymax=c.ymin,f.yscl=-c.yscl)}return f},d.mult=function(e,a){var c=Math.max(Math.abs(e),Math.abs(a));if(0===c)return 1;var d=.1447648*Math.log(c),d=d|d;return 1>c&&(d-=1),0>d?1/Math.pow(10,-3*d):Math.pow(10,3*d)},d.widget_callback=function(e,a){e.prompt&&3===a.which&&e.prompt.input.onsubmit(),e.widget&&e.widget.callback(a)},d.prompt=function(e,a,f,g,q,h,k,l,v){if(h!==c&&(q=f(h),!q.valid))throw"Prompt default input value not valid due to '"+q.reason+"'";d.onWidgetLayer(e,function(){var r=e.active_canvas.getContext("2d"),s=r.font.indexOf("px"),u=s+3,s=r.font.substr(0,s),r=r.font.substr(u,r.font.length).toString(),r=new CanvasInput({height:e.text_h,fontFamily:r,fontSize:new Number(s),backgroundColor:e.bg,fontColor:e.fg,borderWidth:0,borderRadius:0,padding:0,boxShadow:"none",innerShadow:"none",width:30*e.text_w,value:h!==c?h.toString():"",disableBlur:!0,renderOnReturn:!1,tabToClear:!0}),p=function(a,r){return function(){var s=this.value(),p=f(s);p.valid?(e.prompt=c,this.cleanup(),d.onWidgetLayer(e,function(){d.erase_window(e)}),g(s)):(d.message(e,"Value: '"+s+"' isn't valid due to '"+p.reason+"' - RETRY",c,a,r),setTimeout(function(){d.onWidgetLayer(e,function(){d.erase_window(e)}),e.widget=null},null!=v?v:4e3))}},u=function(e,a,c){return function(r,s){d.onWidgetLayer(e,function(){var u=(c.length+2)*e.text_w,f=u+31*e.text_w+6,x=2*e.text_h+6;r||(r=e.xpos),s||(s=e.ypos);var h=Math.max(0,Math.min(r,e.width-f)),q=Math.max(0,Math.min(s,e.height-x)),g=h+3,B=q+3,k=B+1.5*e.text_h,l=g+e.text_w;d.widgetbox(e,h,q,f,x,g,B,0,""),d.text(e,l,k,c),f=k-1.15*e.text_h,a.x(g+e.text_w+u-e.text_w),a.y(f),a.onsubmit(p(h,f-75)),a.canvas()?a.render():a.canvas(e.active_canvas)})}}(e,r,a);u(k,l),r.focus(),e.prompt={redraw:u,input:r}})},d.floatValidator=function(e,a){return(a!==c&&!1!==a||""!==e)&&isNaN(parseFloat(e))||!isFinite(e)?{valid:!1,reason:"Failed float validation: not a valid floating point number"}:{valid:!0,reason:""}},d.intValidator=function(e,a){return(a===c||!1===a)&&""===e||parseFloat(e)===parseInt(e,10)&&!isNaN(e)?{valid:!0,reason:""}:{valid:!1,reason:"Failed integer validation: not a valid integer"}},d.message=function(e,a,c,f,q,h){d.onWidgetLayer(e,function(){d.render_message_box(e,a,f,q),e.widget={type:h||"ONESHOT",callback:function(a){("mousedown"===a.type||"keydown"===a.type)&&(e.widget=null,d.onWidgetLayer(e,function(){d.erase_window(e)}))}}})},d.render_message_box=function(e,a,c,f){var g,q=a.split(/\r\n|\r|\n/g),h=0;if(1===q.length){if(h=Math.min((e.width-6)/e.text_w-2,a.length),0>=h)return;for(;h>40&&2.5*e.text_h*a.length<e.height*h;)h-=5;var k=0,l=0,r=0,s=0,u=0,p=0,q=[];for(g=!0;l<a.length;){for(var u=l+h-1,p=u=Math.min(u,a.length-1),H=!1,k=l;u>=k&&!H;k++)switch(a[k]){case",":case";":case" ":case":":p=k;break;case"-":case"/":p!==k-1&&(p=k);break;case"@":case"\n":case"\r":g=!1,H=!0,p=k}k===a.length&&(p=u),H?q.push(a.substring(l,p)):(k=a.substring(l,p+1).replace(/^\s+/,""),q.push(k)),l=p+1,s=Math.max(s,q[r].length)}}else for(r=0;r<q.length;r++)h=Math.min((e.width-6)/e.text_w-2,Math.max(h,q[r].length));for(s=q.length,s>6&&(g=!1),k=0,r=Math.max(1,e.height/e.text_h),a=Math.min(s,k+r-1),h=(h+2)*e.text_w+6,s=(a-k+1)*e.text_h+6,c||(c=e.xpos),f||(f=e.ypos),c=Math.max(e.l,Math.min(c,e.r-h)),r=Math.max(e.t,Math.min(f,e.b-s)),f=c+3,p=r+3,d.widgetbox(e,c,r,h,s,f,p,0,""),s=p+e.text_h/3,r=f+e.text_w;a>k;)s+=e.text_h,g&&(r=c+h/2-q[k].length*e.text_w/2),d.text(e,r,s,q[k]),k++},d.draw_round_box=function(a,d,f,g,q,h,k,l,v){a=a.active_canvas.getContext("2d"),v||(v=5),a.beginPath(),a.moveTo(f+v,g),a.lineTo(f+q-v,g),a.quadraticCurveTo(f+q,g,f+q,g+v),a.lineTo(f+q,g+h-v),a.quadraticCurveTo(f+q,g+h,f+q-v,g+h),a.lineTo(f+v,g+h),a.quadraticCurveTo(f,g+h,f,g+h-v),a.lineTo(f,g+v),a.quadraticCurveTo(f,g,f+v,g),a.closePath(),a.lineWidth=1,a.strokeStyle=d,a.stroke(),k!==c&&k>0&&(f=a.globalAlpha,a.globalAlpha=k,a.fillStyle=l?l:d,a.fill(),a.globalAlpha=f)},d.draw_box=function(a,d,f,g,q,h,k,l){var v=a.active_canvas.getContext("2d");if("xor"!==d)v.lineWidth=1,v.strokeStyle=d,v.strokeRect(f,g,q,h);else if("undefined"==typeof Uint8ClampedArray)v.lineWidth=1,v.strokeStyle=a.fg,v.strokeRect(f,g,q,h);else{f=Math.floor(f),g=Math.floor(g),q=Math.floor(q),h=Math.floor(h),a=a.canvas.getContext("2d");for(var r=a.getImageData(f,g,q,1),s=r.data,u=0;u<r.data.length;u++)s[4*u]=255-s[4*u],s[4*u+1]=255-s[4*u+1],s[4*u+2]=255-s[4*u+2],s[4*u+3]=255;for(v.putImageData(r,f,g),r=a.getImageData(f,g+h,q,1),s=r.data,u=0;u<r.data.length;u++)s[4*u]=255-s[4*u],s[4*u+1]=255-s[4*u+1],s[4*u+2]=255-s[4*u+2],s[4*u+3]=255;for(v.putImageData(r,f,g+h),r=a.getImageData(f,g,1,h),s=r.data,u=0;h>u;u++)s[4*u]=255-s[4*u],s[4*u+1]=255-s[4*u+1],s[4*u+2]=255-s[4*u+2],s[4*u+3]=255;for(v.putImageData(r,f,g),r=a.getImageData(f+q,g,1,h),s=r.data,u=0;h>u;u++)s[4*u]=255-s[4*u],s[4*u+1]=255-s[4*u+1],s[4*u+2]=255-s[4*u+2],s[4*u+3]=255;v.putImageData(r,f+q,g)}k!==c&&k>0&&(a=v.globalAlpha,v.globalAlpha=k,v.fillStyle=l?l:d,v.fillRect(f+1,g+1,q-1,h-1),v.globalAlpha=a)},d.set_font=function(a,c){var d=a.canvas.getContext("2d"),f=a.wid_canvas.getContext("2d");if(a.font&&a.font.width===c)d.font=a.font.font,f.font=a.font.font;else{var g=1;do{g+=1,d.font=g+"px Courier New, monospace",f.font=g+"px Courier New, monospace";var h=d.measureText("M");a.text_w=h.width,a.text_h=g}while(a.text_w<c);a.font={font:g+"px Courier New, monospace",width:c}}},d.textline=function(a,c,d,f,g,h){var k=a.active_canvas.getContext("2d");h||(h={}),h.color||(h.color=a.fg),h.width||(h.width=1),F(k,c,d,f,g,h,h.color,h.width)},d.tics=function(a,c,d,f){var g=1,h=a;return c===a?{dtic:1,dtic1:a}:(g=Math.abs(c-a)/d,d=Math.max(g,1e-36),d=Math.log(d)/Math.log(10),0>d?(d=Math.ceil(d),d-=1):d=Math.floor(d),g*=Math.pow(10,-d),d=Math.pow(10,d),h=g*d,f&&h>=5&&5140800>=h?(f=17.5>h?5:37.5>h?15:270>h?60:1050>h?300:2250>h?900:7200>h?3600:16200>h?10800:32400>h?21600:129600>h?43200:518400>h?86400:604800,g=Math.round(h/f)*f):g=1.75>g?d:2.25>g?2*d:3.5>g?2.5*d:7>g?5*d:10*d,0===g&&(g=1),c>=a?(f=Math.floor(a>=0?a/g+.995:a/g-.005),h=f*g):(f=Math.floor(a>=0?a/g+.005:a/g-.995),h=f*g,g*=-1),h+g===h&&(g=c-a),{dtic:g,dtic1:h})},d.drawaxis=function(e,f,g,k,q,h){var l=d.origin(e.origin,1,e.stk[e.level]),n=0,v=0,r=0,s=0,u=0,p=0;k=k===c?30:k,q=q===c?30:q,h.exactbox?(n=Math.floor(l.x1),v=Math.floor(l.y1),r=Math.floor(l.x2),s=Math.floor(l.y2),u=r-n,p=s-v):(n=Math.max(Math.floor(l.x1)-2,0),v=Math.max(Math.floor(l.y1)-2,0),r=Math.min(Math.floor(l.x2)+2,e.width),s=Math.min(Math.floor(l.y2)+2,e.height),u=r-n-4,p=s-v-4);var H=e.active_canvas.getContext("2d");H.fillStyle=h.fillStyle?Array.isArray(h.fillStyle)?d.linear_gradient(e,0,0,0,s-v,h.fillStyle):h.fillStyle:e.bg,H.fillRect(n,v,r-n,s-v),h.noaxisbox||(d.textline(e,n,v,r,v),d.textline(e,r,v,r,s),d.textline(e,r,s,n,s),d.textline(e,n,s,n,v));var I=!1;4===k&&(I=!0),H=!1,4===q&&(H=!0);var t={dtic:0,dtic1:0},K={dtic:0,dtic1:0};0>f?(t.dtic1=l.xmin,t.dtic=(l.xmin-l.xmax)/f):t=d.tics(l.xmin,l.xmax,f,I);var w=1;h.xmult?w=h.xmult:I||(w=d.mult(l.xmin,l.xmax)),0>g?(K.dtic1=l.ymin,K.dtic=(l.ymin-l.ymax)/g):K=d.tics(l.ymin,l.ymax,g,H),f=1,h.ymult?f=h.ymult:H||(f=d.mult(l.ymin,l.ymax));var z=!h.noxtlab;g=!h.noytlab;var P,F,A=Math.max(0,n-4*e.text_w),L=0,L=h.ontop?Math.min(e.height,Math.floor(s+1.5*e.text_h)):Math.max(e.text_h,Math.floor(v-.5*e.text_h));L>0&&(h.noyplab||(F=a.label(q,f)),h.noxplab||(P=a.label(k,w))),P&&F?d.text(e,A,L,F+" vs "+P):P?d.text(e,A,L,P):F&&d.text(e,A,L,F),k=5.5*e.text_w,q=0,q=h.ontop?h.inside?v+1*e.text_h:v-.2*e.text_h:h.inside?s-.5*e.text_h:s+1*e.text_h+2,u=l.xmin!==l.xmax?u/(l.xmax-l.xmin):u/1,w=0!==w?1/w:1,P=Math.min(12,Math.round(u*t.dtic)/e.text_w),F=1;var D="";if(z)if(I)D=a.sec2tod(t.dtic1),F=D.length*e.text_w<(r-n)/2;else for(var y,L=t.dtic1;L<=l.xmax;L+=t.dtic){if(D=d.format_f(L*w,P,P/2),D===y){F=0;break}y=D}for(0===t.dtic&&(t.dtic=l.xmax-t.dtic1+1),A=0,D="",L=t.dtic1;L<=l.xmax;L+=t.dtic)if(y=n+Math.round(u*(L-l.xmin))+2,!(n>y)&&(h.grid&&"y"!==h.grid?(h.gridStyle||(h.gridStyle=d.LEGACY_RENDER?{mode:"dashed",on:1,off:3}:{color:e.xwms,mode:"dashed",on:1,off:3}),d.textline(e,y,s,y,v,h.gridStyle)):(d.textline(e,y,s-2,y,s+2),d.textline(e,y,v-2,y,v+2)),z))if(F){if(D=null,I?y>A&&(D=a.sec2tod(L,!0),A=y+e.text_w*(D.length+1)):(D=d.format_f(L*w,P,P/2),D=E(D,!0)),D){var G=Math.round(D.length/2)*e.text_w;h.inside&&(y=Math.max(n+G,y),y=Math.min(r-G,y)),d.text(e,y-G,q,D)}}else L===t.dtic1&&(I?(D=a.sec2tod(L,!0),h.inside&&(y=Math.floor(Math.max(n+k,y))),d.text(e,y-k,q,D+" +Δ "+a.sec2tod(t.dtic))):(D=(t.dtic1*w).toString(),h.inside&&(y=Math.floor(Math.max(n+k,y))),d.text(e,y-k,q,D+" +Δ "+t.dtic*w)));for(k=h.yonright?h.inside?Math.min(r-6*e.text_w,e.width-5*e.text_w):Math.min(r+e.text_w,e.width-5*e.text_w):h.inside?Math.max(0,n+e.text_w):Math.max(0,Math.floor(n-5.5*e.text_w)),q=.4*e.text_h,u=l.ymin!==l.ymax?-p/(l.ymax-l.ymin):-p/1,w=0!==f?1/f:1,p=l.ymax>=l.ymin?function(a){return a<=l.ymax}:function(a){return a>=l.ymax},t=K.dtic1;p(t);t+=K.dtic)y=s+Math.round(u*(t-l.ymin))-2,y>s||(h.grid&&"x"!==h.grid?(h.gridStyle||(h.gridStyle={mode:"dashed",on:1,off:3}),d.textline(e,n,y,r,y,h.gridStyle)):(d.textline(e,n-2,y,n+2,y),d.textline(e,r-2,y,r+2,y)),!g||h.inside&&(y<v+e.text_h||y>s-2*e.text_h)||(H?(I=a.sec2tod(t),f=y+q-e.text_h,z=I.indexOf("::"),-1!==z&&(f>v&&s>f&&d.text(e,k,f,I.substring(0,z)),z+=1),d.text(e,k,Math.min(s,y+q),I.substring(z+1,z+6)),f=y+q+e.text_h,f>v&&s>f&&"00"!==I.substring(z+7,z+9)&&(I+=".00",d.text(e,k,f,I.substring(z+7,z+12)))):(I=d.format_f(t*w,12,6),I=E(I,h.inside),d.text(e,k,Math.min(s,y+q),I))))},d.inrect=function(a,c,d,f,g,h){return a>=d&&d+g>=a&&c>=f&&f+h>=c};var G={GBorder:3,sidelab:0,toplab:1};d.menu=function(a,g){var l=1.5*a.text_h;if(g){if(!a.widget){g.x=a.xpos,g.y=a.ypos,g.val=0,g.h=2*G.GBorder+l*g.items.length+G.toplab*(l+G.GBorder)-1,g.y=g.y-((G.toplab+Math.max(1,g.val)-.5)*l+(1+G.toplab)*G.GBorder)+1;for(var t=g.title.length,q=0,h=0;h<g.items.length;h++){var w=g.items[h],t=Math.max(t,w.text.length);"checkbox"===w.style&&(t+=2),"separator"===w.style&&(t+=2),w.checked&&"checkbox"!==w.style&&(q=l*h)}g.y-=q,t=(t+2)*a.text_w,g.w=2*G.GBorder+Math.abs(G.sidelab)+t-1,g.x-=g.w/2,a.menu=g,a.widget={type:"MENU",callback:function(h){var q=g;if(h===c)k(a,q);else if("mousemove"===h.type){q.drag_x!==c&&q.drag_y!==c&&2<Math.abs(a.xpos-q.drag_x)&&2<Math.abs(a.ypos-q.drag_y)&&(q.x+=a.xpos-q.drag_x,q.y+=a.ypos-q.drag_y,q.drag_x=a.xpos,q.drag_y=a.ypos);var r=q.x+G.GBorder+Math.max(0,G.sidelab),s=q.w-2*G.GBorder-Math.abs(G.sidelab),u=1.5*a.text_h,p=q.y+G.GBorder+G.toplab*(u+G.GBorder);for(h=0;h<q.items.length;h++){var H=p+u*h,l=q.items[h];l.selected=!1,d.inrect(a.xpos,a.ypos,r,H,s,u)&&(l.selected=!0)}k(a,q)}else if("mouseup"===h.type)q.drag_x=c,q.drag_y=c;else if("mousedown"===h.type)h.preventDefault(),1===h.which?a.xpos>q.x&&a.xpos<q.x+q.w&&a.ypos>q.y&&a.ypos<q.y+1.5*a.text_h?(q.drag_x=a.xpos,q.drag_y=a.ypos):f(a,q):n(a,q);else if("keydown"===h.type&&a.menu)if(q=a.menu,h.preventDefault(),h=getKeyCode(h),13===h)f(a,q);else if(38===h){for(h=0;h<q.items.length;h++){if(l=q.items[h],l.selected){l.selected=!1,q.items[h-1]!==c&&(q.items[h-1].selected=!0);break}h===q.items.length-1&&(l.selected=!0)}k(a,q)}else if(40===h){for(h=0;h<q.items.length;h++){if(l=q.items[h],l.selected){l.selected=!1,q.items[h+1]!==c&&(q.items[h+1].selected=!0);break}h===q.items.length-1&&(q.items[0].selected=!0)}k(a,q)}else if(h>=48&&57>=h||h>=65&&90>=h){for(h=String.fromCharCode(h).toUpperCase(),q.keypresses=q.keypresses===c?h:q.keypresses+h,h=r=0;h<q.items.length;h++)l=q.items[h],l.selected=!1,l.text&&0===l.text.toUpperCase().indexOf(q.keypresses)&&(0===r&&(l.selected=!0),r++);0===r?(q.keypresses=c,k(a,q)):1===r?f(a,q):k(a,q)}}}}k(a,g)}},d.widgetbox=function(a,c,f,g,q,h,l,k,n,r){d.shadowbox(a,c,f,g,q,1,2,"",.75),r&&(q=r.length,q=Math.min(q,g/a.text_w),q=Math.max(q,1),c+=(g-q*a.text_w)/2,f+=3,d.text(a,c,f+(l-f+.7*a.text_h)/2,r,a.xwfg)),k>0&&n>0&&(f=a.active_canvas.getContext("2d"),d.LEGACY_RENDER?(f.fillStyle=a.bg,f.fillRect(h,l,k,n)):(f.save(),f.globalAlpha=.1,f.fillStyle=a.bg,f.fillRect(h,l,k,n),f.restore()))},d.text=function(a,d,f,g,q){var h=a.active_canvas.getContext("2d");if(d=Math.max(0,d),f=Math.max(0,f),0>d||0>f)throw"On No!";h.textBaseline="bottom",h.textAlign="left",h.font=a.font.font,h.fillStyle=q===c?a.fg:q,h.fillText(g,d,f)},d.getcolor=function(a,c,d){for(a=0;6>a&&0===c[a+1].pos;a++);for(;d>c[a].pos&&6>a;)a++;if(0===a||d>=c[a].pos)return A(D(c[a].red),D(c[a].green),D(c[a].blue));d=D((d-c[a-1].pos)/(c[a].pos-c[a-1].pos)*100);var f=255-d;return A(c[a].red/100*d+c[a-1].red/100*f,c[a].green/100*d+c[a-1].green/100*f,c[a].blue/100*d+c[a-1].blue/100*f)},d.redraw_warpbox=function(a){a.warpbox&&(a._animationFrameHandle&&cancelAnimFrame(a._animationFrameHandle),a._animationFrameHandle=requestAnimFrame(function(){J(a)}))},d.format_g=function(a,c,f,g){Math.min(c,f+7),c=Math.abs(a).toString();var q=c.indexOf(".");-1===q&&(c+=".",q=c.length),g=0;var h=c.indexOf("e");-1!==h&&(g=parseInt(c.slice(h+1,c.length),10),c=c.slice(0,h));for(var h=Math.min(f-(c.length-q)+1,f),l=0;h>l;l++)c+="0";if(0!==a)if(1>Math.abs(a))if("0."===c.slice(0,2))for(l=2;l<c.length;l++){if("0"!==c[l]){c="0."+c.slice(l,l+f);break}g-=1}else c=c.slice(0,f+2);else q>f?(g=Math.max(0,q-1),c=c[0]+"."+c.slice(1,f+1)):c=c.slice(0,f+2);return 0===g?c+="    ":(f=d.pad(Math.abs(g).toString(),2,"0"),c=0>g?c+"E-"+f:c+"E+"+f),0>a?"-"+c:" "+c},d.format_f=function(a,c,f){return a=a.toFixed(f).toString(),a=d.pad(a,c+f," ")},d.pad=function(a,c,d){for(;a.length<c;)a=d+a;return a},d.legacy_shadowbox=function(e,c,f,g,q,h,l,k){for(var n=k.length,r=0,s=0,r=0,s=[],u=0;11>u;u++)s[u]={x:0,y:0};if(u=!(1===l||-1===l),0!==l&&0<d.GBorder&&(r=a.trunc(Math.min(g,q)/3),r=Math.max(1,Math.min(r,d.GBorder))),r>0){switch(s[0].x=s[1].x=c,s[8].x=s[9].x=c+g,s[1].y=s[8].y=f,s[0].y=s[9].y=f+q,h){case d.L_ArrowLeft:s[0].y=s[1].y=f+a.trunc(q/2),c+=2,--g;break;case d.L_ArrowRight:s[8].y=s[9].y=f+a.trunc(q/2),--c,--g;break;case d.L_ArrowUp:s[1].x=s[8].x=c+a.trunc(g/2),f+=2,--q;break;case d.L_ArrowDown:s[0].x=s[9].x=c+a.trunc(g/2),--f,--q}s[2]=s[8],s[10]=s[0],c+=r,f+=r,g-=2*r,q-=2*r}switch(s[4].x=s[5].x=c,s[3].x=s[6].x=c+g,s[3].y=s[4].y=f,s[5].y=s[6].y=f+q,h){case d.L_ArrowLeft:s[4].y=s[5].y=f+a.trunc(q/2);break;case d.L_ArrowRight:s[3].y=s[6].y=f+a.trunc(q/2);break;case d.L_ArrowUp:s[3].x=s[4].x=c+a.trunc(g/2);break;case d.L_ArrowDown:s[5].x=s[6].x=c+a.trunc(g/2)}s[7]=s[3],h=e.active_canvas.getContext("2d"),r>0&&(h.fillStyle=l>0?e.xwts:e.xwbs,w(h,s.slice(0,7)),h.fillStyle=0>l?e.xwts:e.xwbs,w(h,s.slice(5,11))),u&&(h.fillStyle=e.xwbg,w(h,s.slice(3,8))),h.fillStyle=e.xwfg,h.textBaseline="alphabetic",u&&n>0&&(n=Math.min(n,a.trunc(g/e.text_w)),n=Math.max(n,1),r=c+a.trunc((g-n*e.text_w)/2),s=f+a.trunc((q+.7*e.text_h)/2),h.fillText(k,r,s))},d.sigplot_shadowbox=function(e,c,f,g,q,h,l,k,n){var r=e.active_canvas.getContext("2d"),s=k.length,u=0>l?e.xwts:e.xwbs;n=n||1;for(var p=[],H=0;11>H;H++)p[H]={x:0,y:0};switch(h){case d.L_ArrowLeft:case d.L_ArrowRight:case d.L_ArrowUp:case d.L_ArrowDown:p=d.chevron(h,c,f,g,q),r.fillStyle=l>0?e.xwts:e.xwbs,w(r,p.slice(0,6));break;default:d.draw_round_box(e,u,c,f,g,q,n,e.xwbg,5,e.xwbs)}r.fillStyle=e.xwfg,r.textBaseline="alphabetic",1!==l&&-1!==l&&s>0&&(s=Math.min(s,a.trunc(g/e.text_w)),s=Math.max(s,1),c+=a.trunc((g-s*e.text_w)/2),e=f+a.trunc((q+.7*e.text_h)/2),r.fillText(k,c,e))},d.shadowbox=d.LEGACY_RENDER?d.legacy_shadowbox:d.sigplot_shadowbox,d.chevron=function(e,c,f,g,q,h){var l=Math.min(g,q);h||(h=.25*l);for(var k=[],n=0;6>n;n++)k[n]={x:0,y:0};var n=a.trunc((g-l)/2+l/4-h/2.828),r=a.trunc((q-l)/2+l/4-h/2.828);switch(e){case d.L_ArrowLeft:k[0].x=c+n,k[0].y=f+a.trunc(l/2),k[1].x=c+n+a.trunc(l/2),k[1].y=f,k[2].x=c+n+a.trunc(l/2+h/1.414),k[2].y=f+a.trunc(h/1.414),k[3].x=c+n+a.trunc(2*h/1.414),k[3].y=f+a.trunc(l/2),k[4].x=c+n+a.trunc(l/2+h/1.414),k[4].y=f+q-a.trunc(h/1.414),k[5].x=c+n+a.trunc(l/2),k[5].y=f+l;break;case d.L_ArrowRight:k[0].x=c+g-n,k[0].y=f+a.trunc(l/2),k[1].x=c+g-n-a.trunc(l/2),k[1].y=f,k[2].x=c+g-n-a.trunc(l/2+h/1.414),k[2].y=f+a.trunc(h/1.414),k[3].x=c+g-n-a.trunc(2*h/1.414),k[3].y=f+a.trunc(l/2),k[4].x=c+g-n-a.trunc(l/2+h/1.414),k[4].y=f+q-a.trunc(h/1.414),k[5].x=c+g-n-a.trunc(l/2),k[5].y=f+l;break;case d.L_ArrowUp:k[0].x=c+a.trunc(l/2),k[0].y=f+r,k[1].x=c,k[1].y=f+r+a.trunc(l/2),k[2].x=c+a.trunc(h/1.414),k[2].y=f+r+a.trunc(l/2+h/1.414),k[3].x=c+a.trunc(l/2),k[3].y=f+r+a.trunc(2*h/1.414),k[4].x=c+g-a.trunc(h/1.414),k[4].y=f+r+a.trunc(l/2+h/1.414),k[5].x=c+l,k[5].y=f+r+a.trunc(l/2);break;case d.L_ArrowDown:k[0].x=c+a.trunc(l/2),k[0].y=f+q-r,k[1].x=c,k[1].y=f+q-r-a.trunc(l/2),k[2].x=c+a.trunc(h/1.414),k[2].y=f+q-r-a.trunc(l/2+h/1.414),k[3].x=c+a.trunc(l/2),k[3].y=f+q-r-a.trunc(2*h/1.414),k[4].x=c+g-a.trunc(h/1.414),k[4].y=f+q-r-a.trunc(l/2+h/1.414),k[5].x=c+l,k[5].y=f+q-r-a.trunc(l/2)}return k},d.ifevent=function(a,d){a.button_press=0,a.button_release=0,a.state_mask=0;var f=d.target.getBoundingClientRect(),g=d.offsetX===c?d.pageX-f.left-window.scrollX:d.offsetX,f=d.offsetX===c?d.pageY-f.top-window.scrollY:d.offsetY;switch(d.type){case"mousedown":switch(a.xpos=Q(g,0,a.width),a.ypos=Q(f,0,a.height),d.which){case 1:a.button_press=1;break;case 2:a.button_press=2;break;case 3:a.button_press=3;break;case 4:a.button_press=4;break;case 5:a.button_press=5}break;case"mouseup":switch(a.xpos=Q(g,0,a.width),a.ypos=Q(f,0,a.height),d.which){case 1:a.button_release=1;break;case 2:a.button_release=2;break;case 3:a.button_release=3;break;case 4:a.button_release=4;break;case 5:a.button_release=5}}},d.scroll_real2pix=function(a){if(0===a.range)return{s1:a.a1,sw:a.a2-a.a1};var c,d;return c=(a.a2-a.a1)/a.trange,d=a.a1+Math.floor(.5+(a.smin-a.tmin)*c),c=d+Math.floor(.5+a.srange*c),d=d>a.a2-a.swmin?a.a2-a.swmin:Math.max(d,a.a1),c=c<a.a1+a.swmin?a.a1+a.swmin:Math.min(c,a.a2),{s1:d,sw:Math.max(c-d,a.swmin)}},d.redrawScrollbar=function(e,c,f){var g,k,h,l,n,t,r,s,u=c.active_canvas.getContext("2d");k=d.scroll_real2pix(e),r=k.s1,s=k.sw,t=r,k=e.x,h=e.y,l=e.w,n=e.h,1&e.origin?(g=h+n/2,2&e.origin&&(t=l-t-s),f===d.XW_DRAW&&(f=e.arrow,d.shadowbox(c,k,h,f,n-1,d.L_ArrowLeft,2,"",0),d.shadowbox(c,k+l-f,h,f-1,n,d.L_ArrowRight,2,"",0)),d.LEGACY_RENDER?(d.draw_line(c,c.fg,k+e.a1,g,k+e.a2,g),d.shadowbox(c,k+t,h,s+1,n,1,2,"",0)):(f=u.createLinearGradient(k+e.a1,0,k+e.a2,0),f.addColorStop(0,c.xwbs),f.addColorStop(.5,c.xwts),f.addColorStop(1,c.xwbs),d.draw_line(c,f,k+e.a1,g,k+e.a2,g,1),f=u.createLinearGradient(0,h,0,h+n),f.addColorStop(.1,c.xwts),f.addColorStop(.75,c.xwbs),d.draw_round_box(c,c.xwbg,k+t,h,s+1,n,1,f,8,c.xwbs))):(g=k+a.trunc(l/2),2>=e.origin&&(t=n-t-s),f===d.XW_DRAW&&(f=e.arrow,d.shadowbox(c,k,h,l-1,f,d.L_ArrowUp,2,"",0),d.shadowbox(c,k,h+n-f,l-1,f,d.L_ArrowDown,2,"",0)),d.LEGACY_RENDER?(d.draw_line(c,c.fg,g,h+e.a1,g,h+e.a2),d.shadowbox(c,k,h+t,l,s+1,1,2,"",0)):(f=u.createLinearGradient(0,h+e.a1,0,h+e.a2),f.addColorStop(0,c.xwbs),f.addColorStop(.5,c.xwts),f.addColorStop(1,c.xwbs),d.draw_line(c,f,g,h+e.a1,g,h+e.a2,1),f=u.createLinearGradient(k,0,k+l,0),f.addColorStop(.1,c.xwts),f.addColorStop(.75,c.xwbs),d.draw_round_box(c,c.xwbg,k-1,h+t,l,s+1,1,f,8,c.xwbs))),e.s1=r,e.sw=s},d.real_to_pixel=function(a,c,f,g){if(a=d.origin(a.origin,4,a.stk[a.level]),0===a.xscl||0===a.yscl)return{x:0,y:0};var k=a.x1,h=a.y1,l=a.xmin,n=1/a.xscl,t=a.ymin,r=1/a.yscl,s=!1,u=!1;return null!==c&&(s=c>a.xmax||c<a.xmin,g&&(c=Math.min(c,a.xmax),c=Math.max(c,a.xmin)),c=Math.round((c-l)*n)+k),null!==f&&(u=f>a.ymin||f<a.ymax,g&&(f=Math.min(f,a.ymin),f=Math.max(f,a.ymax)),f=Math.round((f-t)*r)+h),c=Math.round(c),f=Math.round(f),{x:c,y:f,clipped_x:s,clipped_y:u,clipped:s||u}},d.pixel_to_real=function(a,c,d){c=Math.min(a.r,Math.max(a.l,c)),d=Math.min(a.b,Math.max(a.t,d));var f=a.level;return{x:2!==a.origin&&3!==a.origin?a.stk[f].xmin+(c-a.stk[f].x1)*a.stk[f].xscl:a.stk[f].xmin+(a.stk[f].x2-c)*a.stk[f].xscl,y:2<a.origin?a.stk[f].ymin+(d-a.stk[f].y1)*a.stk[f].yscl:a.stk[f].ymin+(a.stk[f].y2-d)*a.stk[f].yscl}},d.colormap=function(a,c,d){a.pixel=Array(d);for(var f=Array(d),g=100/(Math.max(2,d)-1),h=0;d>h;h++)f[h]=g*h+.5;for(g=0;6>g&&0===c[g+1].pos;g++);for(h=0;d>h;h++){a.pixel[h]=0;for(var k=f[h];6>g&&Math.floor(k)>c[g].pos;)g++;if(0===g||k>=c[g].pos)a.pixel[h]={red:D(c[g].red),green:D(c[g].green),blue:D(c[g].blue)};else{var k=D((k-c[g-1].pos)/(c[g].pos-c[g-1].pos)*100),l=255-k;a.pixel[h]={red:c[g].red/100*k+c[g-1].red/100*l,green:c[g].green/100*k+c[g-1].green/100*l,blue:c[g].blue/100*k+c[g-1].blue/100*l}}}},d.colorbar=function(a,c,f,g,k){for(var h=1;k>h;h++)d.draw_line(a,Math.floor(a.pixel.length*(h-1)/k),c,f+k-h,c+g,f+k-h);d.draw_box(a,a.fg,c+.5,f,g,k)};var T="undefined"==typeof Uint8ClampedArray?U:M;d.shift_image_rows=function(a,c,d){return a=new Uint32Array(c),d>0?(d*=c.width,a.set(a.subarray(0,a.length-d),d)):0>d&&(d=Math.abs(d)*c.width,a.set(a.subarray(d))),c},d.update_image_row=function(a,c,d,f,g,h){f=new Uint32Array(c,f*c.width*4,c.width);var k=1;for(h!==g&&(k=a.pixel.length/Math.abs(h-g)),h=0;h<d.length;h++){var l=Math.floor((d[h]-g)*k),l=Math.max(0,Math.min(a.pixel.length-1,l));(l=a.pixel[l])&&(f[h]=-16777216|l.blue<<16|l.green<<8|l.red)}return c},d.create_image=function(c,f,g,k,l,h){c.active_canvas.getContext("2d"),c.pixel&&0!==c.pixel.length||(a.log.warn("COLORMAP not initialized, defaulting to foreground"),d.colormap(c,a.Mc.colormap[1].colors,16));var n=1;h!==l&&(n=c.pixel.length/Math.abs(h-l)),g=Math.ceil(g),k=Math.ceil(k),h=new ArrayBuffer(g*k*4),h.width=g,h.height=k;for(var t=new Uint32Array(h),v=0;v<t.length;v++){var r=Math.floor((f[(3===c.origin||4===c.origin?Math.floor(v/g):k-Math.floor(v/g)-1)*g+(1===c.origin||4===c.origin?Math.floor(v%g):g-Math.floor(v%g)-1)]-l)*n),r=Math.max(0,Math.min(c.pixel.length-1,r));(r=c.pixel[r])&&(t[v]=-16777216|r.blue<<16|r.green<<8|r.red)}return h},d.put_image=function(c,f,g,k,l,h,n,t,v,r,s){v=c.active_canvas.getContext("2d"),c.pixel&&0!==c.pixel.length||(a.log.warn("COLORMAP not initialized, defaulting to foreground"),d.colormap(c,a.Mc.colormap[1].colors,16)),g=Math.floor(l>0?g*l:-l),k=Math.floor(k*h),h=new ArrayBuffer(g*k*4),h.width=g,h.height=k,l=new Uint32Array(h);for(var u=0;u<l.length;u++){var p=Math.max(0,f[u]),p=Math.min(c.pixel.length-1,p);(p=c.pixel[p])&&(l[u]=-16777216|p.blue<<16|p.green<<8|p.red)}return T(c,v,h,r,s,n,t,g,k),h},d.draw_image=function(a,c,f,g,k,h,l,n){var t=Math.max(f,a.stk[a.level].xmin),r=Math.min(k,a.stk[a.level].xmax),s=Math.max(g,a.stk[a.level].ymin),u=Math.min(h,a.stk[a.level].ymax);if(!(1>=c.width||0===Math.abs(k-f)||1>=c.height||0===Math.abs(h-g))){k=c.width/(k-f);var H,I,O,K,w,z,p=c.height/(h-g),t=Math.floor(t*k)/k,r=Math.ceil(r*k)/k,s=Math.floor(s*p)/p,u=Math.ceil(u*p)/p;1===a.origin?(O=Math.max(0,Math.floor((h-u)*p)),z=Math.min(c.height-O,Math.floor((u-s)*p)),K=Math.max(0,Math.floor((t-f)*k)),w=Math.min(c.width-K,Math.floor((r-t)*k)),H=d.real_to_pixel(a,t,u),I=d.real_to_pixel(a,r,s)):2===a.origin?(O=Math.max(0,Math.floor((h-u)*p)),z=Math.min(c.height-O,Math.floor((u-s)*p)),K=Math.max(0,Math.ceil((t-f)*k)),w=Math.min(c.width-K,Math.floor((r-t)*k)),H=d.real_to_pixel(a,r,u),I=d.real_to_pixel(a,t,s)):3===a.origin?(O=Math.max(0,Math.ceil((s-g)*p)),z=Math.min(c.height-O,Math.floor((u-s)*p)),K=Math.max(0,Math.ceil((t-f)*k)),w=Math.min(c.width-K,Math.floor((r-t)*k)),H=d.real_to_pixel(a,r,s),I=d.real_to_pixel(a,t,u)):4===a.origin&&(O=Math.max(0,Math.ceil((s-g)*p)),z=Math.min(c.height-O,Math.floor((u-s)*p)),K=Math.max(0,Math.floor((t-f)*k)),w=Math.min(c.width-K,Math.floor((r-t)*k)),H=d.real_to_pixel(a,t,s),I=d.real_to_pixel(a,r,u)),f=I.x-H.x,I=I.y-H.y,w=Math.max(1,w),z=Math.max(1,z),g=a.active_canvas.getContext("2d"),g.save(),g.beginPath(),g.rect(a.l,a.t,a.r-a.l,a.b-a.t),g.clip(),T(a,g,c,l,n,H.x,H.y,f,I,K,O,w,z),g.restore()
}}}(window.mx,window.m),function(d,a,c,y){d.Layer1D=function(a){this.plot=a,this.ybuf=this.xbuf=y,this.xmax=this.xmin=this.imin=this.xdelta=this.xstart=this.offset=0,this.name="",this.cx=!1,this.hcb=y,this.size=0,this.display=!0,this.color=0,this.line=3,this.thick=1,this.symbol=0,this.radius=3,this.ysub=this.xsub=this.skip=0,this.modified=this.xdata=!1,this.preferred_origin=this.opacity=1,this.pointbufsize=0,this.ypoint=this.xpoint=this.yptr=this.xptr=null,this.options={}},d.Layer1D.prototype={init:function(a,k){this.hcb=a,this.hcb.buf_type="D",this.ybufn=this.xbufn=this.size=this.offset=0,this.hcb.pipe?this.size=k.framesize:2===a["class"]?(c.force1000(a),this.size=a.subsize):this.size=a.size,2>=a["class"]&&(this.xsub=-1,this.ysub=1,this.cx="C"===a.format[0]),this.skip=1,this.cx&&(this.skip=2),this.xstart=a.xstart,this.xdelta=a.xdelta;var f=a.xstart+a.xdelta*(this.size-1);if(this.xmin=Math.min(a.xstart,f),this.xmax=Math.max(a.xstart,f),this.xlab=a.xunits,this.ylab=a.yunits,this.hcb.pipe){this.drawmode="scrolling",this.position=0,this.tle=k.tl,this.ybufn=this.size*Math.max(this.skip*d.PointArray.BYTES_PER_ELEMENT,d.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn);var n=this;c.addPipeWriteListener(this.hcb,function(){n._onpipewrite()})}},_onpipewrite:function(){var a=new d.PointArray(this.ybuf),k=this.tle;if(k===y)k=Math.floor(c.pavail(this.hcb))/this.hcb.spa;else if(c.pavail(this.hcb)<k*this.hcb.spa)return;var f=k*this.hcb.spa;if("lefttoright"===this.drawmode)this.position=0,a.set(a.subarray(0,this.size-f),f);else if("righttoleft"===this.drawmode)this.position=this.size-k,a.set(a.subarray(f),0);else if("scrolling"!==this.drawmode)throw"Invalid draw mode";k=Math.min(k,this.size-this.position),0!==c.grabx(this.hcb,a,k*this.hcb.spa,this.position*this.hcb.spa)&&(this.position=(this.position+k)%this.size,1<this.plot._Gx.autol&&this.plot.rescale())},get_data:function(a,k){var t,f=this.plot._Gx,n=this.hcb,l=this.skip;t=2===n["class"]?n.subsize:n.size;var w=0,l=0;f.index?(w=Math.floor(a),l=Math.floor(k+.5)):0<=n.xdelta?(w=Math.floor((a-n.xstart)/n.xdelta)-1,l=Math.floor((k-n.xstart)/n.xdelta+.5)):(w=Math.floor((k-n.xstart)/n.xdelta)-1,l=Math.floor((a-n.xstart)/n.xdelta+.5)),w=Math.max(0,w),l=Math.min(t,l),f=Math.max(0,Math.min(l-w+1,f.bufmax)),0>n.xdelta&&(w=l-f+1),!(w>=this.imin&&w+f<=this.imin+this.size&&this.ybuf!==y||this.modified)&&2>=n["class"]&&(t=this.offset+w,l=this.skip,this.ybufn=f*Math.max(l*d.PointArray.BYTES_PER_ELEMENT,d.PointArray.BYTES_PER_ELEMENT),(this.ybuf===y||this.ybuf.byteLength<this.ybufn)&&(this.ybuf=new ArrayBuffer(this.ybufn)),l=new d.PointArray(this.ybuf),f=c.grab(n,l,t,f),this.imin=w,this.xstart=n.xstart+w*this.xdelta,this.size=f)},change_settings:function(a){if(a.index!==y)if(a.index)this.xmin=this.xdelta=this.xstart=1,this.xmax=this.size;else{this.xstart=this.hcb.xstart+this.imin*this.xdelta,this.xdelta=this.hcb.xdelta;var c=this.hcb.xstart+this.hcb.xdelta*(this.size-1);this.xmin=Math.min(this.hcb.xstart,c),this.xmax=Math.max(this.hcb.xstart,c)}a.drawmode!==y&&(this.drawmode=a.drawmode,this.position=0,this.ybufn=this.size*Math.max(this.skip*d.PointArray.BYTES_PER_ELEMENT,d.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn))},reload:function(a,d){if(this.hcb.pipe)throw"reload cannot be used with pipe, use push instead";var f=this.hcb.dview.length!==a.length||d;if(d)for(var n in d)this.hcb[n]=d[n];this.hcb.setData(a),this.imin=0,this.xstart=y,this.size=0,n=this.xmin;var l=this.xmax;return f&&(2===this.hcb["class"]&&c.force1000(this.hcb),f=this.hcb.xstart+this.hcb.xdelta*(this.hcb.size-1),this.xmin=Math.min(this.hcb.xstart,f),this.xmax=Math.max(this.hcb.xstart,f),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart,l=n=y),{xmin:n,xmax:l}},push:function(a,k,f){if(k){for(var n in k)this.hcb[n]=k[n],"type"===n&&(this.hcb["class"]=k[n]/1e3);k.subsize&&2===this.hcb["class"]&&(c.force1000(this.hcb),this.size=this.hcb.subsize,this.position=null,this.ybufn=this.size*Math.max(this.skip*d.PointArray.BYTES_PER_ELEMENT,d.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn)),n=this.hcb.xstart+this.hcb.xdelta*(this.hcb.size-1),this.xmin=Math.min(this.hcb.xstart,n),this.xmax=Math.max(this.hcb.xstart,n),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart}return c.filad(this.hcb,a,f),k?!0:!1},prep:function(a,k){var f=this.plot._Gx,n=this.plot._Mx,l=Math.ceil(this.size),t=this.skip;if(0!==l){l*d.PointArray.BYTES_PER_ELEMENT>this.pointbufsize&&(this.pointbufsize=l*d.PointArray.BYTES_PER_ELEMENT,this.xptr=new ArrayBuffer(this.pointbufsize),this.yptr=new ArrayBuffer(this.pointbufsize),this.xpoint=new d.PointArray(this.xptr),this.ypoint=new d.PointArray(this.yptr));var A,E,w=new d.PointArray(this.ybuf),z=this.xmin,y=this.xmax;if(5===f.cmode||0<this.xsub)0>=l?(z=f.panxmin,y=f.panxmax):5!==f.cmode?this.xpoint=new d.PointArray(this.xbuf):this.cx?c.vmov(w,t,this.xpoint,1,l):0!==this.line?(E=c.vmxmn(w,l),this.xpoint[0]=E.smax,this.xpoint[1]=E.smin,l=2):this.xpoint=w,l>0&&(E=c.vmxmn(this.xpoint,l),y=E.smax,z=E.smin);else if(l>0){E=this.xstart;var J=this.xdelta,w=l;for(f.index?(A=0,l-=1):J>=0?(A=Math.max(1,Math.min(w,Math.round((a-E)/J)))-1,l=Math.max(1,Math.min(w,Math.round((k-E)/J)+2))-1):(A=Math.max(1,Math.min(w,Math.round((k-E)/J)-1))-1,l=Math.max(1,Math.min(w,Math.round((a-E)/J)+2))-1),l=l-A+1,0>l&&(c.log.debug("Nothing to plot"),l=0),w=new d.PointArray(this.ybuf).subarray(A*t),E+=J*A,A=0;l>A;A++)this.xpoint[A]=f.index?this.imin+A+1:E+A*J}if(f.panxmin>f.panxmax?(f.panxmin=z,f.panxmax=y):(f.panxmin=Math.min(f.panxmin,z),f.panxmax=Math.max(f.panxmax,y)),!(0>=l)){if(this.cx)1===f.cmode?c.cvmag(w,this.ypoint,l):2===f.cmode?25===f.plab?(c.cvpha(w,this.ypoint,l),c.vsmul(this.ypoint,1/(2*Math.PI),this.ypoint,l)):24!==f.plab?c.cvpha(w,this.ypoint,l):c.cvphad(w,this.ypoint,l):3===f.cmode?c.vmov(w,t,this.ypoint,1,l):6<=f.cmode?c.cvmag2(w,this.ypoint,l):4<=f.cmode&&c.vmov(w.subarray(1),t,this.ypoint,1,l);else if(5===f.cmode)c.vfill(this.ypoint,0,l);else if(1===f.cmode||6<=f.cmode)for(A=0;l>A;A++)this.ypoint[A]=Math.abs(w[A]);else for(A=0;l>A;A++)this.ypoint[A]=w[A];return 6<=f.cmode&&(c.vlog10(this.ypoint,f.dbmin,this.ypoint),z=10,7===f.cmode&&(z=20),0<f.lyr.length&&f.lyr[0].cx&&(z/=2),c.vsmul(this.ypoint,z,this.ypoint)),E=c.vmxmn(this.ypoint,l),y=E.smax,z=E.smin,t=y-z,0>t&&(y=z,z=y+t,t=-t),1e-20>=t?(z-=1,y+=1):(z-=.02*t,y+=.02*t),0===n.level&&(f.panymin>f.panymax?(f.panymin=z,f.panymax=y):(f.panymin=Math.min(f.panymin,z),f.panymax=Math.max(f.panymax,y)),1<f.autol&&(z=1/Math.max(f.autol,1),f.panymin=f.panymin*z+n.stk[0].ymin*(1-z),f.panymax=f.panymax*z+n.stk[0].ymax*(1-z))),l}c.log.debug("Nothing to plot")}},draw:function(){var c=this.plot._Mx,k=this.plot._Gx,f=this.color,n=this.symbol,l=this.radius,t=0,w={};w.fillStyle=k.fillStyle,this.options&&(w.highlight=this.options.highlight,w.noclip=this.options.noclip),0===this.line?t=0:(t=1,0<this.thick?t=this.thick:0>this.thick&&(t=Math.abs(this.thick),w.dashed=!0),1===this.line&&(w.vertsym=!0),2===this.line&&(w.horzsym=!0));var A,E,z=k.segment&&5!==k.cmode&&0<this.xsub&&!0,y=this.xdelta;if(this.xdata?(A=this.xmin,E=this.xmax):(A=Math.max(this.xmin,c.stk[c.level].xmin),E=Math.min(this.xmax,c.stk[c.level].xmax),A>=E&&(k.panxmin=Math.min(k.panxmin,this.xmin),k.panxmax=Math.max(k.panxmax,this.xmax))),!k.all){var J=(k.bufmax-1)*y;J>=-0?E=Math.min(E,A+J):A=Math.max(A,E+J)}if(0!==t||0!==n){for(;E>A;)this.hcb.pipe||this.get_data(A,E),J=this.prep(A,E),J>0&&!z&&a.trace(c,f,new d.PointArray(this.xptr),new d.PointArray(this.yptr),J,1,t,n,l,w),k.all?0===this.size?A=E:k.index?A+=J:y>=0?A+=this.size*y:E+=this.size*y:A=E;this.position&&"scrolling"===this.drawmode&&(k=a.real_to_pixel(c,this.position*this.xdelta,0),k.x>c.l&&k.x<c.r&&a.draw_line(c,"white",k.x,c.t,k.x,c.b))}},add_highlight:function(a){this.options.highlight||(this.options.highlight=[]),a instanceof Array?this.options.highlight.push.apply(this.options.highlight,a):this.options.highlight.push(a),this.plot.refresh()},remove_highlight:function(a){if(this.options.highlight){for(var c=this.options.highlight.length;c--;)a!==this.options.highlight[c]&&a!==this.options.highlight[c].id||this.options.highlight.splice(c,1);this.plot.refresh()}},get_highlights:function(){return this.options.highlight?this.options.highlight.slice(0):[]},clear_highlights:function(){this.options.highlight&&(this.options.highlight=y,this.plot.refresh())}};var t=[0,53,27,80,13,40,67,93,7,60,33,87,20,47,73,100];d.Layer1D.overlay=function(g,k,f){var n=g._Gx,l=g._Mx;2===k["class"]&&c.force1000(k),k.buf_type="D";var F=1;2===k["class"]&&0<k.size&&(F=Math.min(k.size/k.subsize,16-n.lyr.length));var w=f.name;delete f.name;for(var z=0;F>z;z++){var D=new d.Layer1D(g);D.init(k,f),D.color=a.getcolor(l,c.Mc.colormap[3].colors,t[n.lyr.length%t.length]),2===k["class"]?(w!==y&&(Array.isArray(w)?D.name=w[z]:(D.name=w,D.name=D.name+"."+a.pad((z+1).toString(),3,"0"))),D.name||(D.name=k.file_name?c.trim_name(k.file_name):"layer_"+n.lyr.length,D.name=D.name+"."+a.pad((z+1).toString(),3,"0")),D.offset=z*k.subsize):(D.name=w!==y?w:k.file_name?c.trim_name(k.file_name):"layer_"+n.lyr.length,D.offset=0);for(var A in f)D[A]!==y&&(D[A]=f[A]);g.add_layer(D)}}}(window.sigplot=window.sigplot||{},mx,m),function(d,a,c,y){d.Layer2D=function(a){this.plot=a,this.xmax=this.xmin=this.imin=this.ydelta=this.ystart=this.xdelta=this.xstart=this.offset=0,this.name="",this.cx=!1,this.hcb=y,this.display=!0,this.color=0,this.line=3,this.thick=1,this.symbol=0,this.radius=3,this.ysub=this.xsub=this.skip=0,this.modified=this.xdata=!1,this.preferred_origin=4,this.opacity=1,this.lpb=y,this.yc=1,this.options={}},d.Layer2D.prototype={init:function(a){var g=this.plot._Gx,k=this.plot._Mx;if(this.hcb=a,this.hcb.buf_type="D",this.hcb.pipe){var f=this;this.frame=this.position=0,this.lps=this.hcb.lps||Math.ceil(Math.max(1,k.b-k.t)),c.addPipeWriteListener(this.hcb,function(){f._onpipewrite()}),this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new d.PointArray(this.lps*this.hcb.subsize)}else this.lps=this.hcb.lps||Math.ceil(a.size);this.ybufn=this.xbufn=this.offset=0,this.drawmode="scrolling",2>=a["class"]&&(this.xsub=-1,this.ysub=1,this.cx="C"===a.format[0]),this.skip=1,this.cx&&(this.skip=2),g.index?(this.xmin=this.xdelta=this.xstart=1,this.xmax=a.subsize,this.ymin=this.ydelta=this.ystart=1,this.ymax=this.size):(this.xstart=a.xstart,this.xdelta=a.xdelta,g=a.xstart+a.xdelta*(a.subsize-1),this.xmin=Math.min(a.xstart,g),this.xmax=Math.max(a.xstart,g),this.ystart=a.ystart,this.ydelta=a.ydelta,g=a.ystart+a.ydelta*(this.lps-1),this.ymin=Math.min(a.ystart,g),this.ymax=Math.max(a.ystart,g)),this.xframe=this.hcb.subsize,this.yframe=this.lps*this.hcb.subsize/this.xframe,0===this.lpb&&(this.lpb=this.yframe),(!this.lpb||0>=this.lpb)&&(this.lpb=16),this.lpb=Math.max(1,this.lpb/this.yc)*this.yc,this.xlab=a.xunits,this.ylab=a.yunits},_onpipewrite:function(){var t=this.plot._Gx,g=this.plot._Mx;if(!(c.pavail(this.hcb)<this.hcb.subsize*this.hcb.spa)){if("scrolling"!==this.drawmode&&(this.hcb.ystart+=this.hcb.ydelta,this.ystart=this.hcb.ystart,this.ymin=this.hcb.ystart-this.hcb.ydelta*this.lps,this.ymax=this.hcb.ystart),"falling"===this.drawmode)this.position=0,this.buf.set(this.buf.subarray(0,(this.lps-1)*this.hcb.subsize*this.hcb.spa),this.hcb.subsize*this.hcb.spa),this.img&&a.shift_image_rows(g,this.img,1);else if("rising"===this.drawmode)this.position=this.lps-1,this.buf.set(this.buf.subarray(this.hcb.subsize*this.hcb.spa),0),this.img&&a.shift_image_rows(g,this.img,-1);else{if("scrolling"!==this.drawmode)throw"Invalid draw mode";this.position>=this.lps&&(this.position=0)}if(0===c.grabx(this.hcb,this.buf,this.hcb.subsize*this.hcb.spa,this.position*this.hcb.subsize*this.hcb.spa))c.log.error("Internal error");else{var k=this.buf.subarray(this.position*this.hcb.subsize*this.hcb.spa,(this.position+1)*this.hcb.subsize*this.hcb.spa),f=new d.PointArray(this.hcb.subsize);this.cx?1===t.cmode?c.cvmag(k,f,f.length):2===t.cmode?25===t.plab?(c.cvpha(k,f,f.length),c.vsmul(f,1/(2*Math.PI),f,f.length)):24!==t.plab?c.cvpha(k,f,f.length):c.cvphad(k,f,f.length):3===t.cmode?c.vmov(k,this.skip,f,1,f.length):4===t.cmode?c.vmov(k.subarray(1),this.skip,f,1,f.length):5===t.cmode?c.vfill(f,0,f.length):6===t.cmode?c.cvmag2logscale(k,t.dbmin,10,f):7===t.cmode&&c.cvmag2logscale(k,t.dbmin,20,f):1===t.cmode?c.vabs(k,f):2===t.cmode?c.vfill(f,0,f.length):3===t.cmode?c.vmov(k,this.skip,f,1,f.length):4===t.cmode?c.vfill(f,0,f.length):5===t.cmode?c.vfill(f,0,f.length):6===t.cmode?c.vlogscale(k,t.dbmin,10,f):7===t.cmode&&c.vlogscale(k,t.dbmin,20,f);for(var k=f[0],n=f[0],l=0;l<f.length;l++)f[l]<k&&(k=f[l]),f[l]>n&&(n=f[l]);var y,w;1===t.autol?(y=k,w=n):1<t.autol&&(w=1/Math.max(t.autol,1),y=t.zmin*w+k*(1-w),w=t.zmax*w+n*(1-w)),0!==(1&t.autoz)&&(t.zmin=y),0!==(2&t.autoz)&&(t.zmax=w),this.img&&a.update_image_row(g,this.img,f,this.position,t.zmin,t.zmax),this.frame+=1,"scrolling"===this.drawmode&&(this.position=(this.position+1)%this.lps),0===g.level&&(t.panymin=this.ymin,t.panymax=this.ymax,g.stk[0].ymin=this.ymin,g.stk[0].ymax=this.ymax)}}},get_data:function(){var a=this.hcb;this.buf||(this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new d.PointArray(this.lps*this.hcb.subsize)),this.hcb.pipe||c.grab(a,this.buf,0,a.subsize)},get_z:function(a,c){return this.zbuf[Math.floor(c/this.hcb.ydelta)*this.hcb.subsize+Math.floor(a/this.hcb.xdelta)]},change_settings:function(a){var c=this.plot._Gx;a.cmode!==y&&(this.img=y,0!==(1&c.autoz)&&(c.zmin=y),0!==(2&c.autoz)&&(c.zmax=y)),(a.zmin!==y||a.zmax!==y||a.autoz!==y)&&(this.img=y),a.cmap!==y&&(this.img=y),a.drawmode!==y&&(this.drawmode=a.drawmode,this.frame=this.position=0,this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new d.PointArray(this.lps*this.hcb.subsize),this.img=y,this.preferred_origin=this.plot._Mx.origin="falling"===this.drawmode?1:4)},push:function(a,g,k){var f=!1,n=null;if(g){g.timestamp&&(n=g.timestamp,delete g.timestamp),g.subsize&&g.subsize!==this.hcb.subsize&&(this.hcb.subsize=g.subsize,this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new d.PointArray(this.lps*this.hcb.subsize),f=!0);for(var l in g)this.hcb[l]!==g[l]&&(this.hcb[l]=g[l],"type"===l&&(this.hcb["class"]=g[l]/1e3),f=!0);l=this.hcb.xstart+this.hcb.xdelta*(this.hcb.subsize-1),this.xmin=Math.min(this.hcb.xstart,l),this.xmax=Math.max(this.hcb.xstart,l),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart,this.ystart=this.hcb.ystart,this.ydelta=this.hcb.ydelta,l=this.hcb.ystart+this.hcb.ydelta*(this.lps-1),this.ymin=Math.min(this.hcb.ystart,l),this.ymax=Math.max(this.hcb.ystart,l),g.lps&&(this.hcb.lps=g.lps)}return 1!==this.hcb.yunits&&4!==this.hcb.yunits||this.hcb.timecode||!n||(this.hcb.timecode=c.j1970toj1950(n),this.hcb.ystart=0,f=!0),c.filad(this.hcb,a,k),f},prep:function(d,g){var w,k=this.plot._Gx,f=this.plot._Mx,n=this.lps,l=this.xmin,F=this.xmax;if(this.get_data(d,g),!(5===k.cmode||0<this.xsub)&&n>0){var z=this.xstart,D=this.xdelta,A=n;k.index?(w=0,n-=1):D>=0?(w=Math.max(1,Math.min(A,Math.round((d-z)/D)))-1,n=Math.max(1,Math.min(A,Math.round((g-z)/D)+2))-1):(w=Math.max(1,Math.min(A,Math.round((g-z)/D)-1))-1,n=Math.max(1,Math.min(A,Math.round((d-z)/D)+2))-1),n=n-w+1,0>n&&(c.log.debug("Nothing to plot"),n=0)}if(k.panxmin>k.panxmax?(k.panxmin=l,k.panxmax=F):(k.panxmin=Math.min(k.panxmin,l),k.panxmax=Math.max(k.panxmax,F)),!(0>=n)){if(!(5===k.cmode||0<this.ysub)&&n>0&&(l=this.ystart,F=this.ydelta,A=n,k.index?(w=0,n-=1):F>=0?(w=Math.max(1,Math.min(A,Math.round((d-l)/F)))-1,n=Math.max(1,Math.min(A,Math.round((g-l)/F)+2))-1):(w=Math.max(1,Math.min(A,Math.round((g-l)/F)-1))-1,n=Math.max(1,Math.min(A,Math.round((d-l)/F)+2))-1),n=n-w+1,0>n&&(c.log.debug("Nothing to plot"),n=0)),k.panymin>k.panxmax?(k.panymin=this.ymin,k.panymax=this.ymax):(k.panymin=Math.min(k.panymin,this.ymin),k.panymax=Math.max(k.panymax,this.ymax)),this.cx?1===k.cmode?c.cvmag(this.buf,this.zbuf,this.zbuf.length):2===k.cmode?25===k.plab?(c.cvpha(this.buf,this.zbuf,this.zbuf.length),c.vsmul(this.zbuf,1/(2*Math.PI),this.zbuf,this.zbuf.length)):24!==k.plab?c.cvpha(this.buf,this.zbuf,this.zbuf.length):c.cvphad(this.buf,this.zbuf,this.zbuf.length):3===k.cmode?c.vmov(this.buf,this.skip,this.zbuf,1,this.zbuf.length):4===k.cmode?c.vmov(this.buf.subarray(1),this.skip,this.zbuf,1,this.zbuf.length):5===k.cmode?c.vfill(this.zbuf,0,this.zbuf.length):6===k.cmode?c.cvmag2logscale(this.buf,k.dbmin,10,this.zbuf):7===k.cmode&&c.cvmag2logscale(this.buf,k.dbmin,20,this.zbuf):1===k.cmode?c.vabs(this.buf,this.zbuf):2===k.cmode?c.vfill(this.zbuf,0,this.zbuf.length):3===k.cmode?c.vmov(this.buf,this.skip,this.zbuf,1,this.zbuf.length):4===k.cmode?c.vfill(this.zbuf,0,this.zbuf.length):5===k.cmode?c.vfill(this.zbuf,0,this.zbuf.length):6===k.cmode?c.vlogscale(this.buf,k.dbmin,10,this.zbuf):7===k.cmode&&c.vlogscale(this.buf,k.dbmin,20,this.zbuf),A=this.zbuf,this.hcb.pipe&&this.frame<this.lps&&(A="rising"===this.drawmode?this.zbuf.subarray(this.zbuf.length-this.frame*this.hcb.subsize):this.zbuf.subarray(0,this.frame*this.hcb.subsize)),F=l=0,0<A.length)for(l=A[0],F=A[0],w=0;w<A.length&&!(w/this.xframe>=this.lpb);w++)A[w]<l&&(l=A[w]),A[w]>F&&(F=A[w]);if(0!==(1&k.autoz)&&(k.zmin=k.zmin!==y?Math.min(k.zmin,l):l),0!==(2&k.autoz)&&(k.zmax=k.zmax!==y?Math.min(k.zmax,F):F),this.img=a.create_image(f,this.zbuf,this.hcb.subsize,this.lps,k.zmin,k.zmax),this.img.cmode=k.cmode,this.img.cmap=k.cmap,this.img.origin=f.origin,this.hcb.pipe&&this.frame<this.lps)if(k=new Uint32Array(this.img),"rising"===this.drawmode)for(w=0;w<k.length-this.frame*this.hcb.subsize;w++)k[w]=0;else for(w=this.frame*this.hcb.subsize;w<k.length;w++)k[w]=0;return n}c.log.debug("Nothing to plot")},draw:function(){var c=this.plot._Mx,g=this.plot._Gx,k=this.hcb;if(this.hcb.pipe){var f=this.hcb.lps||Math.ceil(Math.max(1,c.b-c.t));if(f!==this.lps&&this.buf){var n=this.hcb.createArray(null,0,f*this.hcb.subsize*this.hcb.spa),l=new d.PointArray(f*this.hcb.subsize);n.set(this.buf.subarray(0,n.length)),l.set(this.zbuf.subarray(0,l.length)),this.buf=n,this.zbuf=l,this.lps=f,this.position>=this.lps&&(this.position=0),f=k.ystart+k.ydelta*(this.lps-1),this.ymin=Math.min(k.ystart,f),this.ymax=Math.max(k.ystart,f),this.plot.rescale()}}if(f=Math.max(this.xmin,c.stk[c.level].xmin),n=Math.min(this.xmax,c.stk[c.level].xmax),f>=n)g.panxmin=Math.min(g.panxmin,this.xmin),g.panxmax=Math.max(g.panxmax,this.xmax);else{var y=Math.max(this.ymin,c.stk[c.level].ymin),w=Math.min(this.ymax,c.stk[c.level].ymax),l=Math.abs(n-f)+1,z=Math.abs(w-y)+1,l=Math.floor(l/k.xdelta),z=Math.floor(z/k.ydelta),l=Math.min(l,k.subsize),z=Math.min(z,k.size),k=a.real_to_pixel(c,f,y),w=a.real_to_pixel(c,n,w),z=(w.y-k.y)/z;g.xe=Math.max(1,Math.round((w.x-k.x)/l)),g.ye=Math.max(1,Math.round(z)),this.img?g.cmode===this.img.cmode&&g.cmap===this.img.cmap&&c.origin===this.img.origin||this.prep(f,n):this.prep(f,n),this.img&&a.draw_image(c,this.img,this.xmin,this.ymin,this.xmax,this.ymax,this.opacity,g.rasterSmoothing),null!==this.position&&"scrolling"===this.drawmode&&(g=a.real_to_pixel(c,0,this.position*this.ydelta),g.y>c.t&&g.y<c.b&&a.draw_line(c,"white",c.l,g.y,c.r,g.y))}}},d.Layer2D.overlay=function(a,g,k){var f=a._Gx;g.buf_type="D";var n=new d.Layer2D(a);n.init(g),n.name=g.file_name?c.trim_name(g.file_name):"layer_"+f.lyr.length,n.change_settings(k),a.add_layer(n)}}(window.sigplot=window.sigplot||{},mx,m),window.sigplot=window.sigplot||{},function(d,a,c){function y(){this.yptr=this.xptr=void 0,this.xmax=this.xmin=this.panymax=this.panymin=this.panxmax=this.panxmin=this.xdelta=this.xstart=this.arety=this.aretx=this.ymrk=this.xmrk=this.rety=this.retx=0,this.xmult=void 0,this.ymax=this.ymin=0,this.zmax=this.zmin=this.ymult=void 0,this.pmt=this.pyscl=this.pxscl=this.dbmin=0,this.format=this.note="",this.modsource=this.modlayer=this.pthk=this.pyl=this.py2=this.py1=this.px2=this.px1=this.pb=this.pt=this.pr=this.pl=0,this.modified=!1,this.ydiv=this.xdiv=this.modmode=0,this.cross=this.expand=this.all=!1,this.grid=!0,this.gridBackground=void 0,this.index=!1,this.legend=this.specs=this.pan=!0,this.xdata=!1,this.show_readout=this.show_y_axis=this.show_x_axis=!0,this.autohide_panbars=this.autohide_readout=this.hide_note=!1,this.panning=void 0,this.panmode=0,this.hold=!1,this.isec=this.nsec=this.iysec=this.sections=0,this.ylab=this.xlab=void 0,this.default_rubberbox_action="zoom",this.default_rubberbox_mode="box",this.wheelscroll_mode_natural=!0,this.scroll_time_interval=10,this.stillPanning=this.repeatPanning=void 0,this.autol=-1,this.wheelZoom=this.rasterSmoothing=this.lineSmoothing=!1,this.wheelZoomPercent=.2,this.inContinuousZoom=!1,this.lyr=[],this.HCB=[],this.plugins=[],this.plotData=document.createElement("canvas"),this.plotData.valid=!1}function t(e,d){var f=e._Gx,p=e._Mx;if(Array.isArray(d)){var g={name:"Custom",colors:d};"Custom"===c.Mc.colormap[c.Mc.colormap.length-1].name?c.Mc.colormap[c.Mc.colormap.length-1].colors=d:c.Mc.colormap.push(g),f.cmap=c.Mc.colormap.length-1}else if("string"==typeof d){for(f.cmap=-1,g=0;g<c.Mc.colormap.length;g++)if(c.Mc.colormap[g].name===d){f.cmap=g;break}}else f.cmap=d;0>f.ncolors&&(f.ncolors*=-1,f.cmap=Math.max(1,f.cmap)),(0>f.cmap||f.cmap>c.Mc.colormap.length)&&(f.cmap=2===f.cmode?2:1),a.colormap(p,c.Mc.colormap[f.cmap].colors,f.ncolors)}function g(c,e){var d=c._Mx;a.removeEventListener(d,"mousedown",c.onmousedown,!1),a.menu(d,{title:"SCROLLBAR",refresh:function(){c.refresh()},finalize:function(){a.addEventListener(d,"mousedown",c.onmousedown,!1),c.refresh()},items:[{text:"Expand Range",handler:function(){C(c,a.SB_EXPAND,e)}},{text:"Shrink Range",handler:function(){C(c,a.SB_SHRINK,e)}},{text:"Expand Full",handler:function(){C(c,a.SB_FULL,e)}}]})}function k(e){var d=e._Gx,f=e._Mx;a.removeEventListener(f,"mousedown",e.onmousedown,!1);for(var p={text:"Cntrls...",menu:{title:"CONTROLS OPTIONS",items:[{text:"Continuous (Disabled)",checked:-2===d.cntrls,handler:function(){e.change_settings({xcnt:-2})}},{text:"LM Click (Disabled)",checked:-1===d.cntrls,handler:function(){e.change_settings({xcnt:-1})}},{text:"Off",checked:0===d.cntrls,handler:function(){e.change_settings({xcnt:0})}},{text:"LM Click",checked:1===d.cntrls,handler:function(){e.change_settings({xcnt:1})}},{text:"Continuous",checked:2===d.cntrls,handler:function(){e.change_settings({xcnt:2})}}]}},g={text:"CX Mode...",menu:{title:"COMPLEX MODE",items:[{text:"Magnitude",checked:1===d.cmode,handler:function(){e.change_settings({cmode:1})}},{text:"Phase",checked:2===d.cmode,handler:function(){e.change_settings({cmode:2})}},{text:"Real",checked:3===d.cmode,handler:function(){e.change_settings({cmode:3})}},{text:"Imaginary",checked:4===d.cmode,handler:function(){e.change_settings({cmode:4})}},{text:"IR: Imag/Real",checked:5===d.cmode,handler:function(){e.change_settings({cmode:5})}},{text:"10*Log10",checked:6===d.cmode,handler:function(){e.change_settings({cmode:6})}},{text:"20*Log10",checked:7===d.cmode,handler:function(){e.change_settings({cmode:7})}}]}},k={text:"Scaling...",menu:{title:"SCALING",items:[{text:"Y Axis",style:"separator"},{text:"Parameters...",checked:0===d.autoy,handler:function(){d.autoy=0,M(e,"Y Axis Min:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].ymin?(""===a&&(a=0),q(e,parseFloat(a),f.stk[f.level].ymax,"Y")):e.refresh()},f.stk[f.level].ymin,void 0,void 0,function(){M(e,"Y Axis Max:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].ymax?(""===a&&(a=0),q(e,f.stk[f.level].ymin,parseFloat(a),"Y")):e.refresh()},f.stk[f.level].ymax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===d.autoy,handler:function(){d.autoy=1}},{text:"Max Auto",checked:2===d.autoy,handler:function(){d.autoy=2}},{text:"Full Auto",checked:3===d.autoy,handler:function(){d.autoy=3}},{text:"X Axis",style:"separator"},{text:"Parameters...",checked:0===d.autox,handler:function(){d.autox=0,M(e,"X Axis Min:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].xmin?(""===a&&(a=0),q(e,parseFloat(a),f.stk[f.level].xmax,"X")):e.refresh()},f.stk[f.level].xmin,void 0,void 0,function(){M(e,"X Axis Max:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].xmax?(""===a&&(a=0),q(e,f.stk[f.level].xmin,parseFloat(a),"X")):e.refresh()},f.stk[f.level].xmax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===d.autox,handler:function(){d.autox=1}},{text:"Max Auto",checked:2===d.autox,handler:function(){d.autox=2}},{text:"Full Auto",checked:3===d.autox,handler:function(){d.autox=3}},{text:"Z Axis",style:"separator"},{text:"Parameters...",checked:0===d.autoz,handler:function(){d.autoz=0,M(e,"Z Axis Min:",a.floatValidator,function(a){parseFloat(a)!==d.zmin&&(""===a&&(a=0),e.change_settings({zmin:a}))},d.zmin,void 0,void 0,function(){M(e,"Z Axis Max:",a.floatValidator,function(a){parseFloat(a)!==d.zmax&&(""===a&&(a=0),e.change_settings({zmax:a}))},d.zmax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===d.autoz,handler:function(){e.change_settings({autoz:1})}},{text:"Max Auto",checked:2===d.autoz,handler:function(){e.change_settings({autoz:2})}},{text:"Full Auto",checked:3===d.autoz,handler:function(){e.change_settings({autoz:3})}}]}},l={text:"Settings...",menu:{title:"SETTINGS",items:[{text:"ALL Mode",checked:d.all,style:"checkbox",handler:function(){e.change_settings({all:!d.all})}},{text:"Controls...",menu:{title:"CONTROLS OPTIONS",items:[{text:"Continuous (Disabled)",checked:-2===d.cntrls,handler:function(){e.change_settings({xcnt:-2})}},{text:"LM Click (Disabled)",checked:-1===d.cntrls,handler:function(){e.change_settings({xcnt:-1})}},{text:"Off",checked:0===d.cntrls,handler:function(){e.change_settings({xcnt:0})}},{text:"LM Click",checked:1===d.cntrls,handler:function(){e.change_settings({xcnt:1})}},{text:"Continuous",checked:2===d.cntrls,handler:function(){e.change_settings({xcnt:2})}}]}},{text:"Mouse...",menu:{title:"MOUSE OPTIONS",items:[{text:"LM Drag (Zoom)",checked:"zoom"===d.default_rubberbox_action,handler:function(){d.default_rubberbox_action="zoom"}},{text:"LM Drag (Select)",checked:"select"===d.default_rubberbox_action,handler:function(){d.default_rubberbox_action="select"}},{text:"LM Drag (Disabled)",checked:void 0===d.default_rubberbox_action,handler:function(){d.default_rubberbox_action=void 0}},{text:"Mode...",menu:{title:"MOUSE Mode",items:[{text:"Box",checked:"box"===d.default_rubberbox_mode,handler:function(){d.default_rubberbox_mode="box"}},{text:"Horizontal",checked:"horizontal"===d.default_rubberbox_mode,handler:function(){d.default_rubberbox_mode="horizontal"}},{text:"Vertical",checked:"vertical"===d.default_rubberbox_mode,handler:function(){d.default_rubberbox_mode="vertical"}}]}},{text:"CROSShairs...",menu:{title:"Crosshairs Mode",items:[{text:"Off",checked:!d.cross,handler:function(){d.cross=!1}},{text:"On",checked:!0===d.cross,handler:function(){d.cross=!0}},{text:"Horizontal",checked:"horizontal"===d.cross,handler:function(){d.cross="horizontal"}},{text:"Vertical",checked:"vertical"===d.cross,handler:function(){d.cross="vertical"}}]}},{text:"Mousewheel Natural Mode",checked:d.wheelscroll_mode_natural,style:"checkbox",handler:function(){e.change_settings({wheelscroll_mode_natural:!d.wheelscroll_mode_natural})}}]}},{text:"CROSShairs",checked:d.cross,style:"checkbox",handler:function(){e.change_settings({cross:!d.cross})}},{text:"GRID",checked:d.grid,style:"checkbox",handler:function(){e.change_settings({grid:!d.grid})}},{text:"INDEX Mode",checked:d.index,style:"checkbox",handler:function(){e.change_settings({index:!d.index})}},{text:"LEGEND",checked:d.legend,style:"checkbox",handler:function(){e.change_settings({legend:!d.legend})}},{text:"PAN Scrollbars",checked:d.pan,style:"checkbox",handler:function(){e.change_settings({pan:!d.pan})}},{text:"PHase UNITS...",menu:{title:"PHASE UNITS",items:[{text:"Radians",checked:23===d.plab,handler:function(){e.change_settings({phunits:"R"})}},{text:"Degrees",checked:24===d.plab,handler:function(){e.change_settings({phunits:"D"})}},{text:"Cycles",checked:25===d.plab,handler:function(){e.change_settings({phunits:"C"})}}]}},{text:"SPECS",checked:d.specs,style:"checkbox",handler:function(){e.change_settings({specs:!d.specs})}},{text:"XDIVisions...",handler:function(){M(e,"X Divisions:",function(e){var d=a.intValidator(e),r=c.trunc(f.width/2);return d.valid&&e>r?{valid:!1,reason:"Exceeds maximum number of divisions ("+r+")."}:d},function(a){parseFloat(a)!==d.xdiv&&(""===a&&(a=1),d.xdiv=parseFloat(a)),e.refresh()},d.xdiv,void 0,void 0,void 0)}},{text:"XLABel...",handler:function(){M(e,"X Units:",function(c){return console.log("The value is "+c),a.intValidator(c)},function(a){parseFloat(a)!==d.xlab&&(0>a&&(a=0),d.xlab=parseFloat(a)),e.refresh()},d.xlab,void 0,void 0,void 0)}},{text:"YDIVisions...",handler:function(){M(e,"Y Divisions:",function(e){var d=a.intValidator(e),r=c.trunc(f.height/2);return d.valid&&e>r?{valid:!1,reason:"Exceeds maximum number of divisions ("+r+")."}:d},function(a){parseFloat(a)!==d.ydiv&&(""===a&&(a=1),d.ydiv=parseFloat(a)),e.refresh()},d.ydiv,void 0,void 0,void 0)}},{text:"YINVersion",checked:4===f.origin,style:"checkbox",handler:function(){e.change_settings({yinv:4!==f.origin})}},{text:"YLABel...",handler:function(){M(e,"Y Units:",function(c){return a.intValidator(c)},function(a){parseFloat(a)!==d.ylab&&(0>a&&(a=0),d.ylab=parseFloat(a)),e.refresh()},d.ylab,void 0,void 0,void 0)}},{text:"X-axis",checked:d.show_x_axis,style:"checkbox",handler:function(){e.change_settings({show_x_axis:!d.show_x_axis})}},{text:"Y-axis",checked:d.show_y_axis,style:"checkbox",handler:function(){e.change_settings({show_y_axis:!d.show_y_axis})}},{text:"Readout",checked:d.show_readout,style:"checkbox",handler:function(){e.change_settings({show_readout:!d.show_readout})}},{text:"Invert Colors",checked:f.xi,style:"checkbox",handler:function(){a.invertbgfg(f)}}]}},n={text:"Colormap...",menu:{title:"COLORMAP",items:[]}},t=function(){e.change_settings({cmap:this.cmap})},v=0;v<c.Mc.colormap.length;v++)n.menu.items.push({text:c.Mc.colormap[v].name,cmap:v,checked:d.cmap===v,handler:t});var w=function(c){return{title:"TRACE OPTIONS",items:[{text:"Dashed...",handler:function(){var p=1;if(void 0!==c)p=Math.abs(e._Gx.lyr[c].thick);else{if(0===d.lyr.length)return;for(var p=Math.abs(e._Gx.lyr[0].thick),f=0;f<d.lyr.length;f++)if(p!==Math.abs(e._Gx.lyr[f].thick)){p=1;break}}M(e,"Line thickness:",a.intValidator,function(a){if(void 0!==c)e._Gx.lyr[c].line=3,e._Gx.lyr[c].thick=-1*a,e._Gx.lyr[c].symbol=0;else for(var c=0;c<d.lyr.length;c++)e._Gx.lyr[c].line=3,e._Gx.lyr[c].thick=-1*a,e._Gx.lyr[c].symbol=0},p)}},{text:"Dots...",handler:function(){var p=3;if(void 0!==c)p=Math.abs(e._Gx.lyr[c].radius);else{if(0===d.lyr.length)return;for(var f=0;f<d.lyr.length;f++)if(p!==Math.abs(e._Gx.lyr[f].radius)){p=3;break}}M(e,"Radius/Shape:",a.intValidator,function(a){var p;if(0>a?(p=3,a=Math.abs(a)):a>0?p=2:(p=1,a=0),void 0!==c)e._Gx.lyr[c].line=0,e._Gx.lyr[c].radius=a,e._Gx.lyr[c].symbol=p;else for(var f=0;f<d.lyr.length;f++)e._Gx.lyr[f].line=0,e._Gx.lyr[f].radius=a,e._Gx.lyr[f].symbol=p},p)}},{text:"Solid...",handler:function(){var p=1;if(void 0!==c)p=Math.abs(e._Gx.lyr[c].thick);else{if(0===d.lyr.length)return;for(var p=Math.abs(e._Gx.lyr[0].thick),f=0;f<d.lyr.length;f++)if(p!==Math.abs(e._Gx.lyr[f].thick)){p=1;break}}M(e,"Line thickness:",a.intValidator,function(a){if(void 0!==c)e._Gx.lyr[c].line=3,e._Gx.lyr[c].thick=a,e._Gx.lyr[c].symbol=0;else for(var p=0;p<d.lyr.length;p++)e._Gx.lyr[p].line=3,e._Gx.lyr[p].thick=a,e._Gx.lyr[p].symbol=0},p)}},{text:"Toggle",style:void 0!==c?"checkbox":void 0,checked:void 0!==c?e._Gx.lyr[c].display:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].display=!e._Gx.lyr[c].display;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].display=!e._Gx.lyr[a].display}},{text:"Symbols...",menu:{title:"SYMBOLS",items:[{text:"Retain Current"},{text:"None",checked:void 0!==c?0===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=0,e._Gx.lyr[c].symbol=0;
else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=0,e._Gx.lyr[a].symbol=0}},{text:"Pixels",checked:void 0!==c?1===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=1,e._Gx.lyr[c].symbol=1;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=1,e._Gx.lyr[a].symbol=1}},{text:"Circles",checked:void 0!==c?2===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=4,e._Gx.lyr[c].symbol=2;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=4,e._Gx.lyr[a].symbol=2}},{text:"Squares",checked:void 0!==c?3===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=4,e._Gx.lyr[c].symbol=3;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=4,e._Gx.lyr[a].symbol=3}},{text:"Plusses",checked:void 0!==c?4===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=4,e._Gx.lyr[c].symbol=4;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=4,e._Gx.lyr[a].symbol=4}},{text:"X's",checked:void 0!==c?5===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=4,e._Gx.lyr[c].symbol=5;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=4,e._Gx.lyr[a].symbol=5}},{text:"Triangles",checked:void 0!==c?6===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=6,e._Gx.lyr[c].symbol=6;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=6,e._Gx.lyr[a].symbol=6}},{text:"Downward Triangles",checked:void 0!==c?7===e._Gx.lyr[c].symbol:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].radius=6,e._Gx.lyr[c].symbol=7;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].radius=6,e._Gx.lyr[a].symbol=7}}]}},{text:"Line Type...",menu:{title:"LINE TYPE",items:[{text:"Retain Current"},{text:"None",checked:void 0!==c?0===e._Gx.lyr[c].line:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].line=0;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].line=0}},{text:"Verticals",checked:void 0!==c?1===e._Gx.lyr[c].line:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].line=1;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].line=1}},{text:"Horizontals",checked:void 0!==c?2===e._Gx.lyr[c].line:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].line=2;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].line=2}},{text:"Connecting",checked:void 0!==c?3===e._Gx.lyr[c].line:void 0,handler:function(){if(void 0!==c)e._Gx.lyr[c].line=3;else for(var a=0;a<d.lyr.length;a++)e._Gx.lyr[a].line=3}}]}},{text:"Thickness...",handler:function(){var p=1;void 0!==c&&(p=e._Gx.lyr[c].thick),M(e,"Thickness",a.intValidator,function(a){if(""===a&&(a=1),a=Math.max(0,a),void 0!==c)e._Gx.lyr[c].thick=a;else for(var p=0;p<d.lyr.length;p++)e._Gx.lyr[p].thick=a},p,void 0,void 0,void 0)}},{text:"Opacity...",handler:function(){var p=1;void 0!==c&&(p=e._Gx.lyr[c].opacity),M(e,"Opacity:",a.floatValidator,function(a){if(""===a&&(a=1),a=Math.max(0,a),a=Math.min(1,a),void 0!==c)e._Gx.lyr[c].opacity=a;else for(var p=0;p<d.lyr.length;p++)e._Gx.lyr[p].opacity=a},p,void 0,void 0,void 0)}}]}},t={text:"Plugins...",menu:{title:"PLUGINS",items:function(){for(var a=[],c=0;c<d.plugins.length;c++){var e=d.plugins[c];e.impl.menu&&a.push("function"==typeof e.impl.menu?e.impl.menu():e.impl.menu)}return a}()}};a.menu(f,{title:"SIG-PLOT",finalize:function(){f.prompt||a.addEventListener(f,"mousedown",e.onmousedown,!1),e.refresh()},items:[{text:"Refresh"},p,g,k,{text:"View...",menu:{title:"VIEW",items:[{text:"Reset",handler:function(){e.unzoom()}},{text:"Y Axis",style:"separator"},{text:"Expand Range",handler:function(){C(e,a.SB_EXPAND,"YPAN")}},{text:"Shrink Range",handler:function(){C(e,a.SB_SHRINK,"YPAN")}},{text:"Expand Full",handler:function(){C(e,a.SB_FULL,"YPAN")}},{text:"X Axis",style:"separator"},{text:"Expand Range",handler:function(){C(e,a.SB_EXPAND,"XPAN")}},{text:"Shrink Range",handler:function(){C(e,a.SB_SHRINK,"XPAN")}},{text:"Expand Full",handler:function(){C(e,a.SB_FULL,"XPAN")}}]}},{text:"Grid",handler:function(){e.change_settings({grid:!d.grid})}},l,n,{text:"Traces...",menu:function(){var a=e._Gx,c={title:"TRACE",items:[]};c.items.push({text:"All",menu:w()});for(var d=0;d<a.lyr.length;d++)c.items.push({text:a.lyr[d].name,menu:w(d)});return c}},{text:"Files...",menu:{title:"FILES OPTIONS",items:[{text:"Deoverlay File...",menu:function(){var a=e._Gx,c={title:"DEOVERLAY",items:[]};c.items.push({text:"Deoverlay All",handler:function(){e.deoverlay()}});for(var d=0;d<a.lyr.length;d++){var p=function(a){return function(){e.deoverlay(a)}}(d);c.items.push({text:a.lyr[d].name,handler:p})}return c}}]}},t,{text:"Keypress Info",handler:function(){a.message(f,h)}},{text:"Save as...",menu:{title:"SAVE AS",items:[{text:"PNG",handler:function(){var a=e._Mx.active_canvas.toDataURL("image/png"),c=document.createElement("a");c.href=a,c.download="SigPlot."+(new Date).getTime()+".png",c.click()}},{text:"JPG",handler:function(){var a=e._Mx.active_canvas.toDataURL("image/jpg"),c=document.createElement("a");c.href=a,c.download="SigPlot."+(new Date).getTime()+".jpg",c.click()}},{text:"SVG",handler:function(){var a=e._Mx.active_canvas.toDataURL("image/svg"),c=document.createElement("a");c.href=a,c.download="SigPlot."+(new Date).getTime()+".svg",c.click()}}]}},{text:"Exit",handler:function(){var c=document.createEvent("Event");c.initEvent("sigplotexit",!0,!0),a.dispatchEvent(f,c)}}]})}function f(e){return function(d,f,p,g,k,h,l){var n,q=e._Gx,t=e._Mx,v=Math.min(f,g),w=Math.min(p,k),x=Math.abs(g-f);n=Math.abs(k-p),void 0===h||"zoom"===h?1===d.which&&(("horizontal"===l?x>2:"vertical"===l?n>2:x>2&&n>2)?(e.pixel_zoom(f,p,g,k),e.refresh()):(x=!1,n=e._Mx,f=n.xpos,p=n.ypos,g=n.text_h,k=n.text_w,h=" ",f<n.l-k&&p<=n.b&&p>=n.t?(h="YCENTER",x=!0):p>n.b+c.trunc(.5*k)&&p<=n.b+c.trunc(c.trunc(3*g)/2)&&f>=n.l&&f<=n.r&&(h="XCENTER",x=!0),n=h,x?" "!==n&&Q(e,n,0,d):1===q.cntrls&&(f=document.createEvent("Event"),f.initEvent("mtag",!0,!0),f.x=q.xmrk,f.y=q.ymrk,f.xpos=v,f.ypos=w,f.w=void 0,f.h=void 0,f.shift=d.shiftKey,a.dispatchEvent(t,f)))):"select"===h&&(f=document.createEvent("Event"),f.initEvent("mtag",!0,!0),q=T(e,v,w),p=T(e,v+x,w+n),f.x=q.x,f.y=q.y,f.xpos=v,f.ypos=w,f.w=Math.abs(p.x-q.x),f.h=Math.abs(p.y-q.y),f.wpxl=x,f.hpxl=n,f.shift=d.shiftKey,a.dispatchEvent(t,f))}}function n(e,d){var f=e._Mx,p=e._Gx;p.xmin=void 0===d.xmin?0:d.xmin,p.xmax=void 0===d.xmax?0:d.xmax;var g=void 0!==d.xmin,k=void 0!==d.xmax,h=void 0===d.cmode?"":d.cmode.toUpperCase();p.ylab=d.ylab,p.ymin=void 0===d.ymin?0:d.ymin,p.ymax=void 0===d.ymax?0:d.ymax;var n=void 0!==d.ymin,q=void 0!==d.ymax;p.zmin=d.zmin,p.zmax=d.zmax;var v=void 0!==d.zmin,w=void 0!==d.zmax;void 0!==d.colors&&a.setbgfg(f,d.colors.bg,d.colors.fg,f.xi),void 0!==d.xi&&a.invertbgfg(f),p.forcelab=void 0===d.forcelab?!0:d.forcelab,p.all=void 0===d.all?!1:d.all,p.expand=void 0===d.expand?!1:d.expand,p.xlab=d.xlab,p.segment=void 0===d.segment?!1:d.segment,p.plab=24;var x=void 0===d.phunits?"D":d.phunits;"R"===x[0]?p.plab=23:"C"===x[0]&&(p.plab=25),p.xdiv=void 0===d.xdiv?5:d.xdiv,p.ydiv=void 0===d.ydiv?5:d.ydiv,f.origin=1,d.yinv&&(f.origin=4),p.pmt=void 0===d.pmt?1:d.pmt,p.bufmax=void 0===d.bufmax?32768:d.bufmax,p.sections=void 0===d.nsec?0:d.nsec,p.anno_type=void 0===d.anno_type?0:d.anno_type,p.xfmt=void 0===d.xfmt?"":d.xfmt,p.yfmt=void 0===d.yfmt?"":d.yfmt,p.index=void 0===d.index?!1:d.index,(x=p.index||"IN"===h.slice(0,2))&&(g&&1===p.xmin&&(g=!1),k&&1===p.xmin&&(k=!1)),p.xdata=!1,p.note="",p.hold=0,p.always_show_marker=d.always_show_marker||!1,c.vstype("D"),d.inputs||l(e,!1);var y=h.slice(0,2);("IN"===y||"AB"===y||"__"===y)&&(y=h.slice(2,4)),p.cmode=0<p.lyr.length&&p.lyr[0].cx?1:3,"MA"===y&&(p.cmode=1),"PH"===y&&(p.cmode=2),"RE"===y&&(p.cmode=3),"IM"===y&&(p.cmode=4),("LO"===y||"D1"===y)&&(p.cmode=6),("L2"===y||"D2"===y)&&(p.cmode=7),("RI"===y||"IR"===y)&&(p.index?alert("Imag/Real mode not permitted in INDEX mode"):p.cmode=5),p.basemode=p.cmode,e.change_settings({cmode:p.cmode}),p.dbmin=1e-20,6<=p.cmode&&(h=10,7===p.cmode&&(h=20),"L"===y[0]?0<p.lyr.length&&p.lyr[0].cx?(p.ymin=Math.max(p.ymin,1e-10),p.ymax=Math.max(p.ymax,1e-10)):(p.ymin=Math.max(p.ymin,1e-20),p.ymax=Math.max(p.ymax,1e-20)):0<p.lyr.length&&p.lyr[0].cx?(p.ymin=Math.max(-18*h,p.ymin),p.ymax=Math.max(-18*h,p.ymax),p.dbmin=1e-37):Math.min(p.ymin,p.ymax)<-20*h&&(p.ymin=Math.max(-37*h,p.ymin),p.ymax=Math.max(-37*h,p.ymax),p.dbmin=Math.pow(10,Math.min(p.ymin,p.ymax)/h))),f.level=0,x&&!p.index&&(g&&(p.xmin=p.xstart+p.xdelta*(p.xmin-1)),g&&(p.xmax=p.xstart+p.xdelta*(p.xmax-1))),p.xmult=d.xmult,p.ymult=d.xmult,p.autox=void 0===d.autox?-1:d.autox,0>p.autox&&(p.autox=0,g||(p.autox+=1),k||(p.autox+=2)),p.autoy=void 0===d.autoy?-1:d.autoy,0>p.autoy&&(p.autoy=0,n||(p.autoy+=1),q||(p.autoy+=2)),p.autoz=void 0===d.autoz?-1:d.autoz,0>p.autoz&&(p.autoz=0,v||(p.autoz+=1),w||(p.autoz+=2)),p.autol=void 0===d.autol?-1:d.autol,g||(p.xmin=void 0),k||(p.xmax=void 0),G(e,{get_data:!0},p.xmin,p.xmax,p.xlab,p.ylab),g||(p.xmin=f.stk[0].xmin),k||(p.xmax=f.stk[0].xmax),n||(p.ymin=f.stk[0].ymin),q||(p.ymax=f.stk[0].ymax),p.xmin>p.xmax&&(f.stk[0].xmin=p.xmax,p.xmax=p.xmin,p.xmin=f.stk[0].xmin),p.ymin>p.ymax&&(f.stk[0].ymin=p.ymax,p.ymax=p.ymin,p.ymin=f.stk[0].ymin),f.stk[0].xmin=p.xmin,f.stk[0].xmax=p.xmax,f.stk[0].ymin=p.ymin,f.stk[0].ymax=p.ymax,p.panxmin=Math.min(p.panxmin,p.xmin),p.panxmax=Math.max(p.panxmax,p.xmax),p.panymin=Math.min(p.panymin,p.ymin),p.panymax=Math.max(p.panymax,p.ymax),p.xmin=f.stk[0].xmin,p.ymin=f.stk[0].ymin,a.set_font(f,Math.min(7,f.width/64)),p.ncolors=void 0===d.ncolors?16:d.ncolors,p.cmap=null,p.cmap=d.cmap?d.cmap:void 0===d.xc?-1:d.xc,t(e,p.cmap),p.cntrls="leftmouse"===d.xcnt?1:"continuous"===d.xcnt?2:void 0===d.xcnt?1:d.xcnt,p.default_rubberbox_mode=void 0===d.rubberbox_mode?"box":d.rubberbox_mode,p.default_rubberbox_action=void 0===d.rubberbox_action?"zoom":d.rubberbox_action,p.cross=void 0===d.cross?!1:d.cross,p.grid=void 0===d.nogrid?!0:!d.nogrid,p.fillStyle=d.fillStyle,p.gridBackground=d.gridBackground,p.gridStyle=d.gridStyle,p.wheelZoom=d.wheelZoom,p.wheelZoomPercent=d.wheelZoomPercent,p.legend=void 0===d.legend?!1:d.legend,p.legendBtnLocation=null,p.pan=void 0===d.nopan?!0:!d.nopan,p.nomenu=void 0===d.nomenu?!1:d.nomenu,p.modmode=0,p.modlayer=-1,p.modsource=0,p.modified=d.mod&&0<p.lyr.length,p.nmark=0,p.iabsc=0,p.index&&(p.iabsc=1),p.specs=!d.nospecs,p.scroll_time_interval=void 0===d.scroll_time_interval?p.scroll_time_interval:d.scroll_time_interval,p.autohide_readout=d.autohide_readout,p.autohide_panbars=d.autohide_panbars,p.specs?(p.show_x_axis=!d.noxaxis,p.show_y_axis=!d.noyaxis,p.show_readout=!d.noreadout,p.specs=p.show_x_axis||p.show_y_axis||p.show_readout?!0:!1):(p.show_x_axis=!1,p.show_y_axis=!1,p.show_readout=!1),p.hide_note=d.hide_note||!1,p.xmrk=0,p.ymrk=0,d.nodragdrop||(a.addEventListener(f,"dragover",function(a){a.preventDefault()},!1),a.addEventListener(f,"drop",function(a){return function(c){var e=c.dataTransfer.files;0<e.length&&(c.preventDefault(),a.load_files(e))}}(e),!1))}function l(a,c){var e=a._Gx,d=a._Mx;if(c){var f=e.HCB[0];e.xstart=f.xstart,e.xdelta=f.xdelta}else e.xstart=0,e.xdelta=1,e.autol=-1;d.origin=1}function F(a){for(var d,c=a._Gx,e=a._Mx.canvas.getContext("2d"),f=0;f<c.plugins.length;)c.plugins[f].impl.refresh&&(d=c.plugins[f].canvas,d.width!==a._Mx.canvas.width&&(d.width=a._Mx.canvas.width),d.height!==a._Mx.canvas.height&&(d.height=a._Mx.canvas.height),d.getContext("2d").clearRect(0,0,d.width,d.height),c.plugins[f].impl.refresh(d),e.drawImage(d,0,0)),f+=1}function w(a){if(a=a._Gx,0===a.HCB.length)a.note="";else if(void 0===a.HCB[0].plotnote){for(var c=[],e=0;e<a.HCB.length;e++)a.HCB[e].file_name&&c.push(a.HCB[e].file_name);a.note=c.join("|").toUpperCase()}}function z(c,e){var d=c._Mx,f=c._Gx;if(!(e>=f.lyr.length)&&f.lyr[e].display&&0===f.hold){f.lyr[e].draw();var g=document.createEvent("Event");g.initEvent("lyrdraw",!0,!0),g.index=e,g.name=f.lyr[e].name,g.layer=f.lyr[e],a.dispatchEvent(d,g)}}function D(c){var e=c._Gx;c=c._Mx,e.cross&&(("vertical"===e.cross||!0===e.cross)&&c.xpos>=c.l&&c.xpos<=c.r&&e.cross_xpos!==c.xpos&&(void 0!==e.cross_xpos&&a.rubberline(c,e.cross_xpos,c.t,e.cross_xpos,c.b),a.rubberline(c,c.xpos,c.t,c.xpos,c.b),e.cross_xpos=c.xpos),("horizontal"===e.cross||!0===e.cross)&&c.ypos>=c.t&&c.ypos<=c.b&&e.cross_ypos!==c.ypos&&(void 0!==e.cross_ypos&&a.rubberline(c,c.l,e.cross_ypos,c.r,e.cross_ypos),a.rubberline(c,c.l,c.ypos,c.r,c.ypos),e.cross_ypos=c.ypos))}function A(c){var e=c._Gx;if(c=c._Mx,null!==e.xmrk&&null!==e.ymrk){var d=a.real_to_pixel(c,e.xmrk,e.ymrk);if(!d.clipped){var f=c.active_canvas.getContext("2d");f.beginPath(),f.strokeStyle=c.xwfg,f.fillStyle=c.xwfg,f.arc(d.x,d.y,2,0,360),f.stroke(),f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle=c.fg,f.font=c.font.font;var g="x:"+a.format_g(e.xmrk,6,3,!0);f.fillText(g,d.x+5,d.y-5),g="y:"+a.format_g(e.ymrk,6,3,!0),f.fillText(g,d.x+5,d.y-5+c.text_h)}}}function E(a,c){var e=a._Mx,d=a._Gx;d.xdata=!1;for(var f=0;f<d.lyr.length;f++)d.lyr[f].xdata=5===c?!0:!1,d.lyr[f].xdata&&(d.xdata=!0);if(c!==d.cmode)if(5===c&&d.index)alert("Imag/Real mode not permitted in INDEX mode");else if(0>=d.lyr.length)d.cmode=c,N(a);else if(c>0){f=d.cmode,d.cmode=c;var g=d.autox,k=d.autoy;if(d.autox=3,d.autoy=3,5===c||5===f)d.panxmin=1,d.panxmax=-1,d.panymin=1,d.panymax=-1,e.level=0,c===d.basemode?(e.stk[0].xmin=d.xmin,e.stk[0].xmax=d.xmax,e.stk[0].ymin=d.ymin,e.stk[0].ymax=d.ymax):5===c||5===d.basemode?G(a,{get_data:!0}):(e.stk[0].xmin=d.xmin,e.stk[0].xmax=d.xmax,G(a,{get_data:!0},d.xmin,d.xmax));else for(c===d.basemode?(d.panymin=1,d.panymax=-1,e.stk[0].ymin=d.ymin,e.stk[0].ymax=d.ymax):G(a,{},e.stk[e.level].xmin,e.stk[e.level].xmax),f=1;f<=e.level;f++)e.stk[f].ymin=e.stk[0].ymin,e.stk[f].ymax=e.stk[0].ymax;d.autox=g,d.autoy=k,a.refresh()}}function J(c){var e,d=c._Mx,f=c._Gx;if(f.pan&&!d.widget){e=d.level;var g={ps:d.stk[e].ymin,pe:d.stk[e].ymax},k=g.ps!==f.panymin||g.pe!==f.panymax,k=k&&0<d.level;!f.autohide_panbars||k&&c.mouseOnCanvas||f.panning?(a.scrollbar(d,0,f.pyl,f.pyl+f.pthk,d.t,d.b,g,f.panymin,f.panymax,void 0,d.scrollbar_y),d.stk[e].ymin=g.ps,d.stk[e].ymax=g.pe):(g=d.canvas.getContext("2d"),g.fillStyle=d.bg,g.fillRect(f.pyl,d.t,f.pyl+f.pthk,d.b-d.t)),f.pl<d.width&&(g={ps:d.stk[e].xmin,pe:d.stk[e].xmax},k=(k=g.ps!==f.panxmin||g.pe!==f.panxmax)&&(!f.all||0<d.level),!f.autohide_panbars||k&&c.mouseOnCanvas||f.panning?(a.scrollbar(d,0,f.pl,f.pr,f.pt,f.pt+f.pthk,g,f.panxmin,f.panxmax,void 0,d.scrollbar_x),d.stk[e].xmin=g.ps,d.stk[e].xmax=g.pe):(g=d.canvas.getContext("2d"),g.fillStyle=d.bg,g.fillRect(f.pl,f.pt-1,f.pr-f.pl,f.pthk+4)))}}function Q(c,e,d,f){var h,l,n,q,g=c._Mx,k=c._Gx;q=new a.SCROLLBAR,l=new a.SCROLLBAR;var t=!1;return h=g.level,0<k.panmode?(q.flag=11,l.flag=11):(q.flag=-12,l.flag=-12),0===d&&(q.action=0,l.action=0),"Y"===e.substring(0,1)?(q=g.stk[h].ymin,d=g.stk[h].ymax,n=d-q,"YPAN"===e?(e=g.scrollbar_y,d={ps:q,pe:d},a.scrollbar(g,l,k.pyl,k.pyl+k.pthk,g.t,g.b,d,k.panymin,k.panymax,f,e),q=d.ps,d=d.pe,0!==l.action&&a.scroll(g,l,a.XW_UPDATE,void 0,e)):"YCENTER"===e&&(q-=n*(g.ypos-(g.t+g.b)/2)/(g.b-g.t),d=q+n),(q!==g.stk[h].ymin||d!==g.stk[h].ymax)&&(g.stk[h].ymin=q,g.stk[h].ymax=d,k.cmode===k.basemode&&1===g.level&&(k.ymin=Math.min(k.ymin,q),k.ymax=Math.max(k.ymax,d)),this.inPan=!0,f=document.createEvent("Event"),f.initEvent("ypan",!0,!0),f.level=g.level,f.xmin=g.stk[g.level].xmin,f.ymin=g.stk[g.level].ymin,f.xmax=g.stk[g.level].xmax,f.ymax=g.stk[g.level].ymax,a.dispatchEvent(g,f),this.inPan=!1,c.refresh(),t=!0)):(l=g.stk[h].xmin,d=g.stk[h].xmax,n=d-l,"XPAN"===e?(e=g.scrollbar_x,d={ps:l,pe:d},a.scrollbar(g,q,k.pl,k.pr,k.pt,k.pt+k.pthk,d,k.panxmin,k.panxmax,f,e),l=d.ps,d=d.pe,0!==q.action&&a.scroll(g,q,a.XW_UPDATE,void 0,e)):"XCENTER"===e&&(l+=n*(g.xpos-(g.l+g.r)/2)/(g.r-g.l),l!==g.stk[h].xmin&&(d=l+n)),(g.stk[h].xmin!==l||g.stk[h].xmax!==d)&&(g.stk[h].xmin=l,g.stk[h].xmax=d,k.xdata||1!==g.level||(k.xmin=g.stk[1].xmin,k.xmax=g.stk[1].xmax),this.inPan=!0,f=document.createEvent("Event"),f.initEvent("xpan",!0,!0),f.level=g.level,f.xmin=g.stk[g.level].xmin,f.ymin=g.stk[g.level].ymin,f.xmax=g.stk[g.level].xmax,f.ymax=g.stk[g.level].ymax,a.dispatchEvent(g,f),this.inPan=!1,c.refresh(),t=!0)),t}function U(c,e,d){var k,h,l,f=c._Mx,g=c._Gx;if("XPAN"===e)l=c._Mx.scrollbar_x;else{if("YPAN"!==e)throw"Unable to drag scrollbar - scrollAction is not 'XPAN' or 'YPAN'!!";l=c._Mx.scrollbar_y}l.flag=-12,h=f.level,"XPAN"===e?(k=f.stk[h].xmin,h=f.stk[h].xmax):"YPAN"===e?(k=f.stk[h].ymin,h=f.stk[h].ymax):h=k=void 0;var n=l;if(n.action=a.SB_DRAG,"YPAN"===e){var t=f.scrollbar_y.trange/f.scrollbar_y.h;4===n.origin&&(t*=-1),d=d.screenY-g.panning.ypos,d*=t,g.panning.ymin-d<g.panymin?(h=g.panymin+(h-k),k=g.panymin):g.panning.ymax-d>g.panymax?(k=g.panymax-(h-k),h=g.panymax):(k=g.panning.ymin-d,h=g.panning.ymax-d)}else"XPAN"===e&&(t=f.scrollbar_x.trange/f.scrollbar_x.w,3===n.origin&&(t*=-1),d=d.screenX-g.panning.xpos,d*=t,g.panning.xmin+d<g.panxmin?(h=g.panxmin+(h-k),k=g.panxmin):g.panning.xmax+d>g.panxmax?(k=g.panxmax-(h-k),h=g.panxmax):(k=g.panning.xmin+d,h=g.panning.xmax+d));l.smin=k,l.srange=h-k,a.redrawScrollbar(l,f,void 0),q(c,l.smin,l.smin+l.srange,e.slice(0,1)),this.inPan=!0,g=document.createEvent("Event"),"XPAN"===e?g.initEvent("xpan",!0,!0):"YPAN"===e&&g.initEvent("ypan",!0,!0),g.level=f.level,g.xmin=f.stk[f.level].xmin,g.ymin=f.stk[f.level].ymin,g.xmax=f.stk[f.level].xmax,g.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,g),this.inPan=!1,l.action=0,c.refresh()}function M(c,e,d,f,g,k,h,l){var n=c._Mx;if(n.prompt)throw"Prompt already exists! Can only have one prompt at a time!";a.disableListeners(n),c.disable_listeners();var q=function(c,e){return function(d){e(d),a.enableListeners(n),c.enable_listeners(),c.refresh(),void 0!==l&&l()}},t=function(){c.refresh()};try{a.prompt(n,e,d,q(c,f),t,g,k,h,5e3)}catch(v){console.log("ERROR: Failed to set up prompt due to: "+v)}}function N(e){var d=e._Mx,f=e._Gx,p=d.canvas.getContext("2d");if(0===f.sections&&(f.isec=0),f.aretx=f.retx,f.arety=f.rety,f.dretx=f.retx-f.xmrk,f.drety=f.rety-f.ymrk,5===f.cmode&&1===f.iabsc&&(f.iabsc=2),1===f.iabsc?(f.aretx=Math.round((f.aretx-f.xstart)/f.xdelta),f.index||(f.aretx+=1),f.dretx=Math.round(f.dretx/f.xdelta)):2===f.iabsc&&(0!==f.aretx&&(f.aretx=1/f.aretx),0!==f.arety&&(f.arety=1/f.arety),0!==f.dretx&&(f.dretx=1/f.dretx),0!==f.drety&&(f.drety=1/f.drety)),f.show_readout&&!d.widget){p.fillStyle=d.bg;var g=Math.floor(d.height-2.5*d.text_h);p.fillRect(d.text_w,g,49*d.text_w,g+1.5*d.text_h);var g=Math.floor(d.height-.5*d.text_h),k=Math.max(f.pr+d.text_w,d.width-2*d.text_w);if(p.fillStyle=d.bg,p.fillRect(k,g-d.text_h,d.text_w,d.text_h),!f.autohide_readout||e.mouseOnCanvas||f.panning){var h;0===f.iabsc&&4===f.ylab?(p=(c.sec2tspec(f.arety)+"                ").substring(0,16),h=(c.sec2tspec(f.drety,"delta")+"                ").substring(0,16)):(p=a.format_g(f.arety,16,9,!0),h=a.format_g(f.drety,16,9)),0===f.iabsc&&4===f.xlab?(g=(c.sec2tspec(f.aretx)+"                ").substring(0,16),e=(c.sec2tspec(f.dretx,"delta")+"                ").substring(0,16)):(g=a.format_g(f.aretx,16,9,!0),e=a.format_g(f.dretx,16,9)),p="y: "+p+" dy: "+h+" L="+d.level+" "+Y[f.cmode-1],e="x: "+g+" dx: "+e+" "+v[f.iabsc],3===f.iabsc&&(p=0===f.dretx?p.substr(0,20)+"sl: Inf             "+p.substr(40,p.length):p.substr(0,20)+"sl: "+a.format_g(f.drety/f.dretx,16,9)+p.substr(40,p.length)),g=Math.floor(d.height-1.5*d.text_h),a.text(d,d.text_w,g,p),g=Math.floor(d.height-.5*d.text_h),a.text(d,d.text_w,g,e),a.LEGACY_RENDER&&k<d.width&&(0<f.cntrls?a.text(d,k,g,"C"):a.text(d,k,g," ")),a.colorbar(d,49*d.text_w-3,d.height-2.5*d.text_h,d.text_w,2*d.text_h)}}}function G(a,c,d,e,f,g){var k=a._Mx;a=a._Gx,c=!0===c.get_data,a.panxmin=1,a.panxmax=-1,a.panymin=1,a.panymax=-1;var h=void 0===d,l=void 0===e;if(0===a.lyr.length)a.panxmin=-1,a.panxmax=1,a.panymin=-1,a.panymax=1;else for(void 0===f&&(a.xlab=a.lyr[0].xlab),void 0===g&&(a.ylab=a.lyr[0].ylab),f=0;f<a.lyr.length;f++)if(h&&(d=a.lyr[f].xmin),l&&(e=a.lyr[f].xmax),a.xlab!==a.lyr[f].xlab&&(a.xlab=0),a.ylab!==a.lyr[f].ylab&&(a.ylab=0),c&&a.lyr[f].get_data(d,e),0<a.autox||0<a.autoy)for(;e>d;)a.lyr[f].get_data(d,e),g=a.lyr[f].prep(d,e),a.all&&a.expand?0===a.lyr[f].size?d=e:a.index?d+=g:0<=a.lyr[f].xdelta?d+=a.lyr[f].size*a.lyr[f].xdelta:e+=a.lyr[f].size*a.lyr[f].xdelta:d=e;else a.lyr[f].prep(1,-1);if(f=a.panxmax-a.panxmin,0>f&&(a.panxmax=a.panxmin,a.panxmin=a.panxmax+f,f=-f),1e-20>=f&&(a.panxmin-=1,a.panxmax+=1),0!==(1&a.autox)&&h&&(k.stk[0].xmin=a.panxmin),0!==(2&a.autox)&&l&&(k.stk[0].xmax=a.panxmax,!a.all&&!a.xdata))for(f=0;f<a.lyr.length;f++)e=Math.min(a.lyr[f].xmax,k.stk[0].xmax),g=Math.abs((e-a.lyr[f].xmin)/a.lyr[f].xdelta)-a.bufmax+1,g>0&&(k.stk[0].xmax=e-g*Math.abs(a.lyr[f].xdelta));0!==(1&a.autoy)&&(k.stk[0].ymin=a.panymin),0!==(2&a.autoy)&&(k.stk[0].ymax=a.panymax)}function T(c,d,e){var f=c._Gx;return c=a.pixel_to_real(c._Mx,d,e),f.index&&(c.x*=f.xdelta),c}function e(a,c,d,e,f,g){return a>=d&&d+f>=a&&c>=e&&e+g>=c}function x(a){var d=!1,e=a._Gx,f=a._Mx,g=f.xpos,k=f.ypos,h=" ";return a.mouseOnCanvas?(e.pan&&g>f.r&&k>=f.t&&k<=f.b?(h="YPAN",f.xpos=e.pyl+c.trunc(e.pthk/2),d=!0):e.pan&&g>=e.pl&&g<=e.pr&&(e.show_readout&&k>e.pt-2||!e.show_readout&&k<=e.pt+e.pthk+2)&&(h="XPAN",f.ypos=e.pt+c.trunc(e.pthk/2),d=!0),{inPanRegion:d,command:h}):!1}function B(c,d){var e,f,g;return 1&d.origin?(g=c.x-d.x,2&d.origin&&(g=d.w-g)):(g=c.y-d.y,2>=d.origin&&(g=d.h-g)),f=a.scroll_real2pix(d),e=f.s1,f=f.sw,g>=e&&e+f>=g?!0:!1}function C(c,d,e){var g,f=c._Mx;"XPAN"===e?g=f.scrollbar_x:"YPAN"===e&&(g=f.scrollbar_y),g.action=d,g.step=.1*g.srange,g.page=9*g.step,g.scale=2,a.scroll(f,g,a.XW_COMMAND,void 0,g),q(c,g.smin,g.smin+g.srange,e.slice(0,1)),this.inPan=!0,c=document.createEvent("Event"),"XPAN"===e?c.initEvent("xpan",!0,!0):"YPAN"===e&&c.initEvent("ypan",!0,!0),c.level=f.level,c.xmin=f.stk[f.level].xmin,c.ymin=f.stk[f.level].ymin,c.xmax=f.stk[f.level].xmax,c.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,c),this.inPan=!1}function q(a,c,d,e){var f=a._Mx,g=a._Gx,k=f.level;"X"===e?(f.stk[k].xmin!==c||f.stk[k].xmax!==d)&&(f.stk[k].xmin=c,f.stk[k].xmax=d,g.xdata||1!==f.level||(g.xmin=f.stk[1].xmin,g.xmax=f.stk[1].xmax),a.refresh()):"Y"!==e||c===f.stk[k].ymin&&d===f.stk[k].ymax||(f.stk[k].ymin=c,f.stk[k].ymax=d,g.cmode===g.basemode&&1===f.level&&(g.ymin=Math.min(g.ymin,c),g.ymax=Math.max(g.ymax,d)),a.refresh())}var h="Keypress Table:\n--------------\n?    - Main help box.\nA    - Toggle display x,y readouts:\n       (absc) -> (index) -> (1/absc) -> (time).\nB    - Toggle LM Drag Mode:\n       (box) -> (horizontal) -> (vertical).\nC    - Toggle controls.\nK    - Show Marker.\nL    - Toggle legend.\nM    - Pops up main menu\nR    - Toggle display specs (x/y readout)\nS    - Toggle display specs and axes.\nT    - Popup box with timecode value at mouse.\nX    - Popup box with X value at mouse.\nY    - Popup box with Y value at mouse.\nF    - Toggle fullscreen.\n";d.browserIsCompatible=function(){var a=document.createElement("canvas").getContext?!0:!1,c="ArrayBuffer"in window;return a&&c},d.PointArray=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)||"undefined"==typeof Float64Array||Float64Array.emulated||!Float64Array.BYTES_PER_ELEMENT?Float32Array:Float64Array,d.Plot=function(r,s){if(!d.browserIsCompatible())throw"Browser is not compatible";var h=this._Mx=a.open(r);return this._Gx=new y,this._Gx.parent=r,this.mouseOnCanvas=!1,s||(s={}),n(this,s),this._refresh(),this.onmousemove=function(c){return function(d){var e=c._Mx,f=c._Gx,g=d.target.getBoundingClientRect(),r=void 0===d.offsetX?d.pageX-g.left-window.scrollX:d.offsetX;d=void 0===d.offsetX?d.pageY-g.top-window.scrollY:d.offsetY,g=T(c,r,d),f.retx=g.x,f.rety=g.y,e.widget||(N(c),g=document.createEvent("Event"),g.initEvent("mmove",!0,!0),g.xpos=r,g.ypos=d,g.x=f.retx,g.y=f.rety,a.dispatchEvent(e,g)&&(f.cross&&(e.warpbox?(void 0!==f.cross_xpos&&a.rubberline(e,f.cross_xpos,e.t,f.cross_xpos,e.b),void 0!==f.cross_ypos&&a.rubberline(e,e.l,f.cross_ypos,e.r,f.cross_ypos),f.cross_xpos=void 0,f.cross_ypos=void 0):D(c)),2===f.cntrls&&(g=document.createEvent("Event"),g.initEvent("mtag",!0,!0),g.x=f.retx,g.y=f.rety,g.xpos=r,g.ypos=d,a.dispatchEvent(e,g))))}}(this),this.ontouchmove=function(a){return function(c){c.preventDefault(),a.onmousemove(c)}}(this),this.throttledOnMouseMove=c.throttle(this._Gx.scroll_time_interval,this.onmousemove),a.addEventListener(h,"mousemove",this.throttledOnMouseMove,!1),this.onmouseout=function(a){return function(c){c=a._Gx;var d=a._Mx;a.mouseOnCanvas&&(a.mouseOnCanvas=!1,c.autohide_readout&&N(a),c.autohide_panbars&&J(a),d.prompt&&d.prompt.input.enableBlur())}}(this),a.addEventListener(h,"mouseout",this.onmouseout,!1),this.onmouseover=function(a){return function(c){c=a._Gx;var d=a._Mx;a.mouseOnCanvas=!0,c.autohide_panbars&&J(a),d.prompt&&d.prompt.input.disableBlur()}}(this),a.addEventListener(h,"mouseover",this.onmouseover,!1),this.onmousedown=function(c){return function(d){d.preventDefault();var r=c._Mx,s=c._Gx;r.widget&&"ONESHOT"===r.widget.type&&(r.widget=null,c.refresh()),a.ifevent(r,d);var h=document.createEvent("Event");if(h.initEvent("mdown",!0,!0),h.xpos=r.xpos,h.ypos=r.ypos,h.x=s.retx,h.y=s.rety,h.which=d.which,!a.dispatchEvent(r,h))return!1;var l=x(c);if(l.inPanRegion){if(d.preventDefault()," "!==l.command){var n=null,h=null;if("XPAN"===l.command?n=r.scrollbar_x:"YPAN"===l.command&&(n=r.scrollbar_y),2===d.which)h={x:r.xpos,y:r.ypos},void 0!==n&&B(h,n)&&g(c,l.command);else if(" "!==l.command&&(h={x:r.xpos,y:r.ypos},!B(h,n)&&1===d.which)){Q(c,l.command,0,d);var q=function(){B({x:r.xpos,y:r.ypos},n)?s.stillPanning&&(window.clearInterval(s.stillPanning),s.repeatPanning=void 0):Q(c,l.command,0,d)};s.stillPanning=window.setTimeout(function(){s.repeatPanning=window.setInterval(q,50)},250)}}}else if(1===d.which)if(h=!1,s.legendBtnLocation&&(h=e(r.xpos,r.ypos,s.legendBtnLocation.x,s.legendBtnLocation.y,s.legendBtnLocation.width,s.legendBtnLocation.height)),h)c.change_settings({legend:!s.legend});else{s.xmrk=s.retx,s.ymrk=s.rety,N(c);var h={opacity:0,return_value:"zoom"},u={opacity:.4,fill_color:r.hi,return_value:"select"};"zoom"===s.default_rubberbox_action?a.rubberbox(r,f(c),s.default_rubberbox_mode,h,u):"select"===s.default_rubberbox_action&&a.rubberbox(r,f(c),s.default_rubberbox_mode,u,h),(s.always_show_marker||s.show_marker)&&c.redraw()}else 2===d.which&&(s.nomenu||k(c));return!1}}(this),this.ontouchstart=function(a){return function(c){c.preventDefault(),a.onmousedown({which:1})}}(this),a.addEventListener(h,"mousedown",this.onmousedown,!1),this.docMouseUp=function(a){return function(c){var d=a._Gx;return 1===c.which&&(d.panning=void 0,a._Mx.scrollbar_x.action=0,a._Mx.scrollbar_y.action=0),d.stillPanning&&(window.clearTimeout(d.stillPanning),d.stillPanning=void 0),d.repeatPanning&&(window.clearInterval(d.repeatPanning),d.repeatPanning=void 0),!1}}(this),document.addEventListener("mouseup",this.docMouseUp,!1),this.mouseup=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");if(g.initEvent("mup",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,g=a.dispatchEvent(f,g))if(3===d.which)d.preventDefault(),c.unzoom(1),c.refresh();else if(2===d.which&&e.nomenu&&(g=document.createEvent("Event"),g.initEvent("showmenu",!0,!0),g.x=d.x||d.clientX,g.y=d.y||d.clientY,g=a.dispatchEvent(f,g))){d.stopPropagation&&d.stopPropagation(),d.cancelBubble=!0,a.removeEventListener(f,"mousedown",c.onmousedown,!1);var r=function(){try{var d=document.createEvent("Event");d.initEvent("hidemenu",!0,!0),a.dispatchEvent(f,d)&&a.addEventListener(f,"mousedown",c.onmousedown,!1)}finally{document.removeEventListener("mouseup",r,!1)}};document.addEventListener("mouseup",r,!1)}}}(this),this.ontouchend=function(){return function(a){a.preventDefault()}}(this),a.addEventListener(h,"mouseup",this.mouseup,!1),this.mouseclick=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");return g.initEvent("mclick",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,a.dispatchEvent(f,g),!1}}(this),a.addEventListener(h,"click",this.mouseclick,!1),this.mousedblclick=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");return g.initEvent("mdblclick",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,a.dispatchEvent(f,g),!1}}(this),a.addEventListener(h,"dblclick",this.mousedblclick,!1),this.dragMouseDownHandler=function(a){return function(c){var d=a._Mx,e=a._Gx,f=x(a);if(f.inPanRegion&&(c.preventDefault()," "!==f.command)){var g;"XPAN"===f.command?g=d.scrollbar_x:"YPAN"===f.command&&(g=d.scrollbar_y);var r={x:d.xpos,y:d.ypos};void 0!==g&&B(r,g)&&1===c.which&&(e.panning={axis:f.command,xpos:c.screenX,ypos:c.screenY,xmin:d.stk[d.level].xmin,xmax:d.stk[d.level].xmax,ymin:d.stk[d.level].ymin,ymax:d.stk[d.level].ymax})}}}(this),window.addEventListener("mousedown",this.dragMouseDownHandler,!1),this.dragMouseMoveHandler=function(a){return function(c){var d=a._Gx;if(void 0!==d.panning)try{U(a,d.panning.axis,c)}catch(e){console.log("Error: "+e)}}}(this),this.throttledDragOnMouseMove=c.throttle(this._Gx.scroll_time_interval,this.dragMouseMoveHandler),window.addEventListener("mousemove",this.throttledDragOnMouseMove,!1),this.dragMouseUpHandler=function(a){return function(c){var d=a._Gx;1===c.which&&(d.panning=void 0)}}(this),window.addEventListener("mouseup",this.dragMouseUpHandler,!1),this.onresize=function(c){return function(){a.checkresize(c._Mx)&&c.refresh()}}(this),this.wheelHandler=function(d){var e=d._Mx,f=d._Gx,g=c.throttle(100,function(c){var g;"XPAN"===c.command?g=e.scrollbar_x:"YPAN"===c.command&&(g=e.scrollbar_y),g.action=f.wheelscroll_mode_natural?0>event.deltaY?a.SB_WHEELDOWN:a.SB_WHEELUP:0>event.deltaY?a.SB_WHEELUP:a.SB_WHEELDOWN,g.step=.1*g.srange,g.page=9*g.step,a.scroll(e,g,a.XW_COMMAND,void 0,g),q(d,g.smin,g.smin+g.srange,c.command.slice(0,1))}),r=c.throttle(100,function(){var a=f.wheelZoomPercent||.2;f.wheelscroll_mode_natural?0<event.deltaY&&(a*=-1):0>event.deltaY&&(a*=-1),"x"===f.wheelZoom?d.percent_zoom(a,1,!0):"y"===f.wheelZoom?d.percent_zoom(1,a,!0):d.percent_zoom(a,a,!0)});return function(c){a.ifevent(e,c);var s=x(d);d.mouseOnCanvas&&(c.preventDefault(),s.inPanRegion?g(s):f.wheelZoom&&r())}}(this),window.addWheelListener(window,this.wheelHandler,!1),window.addEventListener("resize",this.onresize,!1),s.nokeypress||(this.onkeypress=function(d){return function(e){var f=d._Mx,g=d._Gx;if(d.mouseOnCanvas&&(!f.widget||"MENU"!==f.widget.type))if(f.widget&&"ONESHOT"===f.widget.type)f.widget=null,d.refresh();else{var r=getKeyCode(e),s=document.createEvent("Event");s.initEvent("plotkeypress",!0,!0),s.keyCode=r,s.shiftKey=e.shiftKey,s.ctrlKey=e.ctrlKey,s.altKey=e.altKey,s.metaKey=e.metaKey,(s=a.dispatchEvent(f,s))&&(97===r?(g.iabsc=(g.iabsc+1)%4,N(d)):108===r?d.change_settings({legend:!g.legend}):103===r?d.change_settings({grid:!g.grid}):98===r||2===r?f.warpbox&&(f.warpbox.mode="box"===f.warpbox.mode?"horizontal":"horizontal"===f.warpbox.mode?"vertical":"box",a.redraw_warpbox(f)):99===r?d.change_settings({xcnt:-1*g.cntrls}):114===r?d.change_settings({show_readout:!g.show_readout}):115===r?d.change_settings({specs:!g.specs}):120===r?(e=d._Gx,f=d._Mx,g=e.aretx.toString(),1===e.iabsc?a.message(f,"INDEX = "+g):2===e.iabsc?a.message(f,"1/X = "+g):a.message(f,"X = "+g)):121===r?(e=d._Gx,f=d._Mx,g=e.arety.toString(),2===e.iabsc?a.message(f,"1/Y = "+g):a.message(f,"Y = "+g)):122===r?(e=d._Gx,f=d._Mx,e.zmin&&e.zmax&&(g="",g=1===e.lyr.length?"Z = "+e.lyr[0].get_z(e.retx,e.rety).toString():"TODO",a.message(f,g))):116===r?(e=d._Gx,f=d._Mx,0<e.lyr.length&&(g=e.lyr[0].hcb,1!==g["class"]||1!==g.xunits&&4!==g.xunits?2!==g["class"]||1!==g.yunits&&4!==g.yunits?a.message(f,"Time = UNK"):a.message(f,"Time = "+c.sec2tod(g.timecode+e.rety),!0):a.message(f,"Time = "+c.sec2tod(g.timecode+e.retx),!0))):109===r?g.nomenu||(s=document.createEvent("Event"),s.initEvent("showmenu",!0,!0),s.x=f.x,s.y=f.y,(s=a.dispatchEvent(f,s))&&k(d)):63===r?a.message(f,"To zoom, press and drag the left mouse (LM) over the region of interest and release. To unzoom, press right mouse (RM).  Press the middle mouse (MM) button or press the by selecting 'Keypress Info' from the main menu."):102===r?(a.fullscreen(f),d.refresh()):9===r&&e.ctrlKey?d.change_settings({invert:null}):107===r&&(g.show_marker=!g.show_marker,d.redraw()))
}}}(this),setKeypressHandler(this.onkeypress)),this},d.Plot.prototype={add_plugin:function(a,c){if(void 0===c&&(c=Number.MAX_VALUE),0>=c)throw"Invalid plugin zorder";a.init(this);var d=document.createElement("canvas");d.width=this._Mx.canvas.width,d.height=this._Mx.canvas.height,this._Gx.plugins.push({impl:a,zorder:c,canvas:d}),this._Gx.plugins.sort(function(a,c){return a.zorder-c.zorder}),this.refresh()},remove_plugin:function(a){for(var c=0;c<this._Gx.plugins.length;c++)this._Gx.plugins[c].impl===a&&(a.dispose&&a.dispose(),this._Gx.plugins[c].canvas.parentNode&&this._Gx.plugins[c].canvas.parentNode.removeElement(this._Gx.plugins[c].canvas));this._Gx.plugins.sort(function(a,c){return a.zorder-c.zorder}),this.refresh()},addListener:function(c,d){a.addEventListener(this._Mx,c,d,!1)},removeListener:function(c,d){a.removeEventListener(this._Mx,c,d,!1)},change_settings:function(c){for(var d=this._Gx,e=this._Mx,f=0;f<d.lyr.length;f++)d.lyr[f].change_settings(c);if(void 0!==c.grid&&(d.grid=null===c.grid?!d.grid:c.grid),void 0!==c.gridBackground&&(d.gridBackground=c.gridBackground),void 0!==c.gridStyle&&(d.gridStyle=c.gridStyle),void 0!==c.wheelZoom&&(d.wheelZoom=c.wheelZoom),void 0!==c.wheelZoomPercent&&(d.wheelZoomPercent=c.wheelZoomPercent),void 0!==c.autol&&(d.autol=c.autol),void 0!==c.index&&c.index!==d.index&&(d.index=null===c.index?!d.index:c.index,d.index&&1!==d.iabsc?d.iabsc=1:d.index||1!==d.iabsc||(d.iabsc=0),G(this,{get_data:!1},void 0,void 0),this.unzoom()),void 0!==c.all&&(d.all=null===c.all?!d.all:c.all),void 0!==c.show_x_axis&&(d.show_x_axis=null===c.show_x_axis?!d.show_x_axis:c.show_x_axis,d.specs=d.show_x_axis||d.show_y_axis||d.show_readout),void 0!==c.show_y_axis&&(d.show_y_axis=null===c.show_y_axis?!d.show_y_axis:c.show_y_axis,d.specs=d.show_x_axis||d.show_y_axis||d.show_readout),void 0!==c.show_readout&&(d.show_readout=null===c.show_readout?!d.show_readout:c.show_readout,d.specs=d.show_x_axis||d.show_y_axis||d.show_readout),void 0!==c.specs&&(d.specs=null===c.specs?!d.specs:c.specs,d.specs?(d.show_x_axis=!0,d.show_y_axis=!0,d.show_readout=!0):(d.show_x_axis=!1,d.show_y_axis=!1,d.show_readout=!1)),void 0!==c.xcnt&&(d.cntrls="leftmouse"===c.xcnt?1:"continuous"===c.xcnt?2:"disable"===c.xcnt&&0<d.cntrls?-1*d.cntrls:"enable"===c.xcnt&&0>d.cntrls?-1*d.cntrls:c.xcnt),void 0!==c.legend&&(d.legend=null===c.legend?!d.legend:c.legend),void 0!==c.pan&&(d.pan=null===c.pan?!d.pan:c.pan),void 0!==c.cross&&(d.cross=null===c.cross?!d.cross:c.cross,d.cross?(d.cross_xpos=void 0,d.cross_ypos=void 0,D(this)):(void 0!==d.cross_xpos&&a.rubberline(e,d.cross_xpos,e.t,d.cross_xpos,e.b),void 0!==d.cross_ypos&&a.rubberline(e,e.l,d.cross_ypos,e.r,d.cross_ypos),d.cross_xpos=void 0,d.cross_ypos=void 0)),void 0!==c.cmode&&E(this,c.cmode),void 0!==c.phunits){var g=c.phunits,f=this._Gx,k=this._Mx,h=f.plab;if("R"===g?h=23:"D"===g&&(h=24),"C"===g&&(h=25),h!==f.plab&&(g=[Math.PI,180,.5],g=g[h-23]/g[f.plab-23],f.plab=h,2===f.cmode)){for(h=0;h<=k.level;h++)k.stk[h].ymin*=g,k.stk[h].ymax*=g,k.stk[h].yscl*=g;f.panymin*=g,f.panymax*=g,this.refresh()}}void 0!==c.rubberbox_action&&(d.default_rubberbox_action=c.rubberbox_action),void 0!==c.rubberbox_mode&&(d.default_rubberbox_mode=c.rubberbox_mode),void 0!==c.wheelscroll_mode_natural&&(d.wheelscroll_mode_natural=c.wheelscroll_mode_natural),void 0!==c.colors&&(c.colors.fg||(c.colors.fg=e.fg),c.colors.bg||(c.colors.bg=e.bg),a.setbgfg(e,c.colors.bg,c.colors.fg,e.xi)),void 0!==c.cmap&&(d.cmap=null===c.cmap?2===d.cmode?2:1:c.cmap,t(this,d.cmap)),void 0!==c.yinv&&(e.origin=c.yinv?4:1),void 0!==c.rasterSmoothing&&(d.rasterSmoothing=null===c.rasterSmoothing?!d.rasterSmoothing:c.rasterSmoothing),void 0!==c.fillStyle&&(d.fillStyle=c.fillStyle),void 0!==c.invert&&(null===c.invert?a.invertbgfg(e):!0===c.invert?a.setbgfg(this,"white","black"):a.setbgfg(this,"black","white")),void 0!==c.nomenu&&(d.nomenu=null===c.nomenu?!d.nomenu:c.nomenu),void 0!==c.ymin&&q(this,c.ymin,e.stk[0].ymax,"Y"),void 0!==c.ymax&&q(this,e.stk[0].ymin,c.ymax,"Y"),void 0!==c.xmin&&q(this,c.xmin,e.stk[0].xmax,"X"),void 0!==c.xmax&&q(this,e.stk[0].xmin,c.xmax,"X"),void 0!==c.zmin&&(d.zmin=c.zmin,d.autoz&=2),void 0!==c.zmax&&(d.zmax=c.zmax,d.autoz&=1),void 0!==c.autoz&&(d.autoz=c.autoz,0!==(1&d.autoz)&&(d.zmin=void 0),0!==(2&d.autoz)&&(d.zmax=void 0)),void 0!==c.note&&(d.note=c.note),this.refresh(),void 0!==c.pan&&N(this)},reread:function(){for(var c=this._Gx,d=[],e=0;e<c.lyr.length;e++)d[e]=c.lyr[e];e=c.HCB.slice(),this.deoverlay();for(var f=0;f<e.length;f++)this.overlay_bluefile(e[f]);for(e=0;e<c.lyr.length;e++)c.lyr[e].symbol=d[e].symbol,c.lyr[e].radius=d[e].radius;this.refresh(),c=document.createEvent("Event"),c.initEvent("reread",!0,!0),a.dispatchEvent(this._Mx,c)},cleanup:function(){},reload:function(a,c,d){var e=this._Mx,f=this._Gx;0>a||a>=f.lyr.length||void 0===f.lyr[a].reload||(a=f.lyr[a].reload(c,d),0===e.level&&G(this,{get_data:!1},a.xmin,a.xmax),this.refresh())},rescale:function(){0===this._Mx.level&&G(this,{get_data:!1},void 0,void 0),this.refresh()},push:function(a,c,d,e){var f=this._Mx,g=this._Gx;0>a||a>=g.lyr.length||void 0===g.lyr[a].push||(a=g.lyr[a].push(c,d,e),0===f.level&&a&&G(this,{get_data:!1}),this.refresh())},overlay_array:function(a,d,e){return c.log.debug("Overlay array"),a=c.initialize(a,d),this.overlay_bluefile(a,e)},overlay_pipe:function(a,d){c.log.debug("Overlay pipe"),a||(a={}),a.pipe=!0;var e=c.initialize(null,a);return this.overlay_bluefile(e,d)},overlay_websocket:function(a,d,e){c.log.debug("Overlay websocket: "+a),a=new WebSocket(a,"plot-data"),a.binaryType="arraybuffer";var f=this;d||(d={}),d.pipe=!0;var g=c.initialize(null,d);g.ws=a;var h=this.overlay_bluefile(g,e);return a.onopen=function(){},a.onmessage=function(){return function(a){a.data instanceof ArrayBuffer?(a=g.createArray(a.data),f.push(h,a)):"string"==typeof a.data&&(f._Gx.lyr[h].hcb||c.log.warning("Couldn't find header for layer "+h),a=JSON.parse(a.data),f.push(h,[],a))}}(a),h},overlay_href:function(a,d,e){c.log.debug("Overlay href: "+a);try{this.show_spinner();var f=function(a,c){return function(d){try{if(d){var f=a.overlay_bluefile(d,e);c&&c(d,f)}else alert("Failed to load data")}finally{a.hide_spinner()}}}(this,d);(new BlueFileReader).read_http(a,f)}catch(g){console.log(g),alert("Failed to load data"),this.hide_spinner()}},show_spinner:function(){this._Gx.spinner||(X.color=this._Mx.xwfg,this._Gx.spinner=new Spinner(X).spin(this._Gx.parent))},hide_spinner:function(){this._Gx.spinner&&this._Gx.spinner.stop(),this._Gx.spinner=void 0},add_layer:function(c){var d=this._Gx,e=this._Mx,f=document.createEvent("Event");f.initEvent("lyradd",!0,!0),f.index=d.lyr.length,f.name=c.name,f.layer=c,a.dispatchEvent(e,f)&&d.lyr.push(c)},get_layer:function(a){var c=this._Gx;return a>=0&&a<c.lyr.length?c.lyr[a]:null},overlay_bluefile:function(a,e){c.log.debug("Overlay bluefile: "+a.file_name);var f=this._Mx,g=this._Gx;e=e||{};var h=0===g.HCB.length;g.HCB.push(a),1===g.HCB.length&&l(this,!0);var k=g.lyr.length;if(void 0===e.layerType?1===a["class"]?d.Layer1D.overlay(this,a,e):2===a["class"]&&d.Layer2D.overlay(this,a,e):e.layerType.overlay(this,a,e),E(this,g.cmode),h)if(0===g.HCB.length)l(this,!1);else{g.basemode=g.cmode;var n,q;0===(g.autox&&1)&&(n=g.xmin),0===(g.autox&&2)&&(q=g.xmin),G(this,{get_data:!0},n,q),f.level=0,0!==(g.autox&&1)&&(g.xmin=f.stk[0].xmin),0!==(g.autox&&2)&&(g.xmax=f.stk[0].xmax),0!==(g.autoy&&1)&&(g.ymin=f.stk[0].ymin),0!==(g.autoy&&2)&&(g.ymax=f.stk[0].ymax),f.resize=!0,f.origin=g.lyr[0].preferred_origin?g.lyr[0].preferred_origin:1}else for(f=k;f<g.lyr.length;f++)z(this,f);return w(this),this.refresh(),g.HCB.length-1},load_files:function(a,c){for(var d=function(a){return function(d){a.overlay_bluefile(d,c)}}(this),e=0;e<a.length;e++){var f=a[e];(new BlueFileReader).read(f,d)}},deoverlay:function(a){var c=this._Gx;if(0<c.HCB.length)if(void 0===a)for(a=c.HCB.length-1;a>=0;a--)this.remove_layer(a);else if(0>a){if(a=c.HCB.length+a,0>a)return;this.remove_layer(a)}else a<c.HCB.length&&this.remove_layer(a);0===c.lyr.length&&(l(this,!1),G(this,{}))},remove_layer:function(c){var d=this._Gx,e="",f=null;if(c>=0&&c<d.HCB.length){for(e=d.HCB[c].file_name,f=d.HCB[c],d.HCB[c]=null;c<d.HCB.length-1;c++)d.HCB[c]=d.HCB[c+1];d.HCB.length-=1}for(c=d.lyr.length-1;c>=0;c--)if(d.lyr[c].hcb===f){var g=c,h=this._Gx,k=this._Mx,l=document.createEvent("Event");if(l.initEvent("lyrdel",!0,!0),l.index=g,l.name=h.lyr[g].name,l.layer=h.lyr[g],a.dispatchEvent(k,l)){if(h.lyr[g].ybufn=0,h.lyr[g].ybuf=null,g<h.lyr.length-1)for(;g<h.lyr.length-1;g++)h.lyr[g]=h.lyr[g+1];h.lyr.length-=1,0<h.HCB.length&&(h.panxmin=1,h.panxmax=-1,h.panymin=1,h.panymax=-1)}}w(this),this.refresh(),d=document.createEvent("Event"),d.initEvent("file_deoverlayed",!0,!0),""!==e&&(d.fileName=e),a.dispatchEvent(this._Mx,d)},pixel_zoom:function(a,c,d,e,f){a=T(this,a,c),d=T(this,d,e),this.zoom(a,d,f)},percent_zoom:function(a,c,d){var e=this._Mx,f=this._Gx,g=0;1>Math.abs(a)&&(g=Math.abs(e.stk[e.level].xmax-e.stk[e.level].xmin),g=g*a/2),a=0,1>Math.abs(c)&&(a=Math.abs(e.stk[e.level].ymax-e.stk[e.level].ymin),a=a*c/2),c={x:Math.max(e.stk[e.level].xmin+g,f.panxmin),y:Math.max(e.stk[e.level].ymin+a,f.panymin)},e={x:Math.min(e.stk[e.level].xmax-g,f.panxmax),y:Math.min(e.stk[e.level].ymax-a,f.panymax)},this.zoom(c,e,d)},zoom:function(c,d,e){var f=this._Mx,g=this._Gx;if(!(9<=f.level)){if(void 0===c.x&&(c.x=f.stk[f.level].xmin),void 0===c.y&&(c.y=f.stk[f.level].ymin),void 0===d.x&&(d.x=f.stk[f.level].xmax),void 0===d.y&&(d.y=f.stk[f.level].ymax),d.x<c.x){var h=d.x;d.x=c.x,c.x=h}d.y<c.y&&(h=d.y,d.y=c.y,c.y=h),h={},h.xscl=f.stk[f.level].xscl,h.yscl=f.stk[f.level].yscl,h.xmin=c.x,h.xmax=d.x,h.ymin=c.y,h.ymax=d.y,g.index&&(h.xmin=Math.min(h.xmin/g.xdelta),h.xmax=Math.min(h.xmax/g.xdelta)),e&&g.inContinuousZoom?f.stk[f.level]=h:(f.stk.push(h),f.level=f.stk.length-1),g.inContinuousZoom=e,this.inZoom=!0,c=document.createEvent("Event"),c.initEvent("zoom",!0,!0),c.level=f.level,c.inContinuousZoom=g.inContinuousZoom,c.xmin=f.stk[f.level].xmin,c.ymin=f.stk[f.level].ymin,c.xmax=f.stk[f.level].xmax,c.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,c),this.inZoom=!1,this.refresh()}},unzoom:function(c){var d=this._Mx,e=this._Gx;if(0!==d.level){for(c||(c=d.stk.length);c>0&&0!==d.level;)d.stk.pop(),d.level=d.stk.length-1,c-=1;e.inContinuousZoom=!1,this.inZoom=!0,c=document.createEvent("Event"),c.initEvent("unzoom",!0,!0),c.level=d.level,c.xmin=d.stk[d.level].xmin,c.ymin=d.stk[d.level].ymin,c.xmax=d.stk[d.level].xmax,c.ymax=d.stk[d.level].ymax,a.dispatchEvent(d,c),this.inZoom=!1,this.refresh()}},mimic:function(a,c){var d=this;if(!c)throw"mimic must be called with at least one event mask";c.zoom?a.addListener("zoom",function(a){d.inZoom||d.zoom({x:a.xmin,y:a.ymin},{x:a.xmax,y:a.ymax},a.inContinuousZoom)}):c.xzoom?a.addListener("zoom",function(a){d.inZoom||d.zoom({x:a.xmin,y:void 0},{x:a.xmax,y:void 0},a.inContinuousZoom)}):c.yzoom&&a.addListener("zoom",function(a){d.inZoom||d.zoom({x:void 0,y:a.ymin},{x:void 0,y:a.ymax},a.inContinuousZoom)}),c.unzoom&&a.addListener("unzoom",function(a){d.inZoom||a.level<d._Mx.level&&d.unzoom(d._Mx.level-a.level)}),(c.pan||c.xpan)&&a.addListener("xpan",function(a){d.inPan||q(d,a.xmin,a.xmax,"X")}),(c.pan||c.ypan)&&a.addListener("ypan",function(a){d.inPan||q(d,a.ymin,a.ymax,"Y")})},redraw:function(){var a=this._Gx,c=this._Mx,d=c.canvas.getContext("2d");a.plotData.valid?(d.drawImage(a.plotData,c.l-1,c.t-1,c.r-c.l+2,c.b-c.t+2,c.l-1,c.t-1,c.r-c.l+2,c.b-c.t+2),F(this),a.cross_xpos=void 0,a.cross_ypos=void 0,D(this),(a.always_show_marker||a.show_marker)&&A(this)):this.refresh()},refresh:function(){var c=this;a.render(this._Mx,function(){c._refresh()})},enable_listeners:function(){var c=this._Mx;a.addEventListener(c,"mousedown",this.onmousedown,!1),a.addEventListener(c,"mousemove",this.throttledOnMouseMove,!1),document.addEventListener("mouseup",this.docMouseUp,!1),a.addEventListener(c,"mouseup",this.mouseup,!1),window.addEventListener("mousedown",this.dragMouseDownHandler,!1),window.addEventListener("mousemove",this.throttledDragOnMouseMove,!1),window.addEventListener("mouseup",this.dragMouseUpHandler,!1),window.addEventListener("wheel",this.wheelHandler,!1),window.addEventListener("mousewheel",this.wheelHandler,!1),window.addEventListener("DOMMouseScroll",this.wheelHandler,!1),window.addEventListener("keypress",this.onkeypress,!1)},disable_listeners:function(){var c=this._Mx;a.removeEventListener(c,"mousedown",this.onmousedown,!1),a.removeEventListener(c,"mousemove",this.throttledOnMouseMove,!1),document.removeEventListener("mouseup",this.docMouseUp,!1),a.removeEventListener(c,"mouseup",this.mouseup,!1),window.removeEventListener("mousedown",this.dragMouseDownHandler,!1),window.removeEventListener("mousemove",this.throttledDragOnMouseMove,!1),window.removeEventListener("mouseup",this.dragMouseUpHandler,!1),window.removeEventListener("wheel",this.wheelHandler,!1),window.removeEventListener("mousewheel",this.wheelHandler,!1),window.removeEventListener("DOMMouseScroll",this.wheelHandler,!1),window.removeEventListener("keypress",this.onkeypress,!1)},checkresize:function(){a.checkresize(this._Mx)&&this.refresh()},_refresh:function(){var d=this._Mx,e=this._Gx;if(d.canvas.getContext("2d"),!e.hold){a.set_font(d,Math.min(8,d.width/64)),e.pthk=1.5*d.text_w,e.specs?(d.l=!0===e.show_y_axis?6*d.text_w:1,d.r=!0===e.pan?d.width-(e.pthk+2*d.text_w):d.width-2,e.show_readout?(d.t=2*d.text_h,d.b=e.show_x_axis?d.height-4*d.text_h:d.height-3*d.text_h):(d.t=e.pan?e.pthk+2*d.text_w:1,d.b=e.show_x_axis?d.height-3*d.text_h/2:d.height-2),e.pl=e.show_readout?50*d.text_w:35*d.text_w,e.pr=Math.max(e.pl+9*d.text_w,d.r),e.pt=e.show_readout?e.show_x_axis?d.b+d.text_h+(d.height-d.b-d.text_h-e.pthk)/2:d.b+(d.height-d.b-e.pthk)/2:(d.t-e.pthk)/2,e.lbtn=d.text_h+d.text_w+2):(e.pan?(d.t=e.pthk+2*d.text_w,d.r=d.width-(e.pthk+d.text_w)):(d.t=1,d.r=d.width-2),d.b=d.height-2,d.l=1,e.pl=d.l,e.pr=d.r,e.pt=(d.t-e.pthk)/2,e.lbtn=0),e.pyl=d.r+(d.width-d.r-e.pthk)/2+1;var f=d.level;d.stk[f].x1=d.l,d.stk[f].y1=d.t,d.stk[f].x2=d.r,d.stk[f].y2=d.b,d.stk[f].xscl=(d.stk[f].xmax-d.stk[f].xmin)/(d.r-d.l),d.stk[f].yscl=(d.stk[f].ymax-d.stk[f].ymin)/(d.b-d.t),f=T(this,d.xpos,d.ypos),e.retx=f.x,e.rety=f.y,(0===e.panning||0!==e.panning)&&(e.plotData.valid=!1,a.clear_window(d));var f=e.xlab,g=e.ylab;if(void 0===f&&(f=30),e.index&&(f=0),void 0===g&&(g=0<e.lyr.length&&e.lyr[0].cx,1===e.cmode?g=28:2===e.cmode?g=e.plab:3===e.cmode&&g?g=21:4===e.cmode?g=22:5===e.cmode?(g=22,f=21):g=6===e.cmode?26:7===e.cmode?27:0),e.specs){if(0===e.sections){var h={grid:e.grid};2===e.panning&&(h.noxtlab=!0),e.show_x_axis||(h.noxtics=!0,h.noxtlab=!0,h.noxplab=!0),e.show_y_axis||(h.noytics=!0,h.noytlab=!0,h.noyplab=!0),!e.specs||e.show_readout||e.pan||(h.noyplab=!0,h.noxplab=!0),e.gridBackground&&(h.fillStyle=e.gridBackground),e.gridStyle&&(h.gridStyle=e.gridStyle),e.xmult&&(h.xmult=e.xmult),e.ymult&&(h.ymult=e.ymult),a.drawaxis(d,e.xdiv,e.ydiv,f,g,h)}f=e.lbtn-2,e.show_readout&&e.pan?(e.legend?(e.legendBtnLocation={x:d.width-e.lbtn,y:2,width:f,height:f},a.shadowbox(d,d.width-e.lbtn,2,f,f,1,-2,"L")):(e.legendBtnLocation={x:d.width-e.lbtn,y:2,width:f,height:f},a.shadowbox(d,d.width-e.lbtn,2,f,f,1,2,"L")),N(this)):e.legendBtnLocation=null}else e.grid&&0<=e.sections&&(h={grid:!0,noaxisbox:!0,noxtics:!0,noxtlab:!0,noxplab:!0,noytics:!0,noytlab:!0,noyplab:!0},a.drawaxis(d,e.xdiv,e.ydiv,f,g,h));for(f=0;f<e.lyr.length;f++)z(this,f);if(f=this._Mx,g=this._Gx,g.show_readout&&!g.hide_note&&a.text(f,f.width-g.lbtn-(g.note.length+1)*f.text_w,f.text_h,g.note),J(this),g.legend){for(var f=this._Mx,g=this._Gx,h=f.canvas.getContext("2d"),k=0,l=0,n=0,q=0,t=0,v=0,w=0,x=k=0,y=0,q=f.text_w,w=23*q,k=(g.lyr.length+1)*f.text_h,t=f.r-w,v=f.t,l=t+2,n=v+2,x=w-5,y=k-5,B=0,k=w=0;k<g.lyr.length;k++){var C=h.measureText(g.lyr[k].name).width;C>B&&(B=C)}for(B>98&&(w=B-98,x+=w,l-=w),h.strokeStyle=f.fg,h.fillStyle=f.bg,h.fillRect(l,n,x,y),h.strokeRect(l,n,x,y),k=0;k<g.lyr.length;k++)l=t+4*q,n=v+k*f.text_h+f.text_h,k===g.modlayer&&a.text(f,t+q-w,n+Math.floor(f.text_w/2),"**"),g.lyr[k].display&&(y=g.lyr[k].color,0<g.lyr[k].line&&(x=c.sign(Math.min(q,Math.abs(g.lyr[k].thick)),g.lyr[k].thick),0>x||x===a.L_dashed?a.draw_line(f,y,l-w,n-3,l+2*q-w,n-3,Math.abs(x),{mode:"dashed",on:4,off:4}):a.draw_line(f,y,l-w,n-3,l+2*q-w,n-3,Math.abs(x))),0<g.lyr[k].symbol&&(x=0>g.lyr[k].radius?-c.trunc(.6*q):Math.min(g.lyr[k].radius,c.trunc(.6*q)),a.draw_symbol(f,y,l+q-w,n-3,g.lyr[k].symbol,x))),l+=3*q,n+=.3*f.text_h,a.text(f,l-w,n,g.lyr[k].name)}d.r>d.l&&d.b>d.t&&(e.plotData.width=d.canvas.width,e.plotData.height=d.canvas.height,e.plotData.getContext("2d").drawImage(d.canvas,0,0),e.plotData.valid=!0),F(this),e.cross_xpos=void 0,e.cross_ypos=void 0,D(this),(e.always_show_marker||e.show_marker)&&A(this)}}};var X={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},Y="Ma Ph Re Im IR Lo L2".split(" "),v=["(absc)","(indx)","(1/ab)","(dydx)"]}(window.sigplot,window.mx,window.m),/**
 * @license
 * File: sigplot.playback.js
 *
 * Copyright (c) 2012-2014, Michael Ihde, All rights reserved.
 * Copyright (c) 2012-2014, Axios Inc., All rights reserved.
 *
 * This file is part of SigPlot.
 *
 * SigPlot is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation; either version 3.0 of the License, or
 * (at your option) any later version. This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
 * PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the
 * GNU Lesser General Public License along with SigPlot.
 */
function(sigplot,mx,m,undefined){sigplot.ButtonPlugin=function(options){this.options=options===undefined?{}:options,this.options.display===undefined&&(this.options.display=!0),this.options.size=this.options.size||25,this.options.lineWidth=this.options.lineWidth||2,this.options.direction=this.options.direction||"left",this.highlight=!1,this.enabled=!0},sigplot.ButtonPlugin.prototype={disabledStyle:"rgb(70,70,70)",init:function(plot){this.plot=plot;var self=this,Mx=this.plot._Mx;this.onmousemove=function(evt){Mx.warpbox||self.set_highlight(self.ismouseover(evt.xpos,evt.ypos)&&self.enabled?!0:!1)},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(evt){Mx.warpbox||self.ismouseover(evt.xpos,evt.ypos)&&self.enabled&&evt.preventDefault()},this.plot.addListener("mdown",this.onmousedown),this.onmouseclick=function(evt){Mx.warpbox||self.ismouseover(evt.xpos,evt.ypos)&&self.enabled&&(self.select(),evt.preventDefault())},this.plot.addListener("mclick",this.onmouseclick)},set_highlight:function(ishighlight){ishighlight!==this.highlight&&(this.highlight=ishighlight,this.plot.redraw())},select:function(){if(this.plot&&this.enabled){var Mx=this.plot._Mx,evt=document.createEvent("Event");this.options.id&&(evt.id=this.options.id),evt.initEvent("selectevt",!0,!0),mx.dispatchEvent(Mx,evt)}},addListener:function(what,callback){var Mx=this.plot._Mx;mx.addEventListener(Mx,what,callback,!1)},removeListener:function(what,callback){var Mx=this.plot._Mx;mx.removeEventListener(Mx,what,callback,!1)},ismouseover:function(xpos,ypos){var position=this.position(),distance_from_ctr=Math.pow(xpos-position.x,2)+Math.pow(ypos-position.y,2),R=this.options.size/2;return distance_from_ctr<Math.pow(R,2)},position:function(){if(this.options.position)return this.options.position;if(this.plot){var Mx=this.plot._Mx,R=this.options.size/2;return{x:Mx.l+R+this.options.lineWidth+1,y:Mx.t+R+this.options.lineWidth+1}}return{x:null,y:null}},bounds:function(){var bounds={},size=this.options.size;return bounds.x=this.position().x-size/2,bounds.y=this.position().y-size/2,bounds.width=bounds.height=size+3,bounds},refresh:function(canvas){if(this.options.display){var Mx=(this.plot._Gx,this.plot._Mx),ctx=canvas.getContext("2d");ctx.lineWidth=this.options.lineWidth;var R=this.options.size/2;this.highlight&&(ctx.lineWidth+=2,R+=1);var position=this.position();ctx.beginPath(),ctx.arc(position.x,position.y,R-ctx.lineWidth,0,2*Math.PI,!0),ctx.closePath(),ctx.strokeStyle=this.enabled?this.options.strokeStyle||Mx.fg:this.disabledStyle,ctx.stroke(),this.options.fillStyle&&(ctx.fillStyle=this.options.fillStyle,ctx.fill());var p1,p2,p3;"right"===this.options.direction?(p1={x:.8*R,y:.56*R},p2={x:1.45*R,y:R},p3={x:.8*R,y:1.45*R}):"left"===this.options.direction&&(p1={x:2*R-.8*R,y:.56*R},p2={x:2*R-1.45*R,y:R},p3={x:2*R-.8*R,y:1.45*R}),p1.x+=position.x-R,p2.x+=position.x-R,p3.x+=position.x-R,p1.y+=position.y-R,p2.y+=position.y-R,p3.y+=position.y-R,ctx.beginPath(),ctx.moveTo(p1.x,p1.y),ctx.lineTo(p2.x,p2.y),ctx.lineTo(p3.x,p3.y),ctx.closePath(),ctx.fillStyle=this.enabled?this.options.strokeStyle||Mx.fg:this.disabledStyle,ctx.fill(),ctx.restore()}},setEnabled:function(enable){this.enabled=enable},isEnabled:function(){return this.enabled},dispose:function(){this.plot=undefined,this.boxes=undefined}}}(window.sigplot=window.sigplot||{},mx,m),function(l,g,r,d){l.AnnotationPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.options.textBaseline=this.options.textBaseline||"alphabetic",this.options.textAlign=this.options.textAlign||"left",this.annotations=[]},l.AnnotationPlugin.prototype={init:function(a){var c=this;this.plot=a;var b=this.plot._Mx;this.onmousemove=function(a){if(0!==c.annotations.length&&!c.options.prevent_hover)if(a.xpos<b.l||a.xpos>b.r)c.set_highlight(!1);else if(a.ypos>b.b||a.ypos<b.t)c.set_highlight(!1);else{for(var h=!1,e=0;e<c.annotations.length;e++){var f=c.annotations[e],n=d,p=d;f.absolute_placement&&(n=f.x,p=f.y),f.pxl_x!==d&&(n=f.pxl_x),f.pxl_y!==d&&(p=f.pxl_y);var l=g.real_to_pixel(b,f.x,f.y);n===d&&(n=l.x),p===d&&(p=l.y);var l=n,q=p;f.value instanceof HTMLImageElement||f.value instanceof HTMLCanvasElement||f.value instanceof HTMLVideoElement?(l-=f.width/2,q-=f.height/2):q-=f.height,g.inrect(a.xpos,a.ypos,l,q,f.width,f.height)?f.highlight||(c.set_highlight(!0,[f],n,p),h=!0):(f.highlight&&(c.set_highlight(!1,[f]),h=!0),f.selected=d)}c.plot&&h&&c.plot.refresh()}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(b){for(b=0;b<c.annotations.length;b++)c.annotations[b].highlight&&(c.annotations[b].selected=!0)},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(b){for(var a=0;a<c.annotations.length;a++)c.annotations[a].selected&&(b=document.createEvent("Event"),b.initEvent("annotationclick",!0,!0),b.annotation=c.annotations[a],g.dispatchEvent(c.plot._Mx,b)&&c.annotations[a].onclick)&&c.annotations[a].onclick(),c.annotations[a].selected=d},document.addEventListener("mouseup",this.onmouseup,!1)},set_highlight:function(a,c,b,k){c=c||this.annotations;for(var d=0;d<c.length;d++){var e=document.createEvent("Event");e.initEvent("annotationhighlight",!0,!0),e.annotation=c[d],e.state=a,e.x=b,e.y=k,g.dispatchEvent(this.plot._Mx,e)&&(c[d].highlight=a)}},menu:function(){var a=function(b){return function(){b.options.display=!b.options.display,b.plot.redraw()}}(this),c=function(b){return function(){b.annotations=[],b.plot.redraw()}}(this);return{text:"Annotations...",menu:{title:"ANNOTATIONS",items:[{text:"Display",checked:this.options.display,style:"checkbox",handler:a},{text:"Clear All",handler:c}]}}},add_annotation:function(a){return this.annotations.push(a),this.plot.redraw(),this.annotations.length},clear_annotations:function(){this.annotations=[],this.plot.redraw()},refresh:function(a){if(this.options.display){var c=this.plot._Mx,b=a.getContext("2d"),k=this;b.save(),b.beginPath(),b.rect(c.l,c.t,c.r-c.l,c.b-c.t),b.clip(),g.onCanvas(c,a,function(){for(var a=k.annotations.length-1;a>=0;a--){var e=k.annotations[a],f=d,n=d;e.absolute_placement&&(f=e.x,n=e.y),e.pxl_x!==d&&(f=e.pxl_x),e.pxl_y!==d&&(n=e.pxl_y);var l=g.real_to_pixel(c,e.x,e.y);f===d&&(f=l.x),n===d&&(n=l.y),g.inrect(f,n,c.l,c.t,c.r-c.l,c.b-c.t)&&(e.value instanceof HTMLImageElement||e.value instanceof HTMLCanvasElement||e.value instanceof HTMLVideoElement?(e.width=e.value.width,e.height=e.value.height,b.drawImage(e.value,f-e.width/2,n-e.height/2)):(b.font=e.font||"bold italic 20px new century schoolbook",b.fillStyle=e.highlight?e.highlight_color||c.hi:e.color||c.fg,b.globalAlpha=1,e.width=b.measureText(e.value).width,e.height=b.measureText("M").width,b.textBaseline=e.textBaseline||k.options.textBaseline,b.textAlign=e.textAlign||k.options.textAlign,b.fillText(e.value,f,n)),e.highlight&&e.popup&&g.render_message_box(c,e.popup,f+5,n+5))}}),b.restore()}},dispose:function(){this.annotations=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(l,g,r,d){l.SliderPlugin=function(a){this.options=a!==d?a:{},this.options.display===d&&(this.options.display=!0),this.options.style===d&&(this.options.style={}),this.options.direction===d&&(this.options.direction="vertical"),this.paired_slider=this.location=this.position=d},l.SliderPlugin.prototype={init:function(a){this.plot=a;var c=a._Mx,b=this;this.onmousemove=function(a){if(b.location!==d&&!b.options.prevent_drag)if(a.xpos<c.l||a.xpos>c.r)b.set_highlight(!1);else if(a.ypos>c.b||a.ypos<c.t)b.set_highlight(!1);else{var h=b.options.style.lineWidth!==d?b.options.style.lineWidth:1;b.dragging?(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?(b.location=a.xpos,b.position=h.x):"horizontal"===b.options.direction?(b.location=a.ypos,b.position=h.y):"both"===b.options.direction&&(b.location.x=a.xpos,b.position.x=h.x,b.location.y=a.ypos,b.position.y=h.y),b.plot.redraw(),a.preventDefault()):c.warpbox||("vertical"===b.options.direction?b.set_highlight(Math.abs(b.location-a.xpos)<h+5?!0:!1):"horizontal"===b.options.direction?b.set_highlight(Math.abs(b.location-a.ypos)<h+5?!0:!1):"both"===b.options.direction&&b.set_highlight(Math.abs(b.location.x-a.xpos)<h+5&&Math.abs(b.location.y-a.ypos)<h+5?!0:!1))}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){if(b.location!==d&&!(b.options.prevent_drag||a.xpos<c.l||a.xpos>c.r||a.ypos>c.b||a.ypos<c.t||a.slider_drag)){var h=b.options.style.lineWidth!==d?b.options.style.lineWidth:1;"vertical"===b.options.direction?Math.abs(b.location-a.xpos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault()):"horizontal"===b.options.direction?Math.abs(b.location-a.ypos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault()):"both"===b.options.direction&&Math.abs(b.location.x-a.xpos)<h+5&&Math.abs(b.location.y-a.ypos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault())}},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(a){b.dragging&&(b.dragging=!1,a=document.createEvent("Event"),a.source=b,a.initEvent("slidertag",!0,!0),"both"===b.options.direction?(a.location=b.location?JSON.parse(JSON.stringify(b.location)):d,a.position=b.position?JSON.parse(JSON.stringify(b.position)):d):(a.location=b.location,a.position=b.position),g.dispatchEvent(c,a),a=document.createEvent("Event"),a.initEvent("sliderdrag",!0,!0),"both"===b.options.direction?(a.location=b.location?JSON.parse(JSON.stringify(b.location)):d,a.position=b.position?JSON.parse(JSON.stringify(b.position)):d):(a.location=b.location,a.position=b.position),g.dispatchEvent(c,a))},document.addEventListener("mouseup",this.onmouseup,!1)},addListener:function(a,c){var b=this;g.addEventListener(this.plot._Mx,a,function(a){return a.source===b?c(a):void 0},!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},pair:function(a){if(a){if(a.direction!==this.direction)throw"paired sliders must use the same direction setting";this.paired_slider=a}else this.paired_slider=null},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},set_position:function(a){if(!this.dragging){if("both"===this.options.direction){if(this.position!==d&&this.position.x===a.x&&this.position.y===a.y)return}else if(this.position===a)return;this.set_highlight(!1);var c=this.plot._Mx;this.position="both"===this.options.direction?a?JSON.parse(JSON.stringify(a)):d:a,a="both"===this.options.direction?g.real_to_pixel(c,this.position.x,this.position.y):g.real_to_pixel(c,this.position,this.position),"vertical"===this.options.direction?this.location=a.x:"horizontal"===this.options.direction?this.location=a.y:"both"===this.options.direction&&(this.location={x:a.x,y:a.y}),a=document.createEvent("Event"),a.initEvent("slidertag",!0,!0),"both"===this.options.direction?(a.location=this.location?JSON.parse(JSON.stringify(this.location)):d,a.position=this.position?JSON.parse(JSON.stringify(this.position)):d):(a.location=this.location,a.position=this.position),g.dispatchEvent(c,a),this.plot.redraw()}},set_location:function(a){if(!this.dragging){if("both"===this.options.direction){if(this.location!==d&&this.location.x===a.x&&this.location.y===a.y)return}else if(this.location===a)return;this.set_highlight(!1);var c=this.plot._Mx;this.location="both"===this.options.direction?a?JSON.parse(JSON.stringify(a)):d:a,a="both"===this.options.direction?g.pixel_to_real(c,a.x,a.y):g.pixel_to_real(c,a,a),"vertical"===this.options.direction?this.position=a.x:"horizontal"===this.options.direction?this.position=a.y:"both"===this.options.direction&&(this.position={x:a.x,y:a.y}),a=document.createEvent("Event"),a.initEvent("slidertag",!0,!0),"both"===this.options.direction?(a.location=this.location?JSON.parse(JSON.stringify(this.location)):d,a.position=this.position?JSON.parse(JSON.stringify(this.position)):d):(a.location=this.location,a.position=this.position),g.dispatchEvent(c,a),this.plot.redraw()}},get_position:function(){return this.position},get_location:function(){return this.location},refresh:function(a){if(this.options.display&&this.position!==d){var c=this.plot._Mx;a=a.getContext("2d"),a.lineWidth=this.options.style.lineWidth!==d?this.options.style.lineWidth:1,a.lineCap=this.options.style.lineCap!==d?this.options.style.lineCap:"square",a.strokeStyle=this.options.style.strokeStyle!==d?this.options.style.strokeStyle:c.fg,(this.dragging||this.highlight)&&(a.lineWidth=Math.ceil(1.2*a.lineWidth));var b;if(b="both"===this.options.direction?g.real_to_pixel(c,this.position.x,this.position.y):g.real_to_pixel(c,this.position,this.position),"vertical"===this.options.direction){if(b.x<c.l||b.x>c.r)return;this.location=b.x}else if("horizontal"===this.options.direction){if(b.y<c.t||b.y>c.b)return;this.location=b.y}else if("both"===this.options.direction){if(b.x<c.l||b.x>c.r||b.y<c.t||b.y>c.b)return;this.location.x=b.x,this.location.y=b.y}if("vertical"===this.options.direction?(a.beginPath(),a.moveTo(this.location+.5,c.t),a.lineTo(this.location+.5,c.b),a.stroke()):"horizontal"===this.options.direction?(a.beginPath(),a.moveTo(c.l,this.location+.5),a.lineTo(c.r,this.location+.5),a.stroke()):"both"===this.options.direction&&(a.beginPath(),a.moveTo(c.l,this.location.y+.5),a.lineTo(c.r,this.location.y+.5),a.closePath(),a.moveTo(this.location.x+.5,c.t),a.lineTo(this.location.x+.5,c.b),a.stroke()),this.dragging||this.highlight){if("vertical"===this.options.direction){a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(this.position,6,3,!0).trim();var k=a.measureText(b).width;this.location+5+k>c.r?(a.textAlign="right",a.fillText(b,this.location-5,c.t+10)):a.fillText(b,this.location+5,c.t+10)}else"horizontal"===this.options.direction&&(a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(this.position,6,3,!0).trim(),this.location-c.text_h-5>c.t?a.fillText(b,c.l+10,this.location-5):a.fillText(b,c.l+10,this.location+5+c.text_h));if(this.paired_slider)if("vertical"===this.options.direction){b=this.position-this.paired_slider.position;var k=this.location-this.paired_slider.location,h=c.t+Math.round((c.b-c.t)/2);g.textline(c,this.location,h,this.paired_slider.location,h,{mode:"dashed",on:3,off:3}),a.textBaseline="alphabetic",a.textAlign="center",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(b,6,3,!0),a.fillText(b,this.location-Math.round(k/2),h-5)}else"horizontal"===this.options.direction&&(b=this.position-this.paired_slider.position,k=this.location-this.paired_slider.location,h=c.l+Math.round((c.r-c.l)/2),g.textline(c,h,this.location,h,this.paired_slider.location,{mode:"dashed",on:3,off:3}),a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(b,6,3,!0),a.fillText(b,h+5,this.location-Math.round(k/2)))}}},dispose:function(){this.plot.removeListener("mmove",this.onmousemove),document.removeEventListener("mouseup",this.onmouseup,!1),this.position=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(l,g,r,d){l.AccordionPlugin=function(a){this.options=a!==d?a:{},this.options.display===d&&(this.options.display=!0),this.options.center_line_style===d&&(this.options.center_line_style={}),this.options.edge_line_style===d&&(this.options.edge_line_style={}),this.options.fill_style===d&&(this.options.fill_style={}),this.options.direction===d&&(this.options.direction="vertical"),this.options.mode===d&&(this.options.mode="absolute"),this.loc_2=this.loc_1=this.center_location=this.width=this.center=d,this.visible=!0},l.AccordionPlugin.prototype={init:function(a){this.plot=a;var c=this.plot._Mx,b=this;this.onmousemove=function(a){if(b.center_location!==d&&!b.options.prevent_drag)if(a.xpos<c.l||a.xpos>c.r)b.set_highlight(!1);else if(a.ypos>c.b||a.ypos<c.t)b.set_highlight(!1);else{var h=b.options.center_line_style.lineWidth!==d?b.options.center_line_style.lineWidth:1,e=b.options.edge_line_style.lineWidth!==d?b.options.edge_line_style.lineWidth:1;b.dragging||b.edge_dragging?(b.dragging&&(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?(b.center_location=a.xpos,"absolute"===b.options.mode?b.center=h.x:"relative"===b.options.mode&&(b.center=(a.xpos-c.l)/(c.r-c.l))):"horizontal"===b.options.direction&&(b.center_location=a.ypos,"absolute"===b.options.mode?b.center=h.y:"relative"===b.options.mode&&(b.center=(a.ypos-c.t)/(c.b-c.t)))),b.edge_dragging&&(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?"absolute"===b.options.mode?b.width=2*Math.abs(b.center-h.x):"relative"===b.options.mode&&(b.width=2*Math.abs(b.center_location-a.xpos)/(c.r-c.l)):"horizontal"===b.options.direction&&("absolute"===b.options.mode?b.width=2*Math.abs(b.center-h.y):"relative"===b.options.mode&&(b.width=2*Math.abs(b.center_location-a.ypos)/(c.b-c.t)))),b.plot&&b.plot.refresh(),a.preventDefault()):c.warpbox||("vertical"===b.options.direction?(b.set_highlight(Math.abs(b.center_location-a.xpos)<h+5?!0:!1),b.set_edge_highlight(Math.abs(b.loc_1-a.xpos)<e+5||Math.abs(b.loc_2-a.xpos)<e+5?!0:!1)):"horizontal"===b.options.direction&&(b.set_highlight(Math.abs(b.center_location-a.ypos)<h+5?!0:!1),b.set_edge_highlight(Math.abs(b.loc_1-a.ypos)<e+5||Math.abs(b.loc_2-a.ypos)<e+5?!0:!1)))}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){if(b.center_location!==d&&!(a.xpos<c.l||a.xpos>c.r||a.ypos>c.b||a.ypos<c.t)){var h=b.options.center_line_style.lineWidth!==d?b.options.center_line_style.lineWidth:1,e=b.options.edge_line_style.lineWidth!==d?b.options.edge_line_style.lineWidth:1;"vertical"===b.options.direction?Math.abs(b.loc_1-a.xpos)<e+5||Math.abs(b.loc_2-a.xpos)<e+5?(b.edge_dragging=!0,a.preventDefault()):Math.abs(b.center_location-a.xpos)<h+5&&(b.dragging=!0,a.preventDefault()):"horizontal"===b.options.direction&&(Math.abs(b.loc_1-a.ypos)<e+5||Math.abs(b.loc_2-a.ypos)<e+5?(b.edge_dragging=!0,a.preventDefault()):Math.abs(b.center_location-a.ypos)<h+5&&(b.dragging=!0,a.preventDefault()))}},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(a){b.dragging=!1,b.edge_dragging=!1,a=document.createEvent("Event"),a.initEvent("accordiontag",!0,!0),a.center=b.center,a.width=b.width,g.dispatchEvent(c,a)},document.addEventListener("mouseup",this.onmouseup,!1)},addListener:function(a,c){g.addEventListener(this.plot._Mx,a,c,!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},set_edge_highlight:function(a){a!==this.edge_highlight&&(this.edge_highlight=a,this.plot.redraw())},set_center:function(a){if(this.center=a,this.plot){a=this.plot._Mx;var c=document.createEvent("Event");c.initEvent("accordiontag",!0,!0),c.center=this.center,c.width=this.width,g.dispatchEvent(a,c),this.plot.redraw()}},set_width:function(a){if(this.width=a,this.plot){a=this.plot._Mx;var c=document.createEvent("Event");c.initEvent("accordiontag",!0,!0),c.center=this.center,c.width=this.width,g.dispatchEvent(a,c),this.plot.redraw()}},get_center:function(){return this.center},get_width:function(){return this.width},refresh:function(a){if(this.plot&&this.visible&&this.options.display&&this.center!==d&&this.width!==d){var c=this.plot._Mx,b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);var k;"absolute"===this.options.mode?k=g.real_to_pixel(c,this.center,this.center):"relative"===this.options.mode&&("vertical"===this.options.direction?(k=c.stk[0].x1+(c.stk[0].x2-c.stk[0].x1)*this.center,k=g.real_to_pixel(c,g.pixel_to_real(c,k,k).x,g.pixel_to_real(c,k,k).y)):"horizontal"===this.options.direction&&(k=c.stk[0].y1+(c.stk[0].y2-c.stk[0].y1)*this.center,k=g.real_to_pixel(c,g.pixel_to_real(c,k,k).x,g.pixel_to_real(c,k,k).y)));var h,e;"absolute"===this.options.mode?(h=g.real_to_pixel(c,this.center-this.width/2,this.center-this.width/2),e=g.real_to_pixel(c,this.center+this.width/2,this.center+this.width/2)):"relative"===this.options.mode&&(e=c.stk[0].x2-c.stk[0].x1,a=c.stk[0].y2-c.stk[0].y1,h={x:k.x-this.width*e/2,y:k.y-this.width*a/2},e={x:k.x+this.width*e/2,y:k.y+this.width*a/2}),"vertical"===this.options.direction?(this.center_location=k.x,this.loc_1=Math.max(c.l,h.x),this.loc_2=Math.min(c.r,e.x)):"horizontal"===this.options.direction&&(this.center_location=k.y,this.loc_1=Math.max(c.t,e.y),this.loc_2=Math.min(c.b,h.y)),this.options.shade_area&&0<Math.abs(this.loc_2-this.loc_1)&&(h=b.globalAlpha,b.globalAlpha=this.options.fill_style.opacity!==d?this.options.fill_style.opacity:.4,b.fillStyle=this.options.fill_style.fillStyle!==d?this.options.fill_style.fillStyle:c.hi,"vertical"===this.options.direction?b.fillRect(this.loc_1,c.t,this.loc_2-this.loc_1,c.b-c.t):"horizontal"===this.options.direction&&b.fillRect(c.l,this.loc_1,c.r-c.l,this.loc_2-this.loc_1),b.globalAlpha=h),(this.options.draw_edge_lines||this.edge_highlight||this.edge_dragging)&&(b.lineWidth=this.options.edge_line_style.lineWidth!==d?this.options.edge_line_style.lineWidth:1,b.lineCap=this.options.edge_line_style.lineCap!==d?this.options.edge_line_style.lineCap:"square",b.strokeStyle=this.options.edge_line_style.strokeStyle!==d?this.options.edge_line_style.strokeStyle:c.fg,(this.edge_dragging||this.edge_highlight)&&(b.lineWidth=Math.ceil(1.2*b.lineWidth)),"vertical"===this.options.direction?(b.beginPath(),b.moveTo(this.loc_1+.5,c.t),b.lineTo(this.loc_1+.5,c.b),b.stroke(),b.beginPath(),b.moveTo(this.loc_2+.5,c.t),b.lineTo(this.loc_2+.5,c.b),b.stroke()):"horizontal"===this.options.direction&&(b.beginPath(),b.moveTo(c.l,this.loc_1+.5),b.lineTo(c.r,this.loc_1+.5),b.stroke(),b.beginPath(),b.moveTo(c.l,this.loc_2+.5),b.lineTo(c.r,this.loc_2+.5),b.stroke())),this.options.draw_center_line&&(b.lineWidth=this.options.center_line_style.lineWidth!==d?this.options.center_line_style.lineWidth:1,b.lineCap=this.options.center_line_style.lineCap!==d?this.options.center_line_style.lineCap:"square",b.strokeStyle=this.options.center_line_style.strokeStyle!==d?this.options.center_line_style.strokeStyle:c.fg,(this.dragging||this.highlight)&&(b.lineWidth=Math.ceil(1.2*b.lineWidth)),"vertical"===this.options.direction?(b.beginPath(),b.moveTo(this.center_location+.5,c.t),b.lineTo(this.center_location+.5,c.b),b.stroke()):"horizontal"===this.options.direction&&(b.beginPath(),b.moveTo(c.l,this.center_location+.5),b.lineTo(c.r,this.center_location+.5),b.stroke()))}},set_visible:function(a){this.visible=a,this.plot.redraw()},set_mode:function(a){this.options.mode=a},dispose:function(){this.width=this.center_location=this.center=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(l,g,r,d){l.BoxesPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.boxes=[]},l.BoxesPlugin.prototype={init:function(a){this.plot=a},menu:function(){var a=function(a){return function(){a.options.display=!a.options.display,a.plot.redraw()}}(this),c=function(a){return function(){a.boxes=[],a.plot.redraw()}}(this);return{text:"Annotations...",menu:{title:"ANNOTATIONS",items:[{text:"Display",checked:this.options.display,style:"checkbox",handler:a},{text:"Clear All",handler:c}]}}},add_box:function(a){return this.boxes.push(a),this.plot.redraw(),this.boxes.length},refresh:function(a){if(this.options.display){var c=this.plot._Mx;a=a.getContext("2d");var b,d,h,e,f,n;a.save(),a.beginPath(),a.rect(c.l,c.t,c.r-c.l,c.b-c.t),a.clip();for(var l=0;l<this.boxes.length;l++)b=this.boxes[l],!0===b.absolute_placement?(d=b.x+c.l,h=b.y+c.t,e=b.w,f=b.h):(f=g.real_to_pixel(c,b.x,b.y),n=g.real_to_pixel(c,b.x+b.w,b.y+b.h),d=f.x,h=f.y,e=n.x-f.x,f=f.y-n.y),a.strokeStyle=b.strokeStyle||c.fg,a.lineWidth=b.lineWidth||1,1===a.lineWidth%2&&(d+=.5,h+=.5),a.strokeRect(d,h,e,f),b.text&&(a.save(),a.font=b.font||c.text_H+"px Courier New, monospace",a.globalAlpha=1,a.textAlign="end",a.fillStyle=a.strokeStyle,b.font&&(a.font=b.font),d-=c.text_w,h-=c.text_h/3,f=a.measureText(b.text).width,d-f<c.l&&(d+=e),a.fillText(b.text,d,h),a.restore());a.restore()}},dispose:function(){this.boxes=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(l,g,r,d){l.PlaybackControlsPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.options.size=this.options.size||25,this.options.lineWidth=this.options.lineWidth||2,this.state="paused",this.highlight=!1},l.PlaybackControlsPlugin.prototype={init:function(a){this.plot=a;var c=this,b=this.plot._Mx;this.onmousemove=function(a){b.warpbox||c.set_highlight(c.ismouseover(a.xpos,a.ypos)?!0:!1)},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){b.warpbox||c.ismouseover(a.xpos,a.ypos)&&a.preventDefault()},this.plot.addListener("mdown",this.onmousedown),this.onmouseclick=function(a){!b.warpbox&&c.ismouseover(a.xpos,a.ypos)&&(c.toggle(),a.preventDefault())},this.plot.addListener("mclick",this.onmouseclick)},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},toggle:function(a){if(a||(a="paused"===this.state?"playing":"paused"),a!==this.state&&this.plot){var c=this.plot._Mx,b=document.createEvent("Event");b.initEvent("playbackevt",!0,!0),b.state=a,g.dispatchEvent(c,b)&&(this.state=a),this.plot.redraw()}},addListener:function(a,c){g.addEventListener(this.plot._Mx,a,c,!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},ismouseover:function(a,c){var b=this.position();return Math.pow(a-b.x,2)+Math.pow(c-b.y,2)<Math.pow(this.options.size/2,2)},position:function(){if(this.options.position)return this.options.position;if(this.plot){var a=this.plot._Mx,c=this.options.size/2;return{x:a.l+c+this.options.lineWidth+1,y:a.t+c+this.options.lineWidth+1}}return{x:null,y:null}},refresh:function(a){var c,b,d;if(this.options.display){var h=this.plot._Mx,e=a.getContext("2d");e.lineWidth=this.options.lineWidth;var f=this.options.size/2;this.highlight&&(e.lineWidth+=2,f+=1);var g=this.position();if(e.beginPath(),e.arc(g.x,g.y,f-e.lineWidth,0,2*Math.PI,!0),e.closePath(),e.strokeStyle=this.options.strokeStyle||h.fg,e.stroke(),this.options.fillStyle&&(e.fillStyle=this.options.fillStyle,e.fill()),"paused"===this.state){var l;b=.8*f+(g.x-f),a=1.45*f+(g.x-f),l=.8*f+(g.x-f),d=.56*f+(g.y-f),c=f+(g.y-f),f=1.45*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.lineTo(l,f),e.closePath(),e.fillStyle=this.options.strokeStyle||h.fg,e.fill()}else e.lineCap="round",e.lineWidth=Math.floor(Math.min(1,this.options.size/8)),b=.8*f+(g.x-f),a=.8*f+(g.x-f),d=f/2+(g.y-f),c=1.5*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.closePath(),e.stroke(),b=f+f/5+(g.x-f),a=f+f/5+(g.x-f),d=f/2+(g.y-f),c=1.5*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.closePath(),e.stroke();e.restore()}},dispose:function(){this.boxes=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),angular.module("rtl-rest-directives",["rtl-rest"]).directive("deviceStatus",["rtl",function(rtl){return{restrict:"E",scope:{},templateUrl:"components/rtl-rest/templates/device-status.html",link:function(scope){scope.device=rtl.device}}}]),angular.module("rtl-rest",["ngResource","ngAnimate","SubscriptionSocketService"]).service("RTLRest",["$resource",function($resource){var self=this,url="/rtl";self.survey=$resource(url+"/survey",{},{status:{method:"GET"},task:{method:"POST"},halt:{method:"DELETE"}}),self.device=$resource(url+"/device",{},{status:{method:"GET"},configure:{method:"PUT"}})}]).factory("rtl",["RTLRest","RedhawkNotificationService","SubscriptionSocket",function(RTLRest,RedhawkNotificationService,SubscriptionSocket){var notify=RedhawkNotificationService,log={info:function(txt){console.log("INFO:  "+txt)},warn:function(txt){console.log("WARN:  "+txt)},error:function(txt){console.log("ERROR: "+txt)}},rtl={};rtl.processors=[];var Survey=function(){var self=this,frequencyConversion=1e6,defaultFrequency=100.1;self._update=function(data){data.hasOwnProperty("frequency")&&data.frequency&&(data.frequency/=frequencyConversion),angular.extend(self,data)},self._load=function(){RTLRest.survey.status(function(data){data.hasOwnProperty("availableProcessing")&&angular.copy(data.availableProcessing,rtl.processors),self._update(data.status)},function(resp){rtl.connected=!1,log.error("Failed to get survey status "+resp.status+": "+resp.statusText)})},self._reload=function(){self._load()},self.task=function(rf_cf,if_cf,processing){var entity={};return entity.processing=processing,entity.frequency=rf_cf?parseFloat(rf_cf)*frequencyConversion:defaultFrequency*frequencyConversion,entity.demod_if=if_cf?parseFloat(if_cf)*frequencyConversion:parseFloat(0),console.log("REST CALL with entity "+JSON.stringify(entity)),RTLRest.survey.task({},entity,function(data){if(data.success){self._update(data.status);var tuned_freq=data.status.frequency+data.status.demod_if/1e6;notify.success("Successfully tasked to "+tuned_freq+" MHz and "+processing+".","Task"),log.info(JSON.stringify(data))}else log.error(data.error),notify.error(data.error,"Task")},function(resp){log.error(resp.data.error),notify.error(resp.data.error,"Task")})},self.halt=function(){return RTLRest.survey.halt({},{},function(data){data.success?(log.info(JSON.stringify(data)),notify.success("Successfully halted processing","Halt"),self._reload()):(log.error(data.error),notigy.error(data.error,"Halt"))})},self._load()},Device=function(){var self=this;self.setSimulation=function(value){return value==this.simulator?void log.warn("Device simulation is already set to "+value):void RTLRest.device.configure({},{simulation:value},function(){self._reload()},function(data){log.error(data.error+" : "+data.message),notify.error(data.message,data.error)})},self._update=function(data){if("status"in data&&data.status!=self.status){var name=data.type.toUpperCase();"ready"==data.status?notify.success(name+" is ready.","Device"):"unavailable"==data.status?notify.error(name+" is unavailable","Device"):log.warn("Unknown device status of '"+data.status+" for "+name)}angular.extend(self,data)},self._load=function(){RTLRest.device.status(function(data){self._update(data)},function(resp){rtl.connected=!1,log.error("Failed to get device status "+resp.status+": "+resp.statusText)})},self._reload=function(){self._load()},self._load()},Rds=function(){var self=this;self._update=function(rds){rds&&angular.extend(self,rds)}};rtl.connected=!0,rtl.survey=new Survey,rtl.device=new Device,rtl.rds=new Rds,rtl.minDeviceFreq=2399e4,rtl.maxdeviceFreq=9e8,rtl.minSimFreq=8799e4,rtl.maxSimFreq=10801e4;var statusSocket=SubscriptionSocket.createNew();return statusSocket.addJSONListener(function(data){"type"in data&&"body"in data?"device"==data.type?rtl.device._update(data.body):"survey"==data.type?rtl.survey._update(data.body):"rds"==data.type?rtl.rds._update(data.body):log.error("Unhandled Status Notification of type '"+data.type+"'"+JSON.stringify(data.body)):log.error("Status Notification missing 'type' and/or 'body'"+JSON.stringify(data))}),statusSocket.connect("/rtl/status",function(){console.log("Connected to Status")}),rtl}]),angular.module("SubscriptionSocketService",[]).service("SubscriptionSocket",["$rootScope","Modernizr",function($rootScope,Modernizr){var getWSBasePath=function(){var new_uri,loc=window.location;return console.log("location: "+loc),console.log("host: "+loc.host),new_uri="https:"===loc.protocol?"wss:":"ws:",new_uri+="//"+loc.host,console.log("uri: "+new_uri),new_uri},WebSocket=null,doBinary=!1;"WebSocket"in window?(WebSocket=window.WebSocket,doBinary=function(){var protoBin,protocol="https:"==location.protocol?"wss":"ws";if("WebSocket"in window){if(protoBin="binaryType"in WebSocket.prototype)return protoBin;try{return!!new WebSocket(protocol+"://.").binaryType}catch(e){}}return!1}()):"MozWebSocket"in window&&(WebSocket=window.MozWebSocket);var Socket=function(){if(!Modernizr.websockets)return void console.log("ERROR: SubscriptionSocket: Not supported by this browser.");
var self=this;this.callbacks={message:[],json:[],binary:[]},this._call=function(callbacks,data){var scope=this.ws;angular.forEach(callbacks,function(callback){$rootScope.$apply(function(){callback.call(scope,data)})})},this.connect=function(path,callback){console.log("Socket connect: "+path),path.match(/^ws(s?)\:/)||(path=getWSBasePath()+path),self.path=path,self.ws=null,WebSocket&&(self.ws=new WebSocket(path)),self.ws.onopen=function(data){console.log("Socket opened: "+self.path),self.ws.binaryType="arraybuffer",callback.call(this.ws,data)},self.ws.onmessage=function(e){if(self._call(self.callbacks.message),e.data instanceof ArrayBuffer)self._call(self.callbacks.binary,e.data);else{var reg=/:\s?(Infinity|-Infinity|NaN)\s?\,/g,myData=e.data.replace(reg,': "$1", ');self._call(self.callbacks.json,JSON.parse(myData))}}},this.addListener=function(callback){this.callbacks.message.push(callback)},this.addJSONListener=function(callback){this.callbacks.json.push(callback)},this.addBinaryListener=function(callback){doBinary||console.log("WARN:: Socket: Browser does not support binary sockets"),this.callbacks.binary.push(callback)},this.send=function(data){var self=this;self.ws.send(data)},this.close=function(){console.log("Socket closed: "+self.path),self.ws.close()}};return{createNew:function(){return new Socket},isSupported:function(){return Modernizr.websockets},isBinarySupported:function(){return doBinary}}}]),angular.module("rtl-demo-app",["ngRoute","mgcrea.ngStrap","mgcrea.ngStrap.modal","rtl-demo-controllers","rtl-rest","rtl-rest-directives","rtl-plots","redhawk-audio-directives"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/overview",{templateUrl:"views/overview.html",controller:"Overview"}).when("/overview/frequency/:frequency/processing/:processing",{templateUrl:"views/overview.html",controller:"Overview"}).otherwise({redirectTo:"/overview"})}]).constant("Modernizr",Modernizr),angular.module("rtl-demo-controllers",["rtl-rest"]).controller("Overview",["$scope","rtl","$routeParams",function($scope,rtl,$routeParams){$scope.connected=rtl.connected,$scope.survey=rtl.survey,$scope.device=rtl.device,$scope.rds=rtl.rds,$scope.processors=rtl.processors,$scope.audioUrl="/rtl/output/stream",$scope.form={frequency:void 0,processing:void 0},$scope.tuneContext={},$scope.task=function(obj){var if_cf=obj?obj.if_cf:void 0,rf_cf=void 0;rf_cf=obj&&obj.rf_cf?obj.rf_cf:$scope.form.frequency,$scope.survey.task(rf_cf,if_cf,$scope.form.processing)},$scope.halt=function(){$scope.survey.halt()},$scope.toggleSimulator=function(){$scope.device.setSimulation(!$scope.device.simulator)},$routeParams.frequency&&$routeParams.processing&&($scope.form.frequency=$routeParams.frequency,$scope.form.processing=$routeParams.processing,$scope.task()),$scope.doTune=function(rf_cf,if_cf){$scope.form.frequency=((rf_cf?rf_cf:0)+(if_cf?if_cf:0))/1e6;var entity={};rf_cf&&(entity.rf_cf=rf_cf/1e6),if_cf&&(entity.if_cf=if_cf/1e6),$scope.task(entity)},$scope.widebandMode="line",$scope.setWidebandMode=function(mode){$scope.widebandMode=mode},$scope.detailPlotMode="narrowband",$scope.setDetailPlotMode=function(mode){$scope.detailPlotMode=mode},$scope.ready=!0,$scope.$watch("device.status",function(status){$scope.ready="ready"==status}),$scope.$watch("device.simulator",function(sim){sim?($scope.tuneContext.minWidebandSpectrum=rtl.minSimFreq,$scope.tuneContext.maxWidebandSpectrum=rtl.maxSimFreq):($scope.tuneContext.minWidebandSpectrum=rtl.minDeviceFreq,$scope.tuneContext.maxWidebandSpectrum=rtl.maxdeviceFreq)}),$scope.$watch("survey.processing",function(processing){$scope.running=null!=processing}),$scope.$watch("survey.frequency",function(freq){freq&&$scope.form.frequency!==freq&&($scope.form.frequency=freq),freq||($scope.form.frequency=null),$scope.running=!!freq}),$scope.$watch("survey.processing",function(processing){$scope.form.processing||($scope.form.processing=processing?processing:$scope.processors[0])})}]),angular.module("rtl-demo-app").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("views/overview.html",'<div class=container><div class=row><div class=col-md-5><div class=row><div class=col-md-12><div ng-show=ready class=rhweb-survey-controls><form class=form-inline role=form><div class=form-group><label class=sr-only for=frequency>Frequency</label><div class="input-group frequency-input"><input class=form-control id=frequency placeholder=Frequency ng-model="form.frequency"><div class=input-group-addon>MHz</div></div></div><div class=form-group><label class=sr-only for=processing>Processing</label><select ng-model=form.processing class=form-control id=processing ng-options="p for p in processors"></select></div><button type=submit class="btn btn-success" ng-click=tuneContext.handleTune() ng-show=running>Tune</button> <button class="btn btn-success" ng-show=!running ng-click=task()>Start</button> <button class="btn btn-danger" ng-show=running ng-click=halt()>Halt</button></form></div></div></div><div ng-if=running class=row><div class=col-md-8><div style="width: 100%" class=rhweb-survey-controls><b><small>Audio Stream</small></b><streaming-audio url=audioUrl></streaming-audio></div></div></div></div><div ng-if=running class=col-md-7><div class=row><div class=col-md-12><div class=row><div class=input-group><div class="input-group-addon rhweb-rds-addon">Call Sign</div><input class=form-control id=rdsCall ng-model="rds.Call_Sign"></div></div><div class=row><div class=input-group><div class="input-group-addon rhweb-rds-addon">Station Type</div><input class=form-control id=rdsText ng-model="rds.Station_Type"></div></div><div class=row><div class=input-group><div class="input-group-addon rhweb-rds-addon">Now Playing</div><input class=form-control id=rdsInfo ng-model="rds.Full_Text"></div></div></div></div></div></div><div ng-show="ready && connected && !running" ng-class=row><div class=col-sm-8><button class="btn btn-xs btn-info" ng-click=toggleSimulator()>Toggle Simulator</button></div></div><div ng-show=false class=row><div class="col-sm-3 col-sm-offset-3"><p class="text-center rhweb-display-labels">Frequency</p><div class="well well-sm"><p class="text-center text-info rhweb-display-values"><strong ng-if=survey.frequency>{{survey.frequency}} MHz</strong></p></div></div><div class=col-sm-3><p class="text-center rhweb-display-labels">Processing</p><div class="well well-sm"><p class="text-center text-info rhweb-display-values"><strong>{{survey.processing | uppercase}}</strong></p></div></div></div><div ng-if=running class=row><div class=col-sm-12><div class=rhweb-plotting-toolbar><div class="btn-group btn-group-xs"><button class="btn btn-xs btn-default text-muted" data-template=views/partials/plot-help-wideband.html data-trigger=hover data-animation=am-flip-x data-placement=bottom data-auto-close=1 bs-popover><i class="fa fa-question-circle"></i></button></div><div class="btn-group btn-group-xs pull-right"><button class="btn btn-default" ng-class="{\'btn-primary\': widebandMode == \'line\'}" ng-click="setWidebandMode(\'line\')">Wideband (Line)</button> <button class="btn btn-default" ng-class="{\'btn-primary\': widebandMode == \'raster\'}" ng-click="setWidebandMode(\'raster\')">Wideband (Raster)</button></div></div><div class="well well-sm text-center rhweb-plot-container"><div ng-if="widebandMode == \'line\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" tune-context=tuneContext form=form width=auto height=300px type=float url=/rtl/output/psd/wideband cmode=D2 plot-type=line min-wideband-spectrum="" minwidebandspectrum max-wideband-spectrum="" maxwidebandspectrum></rtl-plot></div><div ng-if="widebandMode == \'raster\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" tune-context=tuneContext form=form width=auto height=300px type=float url=/rtl/output/psd/wideband cmode=D2 plot-type=raster min-wideband-spectrum="" minwidebandspectrum max-wideband-spectrum="" maxwidebandspectrum></rtl-plot></div></div></div></div><div ng-if=running class=row><div class=col-sm-12><div class=rhweb-plotting-toolbar><div class="btn-group btn-group-xs"></div><div class="btn-group btn-group-xs pull-right"><button class="btn btn-default" ng-class="{\'btn-primary\': detailPlotMode == \'narrowband\'}" ng-click="setDetailPlotMode(\'narrowband\')">Narrowband</button> <button class="btn btn-default" ng-class="{\'btn-primary\': detailPlotMode == \'demod_freq\'}" ng-click="setDetailPlotMode(\'demod_freq\')">Demodulated</button> <button class="btn btn-default" ng-class="{\'btn-primary\': detailPlotMode == \'demod_constellation\'}" ng-click="setDetailPlotMode(\'demod_constellation\')">Constellation</button> <button class="btn btn-default" ng-class="{\'btn-primary\': detailPlotMode == \'demod_bit_raster\'}" ng-click="setDetailPlotMode(\'demod_bit_raster\')">Bit Raster</button> <button class="btn btn-default" ng-class="{\'btn-primary\': detailPlotMode == \'demod_time\'}" ng-click="setDetailPlotMode(\'demod_time\')">Audio</button></div></div><div class="well well-sm text-center rhweb-plot-container"><div ng-if="detailPlotMode == \'narrowband\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" width=auto height=300px type=float url=/rtl/output/psd/narrowband cmode=D2 plot-type=line></rtl-plot></div><div ng-if="detailPlotMode == \'demod_freq\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" width=auto height=300px type=float url=/rtl/output/psd/fm cmode=D2 plot-type=line></rtl-plot></div><div ng-if="detailPlotMode == \'demod_constellation\'"><rtl-plot width=auto height=300px type=float url=/rtl/output/psk/float cmode=IR plot-type=dots autol=5></rtl-plot></div><div ng-if="detailPlotMode == \'demod_bit_raster\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" width=auto height=300px type=short url=/rtl/output/psk/short cmode=D2 plot-type=raster></rtl-plot></div><div ng-if="detailPlotMode == \'demod_time\'"><rtl-plot do-tune="doTune(rf_cf, if_cf)" width=auto height=300px type=float cmode=RE use-gradient=false url=/rtl/output/audio plot-type=line></rtl-plot></div></div></div></div></div><div ng-hide=connected><div class=container><div class=row><div class="col-md-8 col-md-offset-2"><div class="panel panel-danger"><div class=panel-heading>Connection Error</div><div class="panel-body bg-danger text-center"><h2><i class="fa fa-5x fa-meh-o"></i></h2><h3>Unable to connect to the backend server.</h3><p>Try typing <code>sudo service redhawk-web start</code> in the command-line.</p></div></div></div></div></div></div><div ng-hide="ready || !connected"><div class=container><div class=row><div class="col-md-8 col-md-offset-2"><div class="panel panel-danger"><div class=panel-heading>Device Error</div><div class="panel-body bg-danger text-center"><h2><i class="fa fa-5x fa-meh-o"></i></h2><h3>The {{device.type | uppercase}} is currently {{device.status}}.</h3><p>If the device is unplugged, please plug it in.</p></div></div></div></div><div class=row><div class="col-md-6 col-md-offset-3"><div class="panel panel-info" ng-show=!device.simulator><div class="panel-body bg-info text-center"><p>Switch to a FM Simulator instead of using the {{device.type}} hardware device.</p><button class="btn btn-sm btn-info" ng-click=toggleSimulator()>Switch to Simulator</button></div></div></div></div></div></div>'),$templateCache.put("views/partials/plot-help-wideband.html",'<div class=popover><div class=arrow></div><h3 class=popover-title>Controls</h3><div class=popover-content><div><div class=plotting-help-control>Left Click</div><div class=plotting-help-function>Tune to selected frequency</div><div class=plotting-help-control>Left-Click Drag</div><div class=plotting-help-function>Zoom into the plot</div><div class=plotting-help-control>Right Click</div><div class=plotting-help-function>Undo the most recent zoom</div><div class=plotting-help-control>Drag the Selection Box</div><div class=plotting-help-function>Tune to selected frequency</div><div class=plotting-help-control>Drag Selection Box To Plot Edge</div><div class=plotting-help-function>Tune <span style="font-style: italic">slowly</span> through the wide band spectrum continuously</div><div class=plotting-help-control>Drag Selection Box Past Plot Edge</div><div class=plotting-help-function>Tune <span style="font-style: italic">rapidly</span> through the wide band spectrum continuously</div><div class=plotting-help-control>Click Arrows On Plot</div><div class=plotting-help-function>Tune to the next lower or higher wide band spectrum segment</div><div class=plotting-help-control>Middle Click (or Press M Key)</div><div class=plotting-help-function>Show the plotting menu</div><div class=plotting-help-control>Press F Key</div><div class=plotting-help-function>Show the plot in fullscreen</div></div></div></div>')}]),angular.module("rtl-demo-app").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("components/redhawk-audio/templates/stream.html",'<style>.vert-child {\n    display: inline-block;\n    vertical-align: middle;\n    float: none;\n  }\n  .audio-stream-timestamp {\n    text-align: center;\n    font-size: smaller;\n  }\n  .audio-stream > .well {\n    background-color: #bebebe;\n    border-color: #aaaaaa;\n    color: #202020;\n    margin: 0;\n    padding: 7px;\n  }</style><audio class=player autoplay=true><source class=stream src="{{url}}"></audio><div class=audio-stream><div class="well well-sm"><div class="container-fluid audio-stream"><div class=row><div class="col-md-2 vert-child"><button class="btn btn-xs glyphicon glyphicon-play" ng-class="{\'glyphicon-play\': player.paused, \'glyphicon-stop\': !player.paused}" ng-click=togglePlay()></button></div><div class="col-md-4 vert-child"><div class=audio-stream-timestamp ng-if=!player.paused>{{currentTime}}</div><div class=audio-stream-timestamp ng-if=player.paused>Stopped</div></div><div class="col-md-2 vert-child"><button ng-click=mute() class="btn btn-xs glyphicon" ng-class="{\'glyphicon glyphicon-volume-up\': !muted, \'glyphicon glyphicon-volume-off\': muted}"></button></div><div class="col-md-3 col-sm-6 vert-child"><input type=range min=0 max=100 ng-model=volume></div></div></div></div></div>'),$templateCache.put("components/rtl-rest/templates/device-status.html","<span ng-class=\"{'text-success': device.status == 'ready', 'text-danger': device.status != 'ready'}\"><strong><span class=glyphicon ng-class=\"{'glyphicon-ok-sign': device.status == 'ready', 'glyphicon-remove-sign': device.status != 'ready'}\"></span> {{device.type | uppercase}}</strong></span>")}]);